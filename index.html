<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localized & Categorized</title>
    <link id="favicon" rel="icon" type="image/png" href="">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-color: #ff6b35;
            --primary-color-rgb: 255, 107, 53;
            --secondary-color: #ff8f35;
            --secondary-color-rgb: 255, 143, 53;
            --dark-orange: #a14522;
            --dark-bg: #1a1a1a;
            --darker-bg: #0d0d0d;
            --card-bg: rgba(30, 30, 30, 0.9);
            --text-color: #e0e0e0;
            --text-light: #ccc;
            --text-muted: #888;
            --border-color: rgba(var(--primary-color-rgb), 0.3);
            --danger-color: #ff4757;
            --success-color: #2ecc71;
            --gold-gradient: linear-gradient(45deg, #FFD700, #E5B700);
            --mx: 50%;
            --my: 50%;
            --posx: 50%;
            --posy: 50%;
        }

        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, var(--dark-bg) 0%, var(--darker-bg) 100%); min-height: 100vh; color: var(--text-color); overflow: hidden; }
        
        .full-screen-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); z-index: 2000; display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; transition: opacity 0.5s ease; opacity: 0; pointer-events: none; }
        .full-screen-overlay.visible { opacity: 1; pointer-events: all; }
        .prompt-container { text-align: center; color: white; opacity: 0; transform: translateY(20px); transition: opacity 0.5s ease 0.2s, transform 0.5s ease 0.2s; max-width: 90vw; }
        .full-screen-overlay.visible .prompt-container { opacity: 1; transform: translateY(0); }
        .themed-prompt-button { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: white; border: 2px solid transparent; padding: 12px 30px; border-radius: 30px; cursor: pointer; font-size: 1.2rem; font-weight: 700; transition: all 0.3s ease; margin: 15px 10px; min-width: 150px; perspective: 800px; transform-style: preserve-3d; overflow: hidden; position: relative; animation: theme-glow 4s ease-in-out infinite; }
        .themed-prompt-button::before { content: ''; position: absolute; top: 0; left: -150%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent); animation: shine-effect 2.5s ease-in-out infinite; animation-delay: 1.5s; }
        .themed-prompt-button:hover::before { animation-duration: 1.2s; }
        .themed-prompt-button.secondary { background: linear-gradient(45deg, #555, #777); }
        #importedCardHeader { font-size: 1.5rem; margin-bottom: 20px; font-weight: 300; }
        #importedCardHeader strong { font-weight: 700; color: var(--primary-color); }
        @keyframes slow-spin-tilt { 0% { transform: rotateY(0deg) rotateX(5deg); } 25% { transform: rotateY(90deg) rotateX(-5deg) scale(1.05); } 50% { transform: rotateY(180deg) rotateX(5deg); } 75% { transform: rotateY(270deg) rotateX(5deg) scale(1.05); } 100% { transform: rotateY(360deg) rotateX(5deg); } }
        
        #importedCardContainer .tester-card { cursor: default; width: 260px; height: 190px; margin: 0 auto; perspective: 1500px; position: relative; border-radius: 17px; }
        #importedCardContainer .tester-card .tester-card-inner { animation: slow-spin-tilt 20s linear infinite; }
        
        @keyframes special-import-spin-glow {
            0%   { transform: rotateY(0deg) rotateX(5deg); filter: drop-shadow(0 0 15px var(--special-glow-color, rgba(var(--primary-color-rgb), 0.6))); }
            25%  { transform: rotateY(90deg) rotateX(-5deg) scale(1.05); }
            50%  { transform: rotateY(180deg) rotateX(5deg); filter: drop-shadow(0 0 30px var(--special-glow-color, rgba(var(--primary-color-rgb), 1))); }
            75%  { transform: rotateY(270deg) rotateX(-5deg) scale(1.05); }
            100% { transform: rotateY(360deg) rotateX(5deg); filter: drop-shadow(0 0 15px var(--special-glow-color, rgba(var(--primary-color-rgb), 0.6))); }
        }
        #importedCardContainer .tester-card.special-import-animation {
            animation: import-glow 4s ease-in-out infinite;
        }
        #importedCardContainer .tester-card.special-import-animation .tester-card-inner {
            animation: special-import-spin-glow 20s linear infinite;
        }
        #importedCardContainer .tester-card .shine-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            z-index: 10; pointer-events: none;
            opacity: 0;
            border-radius: 15px;
            background-size: 250% 100%;
            background-repeat: no-repeat;
        }
        #importedCardContainer .tester-card .shine-overlay.animate-ltr { animation: import-shine-ltr 1s ease-in-out; }
        #importedCardContainer .tester-card .shine-overlay.animate-rtl { animation: import-shine-rtl 1s ease-in-out; }

        #welcome-prompt { text-align: center; color: white; opacity: 0; transition: opacity 0.5s ease, transform 0.8s ease-in-out; }
        #welcome-prompt.visible { opacity: 1; }
        @keyframes slow-flip { from { transform: perspective(1000px) rotateY(0deg); } to { transform: perspective(1000px) rotateY(360deg); } }
        @keyframes theme-glow { 0%, 100% { filter: drop-shadow(0 0 15px rgba(var(--primary-color-rgb), 0.6)); } 50% { filter: drop-shadow(0 0 25px rgba(var(--primary-color-rgb), 1)); } }
        @keyframes fast-flip-in { 0% { transform: perspective(1000px) rotateY(0deg) scale(0.5); opacity: 0; } 70% { transform: perspective(1000px) rotateY(1080deg) scale(1); opacity: 1; } 85% { transform: perspective(1000px) rotateY(1080deg) scale(1.15); } 100% { transform: perspective(1000px) rotateY(1080deg) scale(1); } }
        @keyframes traveling-glow-behind { from { transform: translateX(-150%); opacity: 0; } 50% { opacity: 1; } to { transform: translateX(150%); opacity: 0; } }
        @keyframes shine-effect { to { background-position: 200% center; } }
        @keyframes import-glow { 0%, 100% { filter: drop-shadow(0 0 15px var(--special-glow-color, rgba(var(--primary-color-rgb), 0.6))); } 50% { filter: drop-shadow(0 0 30px var(--special-glow-color, rgba(var(--primary-color-rgb), 1))); } }
        
        @keyframes import-shine-ltr {
            0% { opacity: 0.5; background-position: -150% center; }
            50% { opacity: 1; }
            100% { opacity: 0.5; background-position: 150% center; }
        }
        @keyframes import-shine-rtl {
            0% { opacity: 0.5; background-position: 150% center; }
            50% { opacity: 1; }
            100% { opacity: 0.5; background-position: -150% center; }
        }
        
        @keyframes import-logo-entrance {
            0% { transform: scale(1.5) rotateY(0deg); opacity: 0; }
            60% { transform: scale(0.9) rotateY(1080deg); opacity: 1; }
            80% { transform: scale(1.1) rotateY(1080deg); }
            100% { transform: scale(1.0) rotateY(1080deg); opacity: 1; }
        }
        
        #welcome-prompt:not(.welcome-back-animation) #welcome-logo { animation: slow-flip 15s linear infinite, theme-glow 4s ease-in-out infinite; }
        #welcome-prompt:not(.welcome-back-animation) #typing-text-container { animation: theme-glow 4s ease-in-out infinite; }
        .welcome-back-animation #welcome-logo { animation: fast-flip-in 1.8s ease-out forwards; }
        .welcome-back-animation #typing-text-container, .welcome-back-animation #welcome-logo .logo-inner { position: relative; }
        .welcome-back-animation #typing-text-container::before, .welcome-back-animation #welcome-logo .logo-inner::before { content: ''; position: absolute; inset: -50%; z-index: -1; background: radial-gradient(circle, rgba(var(--secondary-color-rgb), 0.8) 0%, transparent 70%); filter: blur(50px); animation: traveling-glow-behind 2.0s ease-in-out forwards; }
        #welcome-logo .logo-inner, #typing-text-container .gradient-text { background-image: linear-gradient(to right, transparent 20%, rgba(255,255,255,0.5) 50%, transparent 80%), linear-gradient(45deg, var(--primary-color), var(--secondary-color)); background-size: 200% 100%, 100% 100%; background-position: -200% center, 0 0; background-repeat: no-repeat, no-repeat; animation: shine-effect 2.5s ease-in-out 0.5s infinite; }
        .welcome-back-animation #welcome-logo .logo-inner, .welcome-back-animation #typing-text-container .gradient-text { animation-duration: 1.5s; animation-iteration-count: 1; }
        #welcome-logo { width: 150px; height: 150px; margin: 0 auto 30px; transition: all 0.8s ease-in-out; transform-style: preserve-3d; }
        #welcome-logo .logo-inner { width:100%; height:100%; -webkit-mask-image: url('https://i.imgur.com/LutzkGO.png'); -webkit-mask-size: contain; -webkit-mask-position: center; -webkit-mask-repeat: no-repeat; mask-image: url('https://i.imgur.com/LutzkGO.png'); mask-size: contain; mask-position: center; mask-repeat: no-repeat; }
        #typing-text-container { font-size: 2.5rem; font-weight: 700; min-height: 80px; }
        #typing-text-container .gradient-text { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; color: transparent; }
        #typing-cursor { display: inline-block; width: 3px; height: 2.5rem; background-color: var(--text-light); margin-left: 8px; animation: blink 1s infinite; vertical-align: bottom; }
        @keyframes blink { 50% { opacity: 0; } }
        #welcome-input-form { margin-top: 30px; opacity: 0; display: none; transition: opacity 0.5s; }
        #welcome-input-form.visible { opacity: 1; display: block;}
        #welcome-input-form input { width: 300px; padding: 12px; border-radius: 25px; border: 2px solid var(--border-color); background: var(--card-bg); color: var(--text-color); font-size: 1.1rem; text-align: center; }
        #welcome-input-form input:focus { outline: none; border-color: var(--primary-color); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); z-index: 1500; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: var(--card-bg); padding: 30px; border-radius: 20px; width: 100%; max-width: 600px; border: 2px solid var(--border-color); box-shadow: 0 10px 40px rgba(0,0,0,0.5); position: relative; max-height: 90vh; overflow-y: auto; }
        .modal-content.large { max-width: 950px; }
        .modal-content::-webkit-scrollbar { width: 8px; }
        .modal-content::-webkit-scrollbar-track { background: transparent; }
        .modal-content::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 10px; border: 2px solid var(--card-bg); }
        .modal-close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; color: var(--text-light); font-size: 1.5rem; cursor: pointer; z-index: 20; }
        
        .about-modal-body { padding: 0 40px; position: relative; perspective: 1000px; }
        .about-panels-container { position: relative; min-height: 42vh; overflow: hidden; transform-style: preserve-3d; }
        .about-panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; padding: 10px 20px; overflow-y: auto; transition: transform 0.4s ease-out; scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; }
        .about-panel::-webkit-scrollbar { width: 8px; }
        .about-panel::-webkit-scrollbar-track { background: rgba(0,0,0,0.2); border-radius: 10px; }
        .about-panel::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 10px; }
        .about-panel h3 { color: var(--secondary-color); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); }
        .about-panel p, .about-panel li { color: var(--text-light); line-height: 1.6; margin-bottom: 10px; }
        .about-panel ul { list-style-position: inside; padding-left: 5px; }
        .about-panel strong { color: var(--text-color); }
        .about-panel a { color: var(--primary-color); text-decoration: none; }
        .about-panel a:hover { text-decoration: underline; }
        .about-arrow { position: absolute; top: 50%; transform: translateY(-50%); width: 40px; height: 40px; background: var(--primary-color); border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0.7; transition: opacity 0.2s ease, background-color 0.3s; z-index: 10; }
        .about-arrow:hover { opacity: 1; }
        .about-arrow.left { left: -15px; }
        .about-arrow.right { right: -15px; }
        
        .tester-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; padding-bottom: 10px; }
        .tester-card { background-color: transparent; height: 190px; perspective: 1000px; cursor: pointer; position: relative; z-index: 1; transition: transform 0.3s ease; }
        .about-modal-body .tester-card:hover { transform: scale(1.05); z-index: 10; }
        .tester-card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .tester-card.flipped .tester-card-inner { transform: rotateY(180deg); }
        .tester-card-front, .tester-card-back { position: absolute; width: 100%; height: 100%; -webkit-backface-visibility: hidden; backface-visibility: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 2px solid transparent; border-radius: 15px; padding: 20px; text-align: center;  transition: all 0.3s ease; transform-style: preserve-3d; overflow: hidden; background-size: cover; background-position: center; background-blend-mode: color; background-color: rgba(60,60,60,0.45); }
        .tester-card-front::before, .tester-card-back::before, .tester-card-front-pseudo, .tester-card-back-pseudo { content: ''; position: absolute; inset: -2px; border-radius: 17px; background: linear-gradient(45deg, #ff8f35, #a14522); z-index: -1; opacity: 0.6; filter: blur(5px); transition: opacity 0.3s ease, filter 0.3s ease, background 0.4s ease; }
        .tester-card:hover .tester-card-front::before, .tester-card:hover .tester-card-back::before, .tester-card:hover .tester-card-front-pseudo, .tester-card:hover .tester-card-back-pseudo, .tester-card.is-hover-locked .tester-card-front::before, .tester-card.is-hover-locked .tester-card-back::before { opacity: 1; filter: blur(8px); }
        .tester-card-back { transform: rotateY(180deg); }
        .tester-name { font-size: 1.3rem; font-weight: 700; margin-bottom: 5px; position: relative; z-index: 5; -webkit-text-stroke: 1px rgba(0,0,0,0.6); }
        .tester-desc { font-size: 0.9rem; margin: 0; color: #fff; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.8); max-width: 90%; }
        .tester-desc.pulsing { animation: pulse-badge 2s ease-in-out infinite; text-shadow: 0 0 5px rgba(0,0,0,1), 0 0 10px rgba(0,0,0,0.8); }
        .tester-image { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; margin-bottom: 15px; position: relative; z-index: 5; }
        .tester-badge-container { display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .tester-badge { width: 40px; height: 40px; transition: transform 0.1s linear; }
        .user-card-badge { width: 60px; height: 60px; }
        .tester-badge.pulsing { animation: pulse-badge 2s ease-in-out infinite; }
        @keyframes pulse-badge { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        .role-label { position: absolute; top: 10px; left: 15px; z-index: 5; font-size: 0.75rem; font-weight: bold; color: white; padding: 2px 8px; border-radius: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .badge-on-front { position: absolute; top: 10px; right: 10px; z-index: 5; }
        .holo-shine-layer { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: linear-gradient( 115deg, transparent 30%, rgba(155, 246, 255, 0.4) 45%, rgba(189, 178, 255, 0.3) 50%, rgba(255, 173, 173, 0.4) 55%, transparent 70% ); mix-blend-mode: color-dodge; transform: rotate(0deg); opacity: 0; z-index: 1; transition: opacity 0.4s ease, transform 0.1s linear; pointer-events: none; }
        .tester-card:hover .holo-shine-layer, .force-holo-effect { opacity: 0.3; transform: translate(var(--mx, 0), var(--my, 0)) rotate(var(--angle, 0deg)); }
        .tester-card[data-rarity="uncommon"] .tester-card-front::before, .tester-card[data-rarity="uncommon"] .tester-card-back::before { background: linear-gradient(45deg, #32CD32, #228B22); }
        .tester-card[data-rarity="uncommon"]:hover .holo-shine-layer, .force-holo-effect { opacity: 0.6; }
        .tester-card[data-rarity="holographic"] .tester-card-front::before, .tester-card[data-rarity="holographic"] .tester-card-back::before { background: conic-gradient(from var(--angle, 0deg) at 50% 50%, #5f71f5, #8ca4fa, #161a82, #323c70, #3e4880); z-index: -2; filter: blur(15px) brightness(0.9); animation: rotate-holo-bg 12s linear infinite; }
        .tester-card[data-rarity="shiny"] .tester-card-front::before, .tester-card[data-rarity="shiny"] .tester-card-back::before { background: conic-gradient(from var(--angle, 0deg) at 50% 50%, #ffffff, #a0d8f0, #ffffff, #9bf6ff, #ffffff); z-index: -2; filter: blur(15px) brightness(1.1); animation: rotate-holo-bg 12s linear infinite; }
        .tester-card[data-rarity="promo"] .tester-card-front::before, .tester-card[data-rarity="promo"] .tester-card-back::before { background: radial-gradient(circle at 50% 50%, #B8860B, transparent 70%), linear-gradient(45deg, #FFD700, #DAA520); z-index: -2; filter: blur(10px) brightness(1.2); animation: promo-glow 4s ease-in-out infinite alternate; }
        .tester-card[data-rarity="lime"] .tester-card-front::before, .tester-card[data-rarity="lime"] .tester-card-back::before { background: radial-gradient(circle at 50% 50%, #abff4f, transparent 70%), linear-gradient(45deg, #a2e850, #61c148); z-index: -2; filter: blur(10px) brightness(1.1); animation: promo-glow 4s ease-in-out infinite alternate; }
        @keyframes rotate-holo-bg { to { --angle: 360deg; } }
        @keyframes promo-glow { from { opacity: 0.7; } to { opacity: 1; transform: scale(1.05); } }
        .tester-card[data-rarity="holographic"]:hover .holo-shine-layer, .tester-card[data-rarity="shiny"]:hover .holo-shine-layer, .force-holo-effect { opacity: 0.7; }
        .sparkle-overlay { position: absolute; inset: 0; overflow: hidden; border-radius: 15px; pointer-events: none; z-index: 2; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .tester-card:hover .sparkle-overlay, .force-sparkle-effect { opacity: 0.9; }
        .tester-card[data-rarity="common"] .sparkle-overlay, .tester-card[data-rarity="uncommon"] .sparkle-overlay, .tester-card[data-rarity="lime"] .sparkle-overlay { display: none; }
        .sparkle { position: absolute; --sparkle-size: calc(1px + 3px * var(--r)); width: var(--sparkle-size); height: var(--sparkle-size); background: white; border-radius: 50%; mix-blend-mode: screen; opacity: 0; top: calc(100% * var(--y)); left: calc(100% * var(--x)); animation: twinkle 4s ease-in-out infinite; animation-delay: calc(4s * var(--d)); }
        .sparkle:nth-of-type(n+2) { animation-delay: calc(4s * var(--d) + (0.3s * (n - 1))); }
        .tester-card[data-rarity="holographic"] .sparkle { background: radial-gradient(circle, white 20%, transparent 80%); }
        .tester-card[data-rarity="shiny"] .sparkle, .tester-card[data-rarity="promo"] .sparkle { background: radial-gradient(circle, #FFFDE4 20%, #ffffff 60%, transparent 80%); filter: brightness(1.2); --sparkle-size: calc(2px + 4px * var(--r)); }
        .custom-overlay { position: absolute; inset: 0; width:100%; height:100%; background-repeat: repeat; background-size: 50px; opacity: 0.2; pointer-events: none; mix-blend-mode: overlay; z-index: 1; }
        @keyframes twinkle { 0%, 100% { opacity: 0; transform: scale(0.5); } 30%, 70% { opacity: 0.8; transform: scale(1.2); } }
        .particle-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 3; }
        
        .tester-card-back { display: flex; align-items: center; justify-content: center; }
        .tester-back-content {
            position: relative; z-index: 4; text-align: center;
            display: flex; flex-direction: column; justify-content: center;
            align-items: center; gap: 10px; height: 100%; width: 100%;
        }
        .tester-back-content .tester-desc { margin: 0; }
        .tester-back-content .tester-badge-container { margin-top: 0; }
        .tester-back-content .tester-desc + .tester-badge-container .user-card-badge {
            width: 50px; height: 50px;
        }

        @keyframes badge-fly-and-spin { 0% { transform: translateZ(0) rotateY(0deg) scale(1); } 20% { transform: translateZ(150px) rotateY(180deg) scale(1.5); } 80% { transform: translateZ(150px) rotateY(1080deg) scale(1.5); } 100% { transform: translateZ(0) rotateY(1080deg) scale(1); } }
        .tester-badge.badge-is-animating { animation: badge-fly-and-spin 2.5s ease-out forwards; z-index: 10; position: relative; }
        
        .effect-layer {
            content: ''; position: absolute; inset: 0; border-radius: 15px; 
            pointer-events: none; z-index: 1;
            --c1: #ff0000; --c2: #00ff00; --c3: #0000ff; --c4: #ffff00; --c5: #ff00ff; --c6: #00ffff;
            --h1: #ffadad; --h2: #caffbf; --h3: #9bf6ff; --h4: #bdb2ff;
        }
        @keyframes animated-bg-pos { from { background-position: center, 0% 0%; } to   { background-position: center, 0% 100%; } }
        @keyframes animated-bg-pos-xy { from { background-position: 0% 50%; } to { background-position: 100% 50%; } }
        @keyframes animated-bg-pos-diag { from { background-position: 0% 0%; } to { background-position: 100% 100%; } }
        
        .effect-vmax { --space: 6%; background-image: url(""), repeating-linear-gradient(-33deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: color-burn, screen; background-size: 60% 30%, 1100% 1100%; background-position: center, 0% var(--posy); filter: brightness(0.6) contrast(2.5) saturate(0.6); animation: animated-bg-pos 10s ease-in-out infinite alternate; }
        .effect-vstar { --space: 5%; background-image: url(""), repeating-linear-gradient(0deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: soft-light, hue; background-size: 30%, 200% 700%; background-position: center, 0% var(--posy); filter: brightness(0.8) contrast(2) saturate(0.75); z-index: 1; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-vstar-overlay { background-image: url(""); background-size: 30%; background-position: center; filter: brightness(1.2) contrast(1.5) saturate(1.75); mix-blend-mode: exclusion; z-index: 2; }
        .effect-galaxy-shimmer { background-image: url(""), repeating-linear-gradient(82deg, var(--c1) 0%, var(--c2) 25%, var(--c3) 50%, var(--c1) 75%); background-blend-mode: color-dodge, screen; background-size: cover, 600% 600%; background-position: center, calc(((50% - var(--posx)) * 2.5) + 50%) calc(((50% - var(--posy)) * 2.5) + 50%); filter: brightness(0.8) contrast(1.5) saturate(1.5); mix-blend-mode: color-dodge; animation: animated-bg-pos 20s linear infinite; }
        .effect-rainbow-secret { --space: 14%; background-image: url(""), repeating-linear-gradient(-20deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c4) calc(var(--space) * 4), var(--c5) calc(var(--space) * 5), var(--c6) calc(var(--space) * 6), var(--c1) calc(var(--space) * 7)), url(""); background-size: 50% 50%, 500% 500%, 540px 700px; background-position: center, 0% calc(var(--posy) * 1.5), center; background-blend-mode: color-burn, soft-light, normal; filter: brightness(0.7) contrast(2.5) saturate(1); animation: animated-bg-pos 12s ease-in-out infinite alternate-reverse; z-index: 2;}
        .effect-gold-secret { background-image: repeating-linear-gradient(110deg, var(--c1) 0%, var(--c2) 50%, var(--c3) 100%), url(""); background-size: 600% 600%, 250px; background-position: var(--posx) var(--posy), center; background-blend-mode: darken; filter: brightness(0.8) contrast(3) saturate(0.7); animation: animated-bg-pos 15s ease-in-out infinite; }
        .effect-trainer-gallery { --angle: -22deg; --space: 5%; background-image: repeating-linear-gradient(var(--angle), var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c4) calc(var(--space) * 4), var(--c5) calc(var(--space) * 5), var(--c6) calc(var(--space) * 6), var(--c1) calc(var(--space) * 7)); background-blend-mode: color-dodge; background-size: 200% 400%; background-position: 0% calc(var(--posy) * 1); filter: brightness(0.65) contrast(2.3) saturate(1.1); animation: animated-bg-pos 8s ease-in-out infinite alternate; clip-path: inset(2.8% 4% round 2.55% / 1.5%); z-index: 2; }
        .effect-trainer-gallery-overlay { background-image: radial-gradient(farthest-corner ellipse at var(--posx) var(--posy), rgb(255, 255, 255) 5%, rgba(55, 0, 55, 0.6) 25%, rgb(55, 55, 55) 90%); background-position: center; background-size: 200% 200%; filter: brightness(0.6) contrast(0.85) saturate(1.1); mix-blend-mode: hard-light; z-index: 1; }
        .effect-radiant-flow { --barwidth: 1.2%; background-image: repeating-linear-gradient(55deg, var(--c1) 0, var(--c2) 25%, var(--c3) 50%, var(--c1) 75%), repeating-linear-gradient(45deg, hsl(0,0%,10%) 0%, hsl(0,0%,10%) var(--barwidth), hsl(0,0%,50%) calc(var(--barwidth)*5), hsl(0,0%,10%) calc(var(--barwidth)*9)), repeating-linear-gradient(-45deg, hsl(0,0%,10%) 0%, hsl(0,0%,10%) var(--barwidth), hsl(0,0%,50%) calc(var(--barwidth)*5), hsl(0,0%,10%) calc(var(--barwidth)*9)); background-size: 400% 400%, 210% 210%, 210% 210%; background-position: calc(((var(--posx) - 50%) * -2.5) + 50%) calc(((var(--posy) - 50%) * -2.5) + 50%), calc(((var(--posx) - 50%) * 1.5) + 50%) calc(((var(--posy) - 50%) * 1.5) + 50%), calc(((var(--posx) - 50%) * 1.5) + 50%) calc(((var(--posy) - 50%) * 1.5) + 50%); background-blend-mode: exclusion, darken, color-dodge; filter: brightness(.95) contrast(4) saturate(.75); mix-blend-mode: color-dodge; }
        .effect-illusion { background-image: url(""), repeating-linear-gradient(0deg, var(--c1) 0%, var(--c2) 25%, var(--c3) 50%, var(--c1) 75%); background-blend-mode: exclusion, hue; background-size: 50%, 200% 700%; background-position: center, 0% var(--posy); filter: brightness(0.7) contrast(2) saturate(1.5); animation: animated-bg-pos 18s ease-in-out infinite alternate; }
        .effect-v { --space: 5%; --angle: 133deg; background-image: repeating-linear-gradient(0deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c4) calc(var(--space) * 4), var(--c5) calc(var(--space) * 5), var(--c6) calc(var(--space) * 6), var(--c1) calc(var(--space) * 7)), repeating-linear-gradient(var(--angle), #0e152e 0%, hsl(180, 10%, 60%) 3.8%, hsl(180, 29%, 66%) 4.5%, hsl(180, 10%, 60%) 5.2%, #0e152e 10%, #0e152e 12%); background-blend-mode: hue, hard-light; background-size: 200% 700%, 300%; background-position: 0% var(--posy), var(--posx) var(--posy); filter: brightness(0.8) contrast(2.95) saturate(0.5); z-index: 2; animation: animated-bg-pos 10s ease-in-out infinite alternate; }
        .effect-v-overlay { background-blend-mode: soft-light; filter: brightness(1) contrast(2.5) saturate(1.75); background-image: radial-gradient(farthest-corner circle at var(--posx) var(--posy), rgba(0,0,0,0) 12%, rgba(0,0,0,0.1) 20%, rgba(0,0,0,0.2) 120%); z-index: 1; }
        .effect-v-alt { --space: 5%; background-image: repeating-linear-gradient(45deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c4) calc(var(--space) * 4), var(--c5) calc(var(--space) * 5), var(--c6) calc(var(--space) * 6), var(--c1) calc(var(--space) * 7)); background-blend-mode: hue; background-size: 400% 400%; background-position: 0% 0%; filter: brightness(0.8) contrast(2.95) saturate(1.2); animation: animated-bg-pos-diag 10s ease-in-out infinite alternate; }
        .effect-trainer-full-art { --space: 5%; background-image: url("https://i.imgur.com/5q41vWU.gif"), repeating-linear-gradient(0deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: inherit, hue; background-size: 350%, 200% 700%; background-position: center, 0% var(--posy); filter: brightness(0.8) contrast(2) saturate(0.75); z-index: 1; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-trainer-full-art-overlay { background-image: radial-gradient(farthest-corner ellipse at var(--posx) var(--posy), rgb(255, 255, 255) 5%, rgba(55, 0, 55, 0.6) 25%, rgb(55, 55, 55) 90%); background-position: center; background-size: 200% 200%; filter: brightness(0.6) contrast(0.85) saturate(1.1); mix-blend-mode: luminosity; z-index: 1; }
    .effect-rainbow-alt { --space: 14%; background-image: url("https://i.imgur.com/JMfisvu.gif"), repeating-linear-gradient(-100deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3)), url("https://i.imgur.com/NeZwmHa.jpeg"); background-size: 100% 100%, 500% 500%, 540px 700px; background-position: center, 0% calc(var(--posy) * 1.5), center; background-blend-mode: hard-light, luminosity; filter: brightness(1.0) contrast(1) saturate(1.0); animation: animated-bg-pos 12s ease-in-out infinite alternate-reverse; z-index: 2; }
        .effect-gold-alt { background-image: repeating-linear-gradient(85deg, var(--c1) 0%, var(--c2) 50%), url("https://i.imgur.com/X4taP5t.gif"); background-size: 100% 100%, 500px; background-position: var(--posx) var(--posy), center; background-blend-mode: overlay; filter: brightness(1.1) contrast(2) saturate(1.2); animation: animation: animated-bg-pos-diag 12s linear infinite alternate; }
        .effect-radiant-alt { background-image: url("https://i.imgur.com/KE4msFe.gif"),  repeating-linear-gradient(55deg, var(--c1) 0, var(--c2) 50%, var(--c1) 100%), radial-gradient(circle at var(--posx) var(--posy), hsla(0,0%,100%,.5) 0%, transparent 50%); background-size: 100% 100%, 150% 200%; background-position: calc(((var(--posx) - 50%) * -2.5) + 50%) calc(((var(--posy) - 50%) * -2.5) + 50%), center; background-blend-mode: color-burn, soft-light; filter: brightness(1.55) contrast(1) saturate(1.5); mix-blend-mode: color-dodge; }
        .effect-trainer-gallery-v { --space: 5%; --angle: 133deg; background-image: url("https://i.imgur.com/8CX6zEZ.gif"), repeating-linear-gradient(20deg, var(--c1) 0, var(--c2) 100%), repeating-linear-gradient(var(--angle), #0e152e 0%, hsl(180, 10%, 60%) 3.8%, hsl(180, 29%, 66%) 4.5%, hsl(180, 10%, 60%) 5.2%, #0e152e 22%, #0e152e 2%); background-blend-mode: difference, hue; background-size: 60%, 200% 700%, 300%; background-position: center, 0% var(--posy), var(--posx) var(--posy); filter: brightness(0.8) contrast(0.7) saturate(1); z-index: 2; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-trainer-gallery-v-overlay { background-image: radial-gradient(farthest-corner circle at var(--posx) var(--posy), rgba(0, 0, 0, 0.1) 12%, rgba(0, 0, 0, 0.15) 20%, rgba(0, 0, 0, 0.25) 120%); filter: brightness(0.9) contrast(2) saturate(1); mix-blend-mode: exclusion; z-index: 1; }
        .effect-trainer-gallery-vmax { --space: 5%; --angle: 133deg; background-image: url(""), repeating-linear-gradient(0deg, var(--c1) 0, var(--c2) 100%), repeating-linear-gradient(var(--angle), #0e152e 0%, hsl(180, 10%, 60%) 3.8%, hsl(180, 29%, 66%) 4.5%, hsl(180, 10%, 60%) 5.2%, #0e152e 10%, #0e152e 12%); background-blend-mode: exclusion, hue, hard-light; background-size: 48%, 200% 700%, 300%; background-position: center, 0% var(--posy), var(--posx) var(--posy); filter: brightness(0.6) contrast(2.5) saturate(1); z-index: 2; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-trainer-gallery-vmax-overlay { background-image: radial-gradient(farthest-corner circle at var(--posx) var(--posy), rgba(0, 0, 0, 0.1) 12%, rgba(0, 0, 0, 0.15) 20%, rgba(0, 0, 0, 0.25) 120%); filter: brightness(0.9) contrast(2) saturate(1); mix-blend-mode: exclusion; z-index: 1; }
 .effect-holo-alt {
    --space: 2px;
    --bars: 24px;
    --bar-color: rgba(255, 255, 255, 0.6);
    --bar-bg: rgb(10, 10, 10);
    background-image: url("https://i.imgur.com/JjXKr99.gif"),
        repeating-linear-gradient(90deg, var(--h1) 0%, var(--h2) 25%, var(--h3) 50%, var(--h4) 75%, var(--h1) 100%),
        repeating-linear-gradient(90deg, var(--bar-bg) calc(var(--bars) * 2), var(--bar-color) calc(var(--bars) * 3), var(--bar-bg) calc(var(--bars) * 3.5), var(--bar-color) calc(var(--bars) * 4), var(--bar-bg) calc(var(--bars) * 5), var(--bar-bg) calc(var(--bars) * 12)),
        radial-gradient(farthest-corner circle at var(--posx) var(--posy), rgba(230, 230, 230, 0.85) 0%, rgba(200, 200, 200, 0.1) 25%, rgb(0, 0, 0) 90%);
    background-blend-mode: soft-light, screen, overlay;
    background-position: calc(((50% - var(--posx)) * 25) + 50%) center, var(--posx) var(--posy), center;
    background-size: 100% 100%, 237% 237%, 120% 120%;
    filter: brightness(0.8) contrast(3.2) saturate(0.8);
    z-index: 2;
}

        .force-sparkle-effect { opacity: 0.9; }
        
        #creatorPreview .tester-card:hover .effect-layer { animation-play-state: paused; }
        #creatorPreview .tester-card .tester-card-inner { transform-style: preserve-3d; }

        .premium-effects-container { border: 1px solid var(--border-color); border-radius: 8px; margin-top: 15px; }
        .premium-effects-header { padding: 10px 15px; background: rgba(var(--primary-color-rgb), 0.1); cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .premium-effects-header h4 { color: var(--primary-color); margin: 0; }
        .premium-effects-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s ease-out; padding: 0 15px; }
        .premium-effects-content.expanded { max-height: 380px; overflow-y: auto; padding: 15px 15px 5px 15px; scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; }
        .premium-effects-content.expanded::-webkit-scrollbar { width: 5px; }
        .premium-effects-content.expanded::-webkit-scrollbar-thumb { background-color: var(--primary-color); }
        .effect-entry { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(var(--primary-color-rgb), 0.1); }
        .effect-entry:last-child { border-bottom: none; margin-bottom: 0; }
        .effect-toggle-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .effect-colors { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
        
        #iconPickerTooltip {
            position: fixed;
            background: rgba(40, 40, 40, 0.9);
            backdrop-filter: blur(5px);
            color: var(--text-light);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--primary-color);
            font-size: 0.9rem;
            max-width: 300px;
            z-index: 4000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        #iconPickerTooltip.visible { opacity: 1; }
        
        #cardCreatorModalContent { display: flex; gap: 25px; flex-wrap: wrap; }
        #creatorControls { flex: 1 1 400px; min-width: 0; max-height: 75vh; overflow-y: auto; padding-right: 15px; scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; }
        #creatorControls::-webkit-scrollbar { width: 5px; } #creatorControls::-webkit-scrollbar-thumb { background-color: var(--primary-color); }
        #creatorPreview { flex: 1 1 300px; display: flex; align-items: center; justify-content: center; transform-style: preserve-3d; perspective: 1200px; min-height: 250px; position: relative;}
        #creatorPreview .tester-card { width: 260px; height: 190px; cursor: pointer; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(22px); }
        .creatorBadgePicker {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            max-height: 190px;
            overflow-y: hidden;
            background: rgba(0,0,0,0.2);
            padding: 10px;
            border-radius: 8px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) transparent;
            transition: max-height 0.5s ease-in-out;
            scroll-behavior: smooth;
        }
        .creatorBadgePicker.expanded {
            max-height: 650px;
            overflow-y: auto;
        }
        .creatorBadgePicker .badge-pick-item { width: 50px; height: 50px; cursor: pointer; border-radius: 8px; border: 3px solid transparent; transition: all 0.2s ease; background-size: contain; background-position: center; background-repeat: no-repeat; }
        .creatorBadgePicker .badge-pick-item.selected-back { border-color: var(--primary-color); box-shadow: 0 0 10px var(--primary-color); }
        .creatorBadgePicker .badge-pick-item.selected-front { border-color: var(--dark-orange); box-shadow: 0 0 10px var(--dark-orange); }
        .form-group.inline { display:flex; align-items:center; justify-content:space-between; }
        
        .app-container { transition: filter 0.3s ease, opacity 0.3s ease; opacity: 0; }
        .app-container.visible { opacity: 1; }
        .app-container.blurred { filter: blur(5px); opacity: 0.5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { text-align: center; margin-bottom: 20px; background: rgba(30, 30, 30, 0.8); backdrop-filter: blur(10px); border-radius: 25px; padding: 30px; border: 2px solid transparent; background-clip: padding-box; position: relative; perspective: 800px; }
        .header::before { content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, var(--primary-color), #1a1a1a); border-radius: 27px; z-index: -1; }
        .header h1 { font-size: 3rem; color: var(--primary-color); margin-bottom: 10px; font-weight: 700; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); transition: transform 0.1s linear, color 0.3s; }
        .header-subtitle-container { display: flex; justify-content: center; align-items: center; gap: 12px; }
        p.header-subtitle { color: rgba(224, 224, 224, 0.9); font-size: 1.2rem; }
        .floating-emoji { font-size: 1.8rem; perspective: 400px; display: inline-block; }
        .fixed-action-button { position: fixed; z-index: 1000; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); border: 2px solid var(--primary-color); width: 60px; height: 60px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; box-shadow: 0 4px 15px rgba(var(--primary-color-rgb), 0.3), 0 0 20px rgba(var(--primary-color-rgb), 0.2); transition: all 0.3s ease; }
        .fixed-action-button:hover { transform: scale(1.1); box-shadow: 0 6px 25px rgba(var(--primary-color-rgb), 0.5), 0 0 30px rgba(var(--primary-color-rgb), 0.4); }
        #saveButton { top: 20px; left: 20px; }
        #aboutButton { bottom: 20px; right: 20px; font-size: 1.8rem; }
        .burger-menu { position: fixed; top: 20px; right: 20px; z-index: 1000; }
        .burger-button { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); border: none; width: 50px; height: 50px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: white; box-shadow: 0 4px 15px rgba(var(--primary-color-rgb), 0.3); transition: all 0.3s ease; }
        .burger-button:hover { transform: scale(1.1); }
        .burger-menu-content { position: absolute; top: 60px; right: 0; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(15px); border-radius: 15px; min-width: 320px; display: none; border: 1px solid var(--border-color); animation: slideIn 0.3s ease; max-height: 80vh; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; }
        .burger-menu-content::-webkit-scrollbar { width: 5px; }
        .burger-menu-content::-webkit-scrollbar-track { background: transparent; }
        .burger-menu-content::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 10px; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .menu-section { border-bottom: 1px solid rgba(var(--primary-color-rgb), 0.2); }
        .menu-section:last-child { border-bottom: none; }
        .menu-section-header { padding: 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: rgba(30, 30, 30, 0.5); transition: all 0.3s ease; }
        .menu-section-header:hover { background: rgba(var(--primary-color-rgb), 0.1); }
        .menu-section-header h3 { color: var(--primary-color); font-size: 1.1rem; font-weight: 600; margin: 0; }
        .menu-section-indicator { width: 24px; height: 24px; }
        .menu-section-indicator circle { transition: all 0.3s ease-out; fill: var(--dark-orange); r: 6; }
        .menu-section-indicator.expanded circle { fill: var(--primary-color); filter: drop-shadow(0 0 4px var(--primary-color)); transform-origin: center; transform: scale(1.2); }
        .menu-section-content { padding: 0 20px 20px 20px; display: none; }
        .menu-section-content.expanded { display: block; animation: expandContent 0.3s ease; }
        @keyframes expandContent { from { opacity: 0; max-height: 0; } to { opacity: 1; max-height: 500px; } }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: var(--text-light); }
        .form-group input, .form-group select, .form-group textarea, .form-group .btn-status-cycle { width: 100%; padding: 12px; border: 2px solid #333; border-radius: 8px; font-size: 1rem; background: rgba(40, 40, 40, 0.8); color: var(--text-color); transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus, .form-group .btn-status-cycle:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.2); }
        .color-picker-input { -webkit-appearance: none; -moz-appearance: none; appearance: none; width: 100%; height: 45px; cursor: pointer; background: transparent; border: none; }
        .color-picker-input::-webkit-color-swatch-wrapper { padding: 0; }
        .color-picker-input::-webkit-color-swatch { border-radius: 8px; border: 2px solid #333; }
        .btn { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-size: 1rem; font-weight: 600; transition: all 0.3s ease; margin-right: 10px; margin-bottom: 10px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(var(--primary-color-rgb), 0.4); }
        .btn-danger { background: linear-gradient(45deg, #ff4757, #ff6b7a); }
        .btn-secondary { background: linear-gradient(45deg, #555, #777); }
        #addBookmarkCategoryList { max-height: 120px; overflow-y: auto; background: rgba(40, 40, 40, 0.8); border: 2px solid #333; border-radius: 8px; padding: 5px; scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; }
        #addBookmarkCategoryList::-webkit-scrollbar { width: 5px; }
        #addBookmarkCategoryList::-webkit-scrollbar-track { background: transparent; }
        #addBookmarkCategoryList::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 10px; }
        .category-select-item { width: 100%; background: none; border: 2px solid transparent; color: var(--text-light); padding: 8px 10px; border-radius: 6px; text-align: left; cursor: pointer; transition: all 0.2s ease; margin-bottom: 5px; font-size: 1rem;}
        .category-select-item:hover { background: rgba(var(--primary-color-rgb), 0.1); border-color: rgba(var(--primary-color-rgb), 0.2); }
        .category-select-item.selected { background: var(--primary-color); color: white; font-weight: bold; border-color: var(--primary-color); }
        #addBookmarkCategoryList .no-category-msg { color: var(--text-muted); padding: 10px; text-align: center; }
        .export-list-container { max-height: 150px; overflow-y: auto; padding: 5px; border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px; }
        .export-item { display: flex; justify-content: space-between; align-items: center; padding: 8px; }
        .btn-toggle-select { border: none; border-radius: 20px; padding: 4px 12px; font-size: 0.8rem; font-weight: bold; cursor: pointer; transition: all 0.2s ease; }
        .btn-toggle-select { background: #555; color: #ccc; }
        .btn-toggle-select.selected { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: white; }
        #savedThemesList { max-height: 250px; overflow-y: auto; display: grid; gap: 10px; padding-top: 10px;}
        .saved-theme-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; border-radius: 12px; color: white; cursor: pointer; position: relative; border: 1px solid transparent; transition: all 0.2s ease;}
        .saved-theme-item.sortable-ghost { opacity: 0.4; background: #555;}
        .saved-theme-item.sortable-chosen { transform: scale(1.03); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .theme-name-bubble { font-size: 1rem; font-weight: 700; background: rgba(0,0,0,0.4); padding: 5px 12px; border-radius: 20px; z-index: 1; pointer-events: none; flex-grow: 1; margin-right: 10px; min-width: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .theme-actions { display: flex; gap: 5px; align-items: center; flex-shrink: 0;}
        .trust-factor-container { max-height: 250px; overflow-y: auto; padding-right: 5px; scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; }
        .trust-factor-container::-webkit-scrollbar { width: 5px; }
        .trust-factor-container::-webkit-scrollbar-track { background: transparent; }
        .trust-factor-container::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 10px; }
        .trust-factor-category { margin-bottom: 15px; }
        .trust-factor-category + .trust-factor-category { border-top: 1px solid rgba(var(--primary-color-rgb), 0.2); padding-top: 15px; }
        .trust-factor-category h4 { color: var(--text-light); margin: 0; padding: 10px; border-radius: 8px; cursor: pointer; transition: background-color 0.2s ease; font-weight: 600; }
        .trust-factor-category h4:hover { background-color: rgba(var(--primary-color-rgb), 0.1); }
        .trust-factor-bookmarks { display: none; padding-left: 15px; margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-color); }
        .trust-factor-bookmark-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; background-color: rgba(40, 40, 40, 0.7); padding: 8px 12px; border-radius: 8px; border-left: 3px solid var(--primary-color); }
        .trust-factor-bookmark-item > span { max-width: 60%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .btn-status-cycle { border-radius: 15px; padding: 4px 10px; font-size: 0.8rem; font-weight: bold; cursor: pointer; border: 1px solid transparent; transition: all 0.2s ease; flex-shrink: 0; }
        .btn-status-cycle.status-none { background: #555; color: #ccc; border-color: #777; }
        .btn-status-cycle.status-risky { background: var(--danger-color); color: white; }
        .btn-status-cycle.status-unverified { background: white; color: black; }
        .btn-status-cycle.status-trusted { background: var(--success-color); color: white; }
        .btn-status-cycle.status-goat { background: var(--gold-gradient); color: black; }
        .categories { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .category { background: var(--card-bg); border-radius: 20px; padding: 25px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); border: 2px solid transparent; background-clip: padding-box; position: relative; transition: all 0.3s ease; overflow: hidden; cursor: grab; }
        .category:grabbing { cursor: grabbing; } 
        .category.sortable-ghost { opacity: 0.4; }
        .category.sortable-chosen { transform: translateY(-5px); box-shadow: 0 12px 40px rgba(var(--primary-color-rgb), 0.2); }
        .category::before { content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, var(--primary-color), #333); border-radius: 22px; z-index: -1; }
        .category::after { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); border-radius: 20px 20px 0 0; }
        .category:hover { transform: translateY(-5px); box-shadow: 0 12px 40px rgba(var(--primary-color-rgb), 0.2); }
        .add-category-placeholder { border: 2px dashed var(--border-color); border-radius: 20px; padding: 25px; min-height: 270px; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; cursor: pointer; transition: all 0.3s ease; color: var(--text-muted); }
        .add-category-placeholder:hover { background: rgba(var(--primary-color-rgb), 0.1); color: var(--text-light); border-color: var(--primary-color); }
        .add-category-plus { width: 70px; height: 70px; border-radius: 50%; background-color: rgba(var(--primary-color-rgb), 0.2); font-size: 3rem; margin-bottom: 20px; transition: all 0.3s ease; font-weight: 300; display: flex; align-items: center; justify-content: center; }
        .add-category-placeholder:hover .add-category-plus { background-color: var(--primary-color); color: white; transform: scale(1.1); }
        .category-header { display: flex; align-items: center; margin-bottom: 10px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); transform-style: preserve-3d; perspective: 1000px; }
        .category-icon { width: 40px; height: 40px; margin-right: 15px; border-radius: 8px; flex-shrink: 0; transition: transform 0.4s ease-out; }
        .category-icon.has-content-bg { display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); }
        .themed-mask-icon { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; -webkit-mask-position: center; mask-position: center; }
        .category-image-mask { width: 100%; height: 100%; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; -webkit-mask-position: center; mask-position: center; }
        .category-icon > svg { width: 100%; height: 100%; }
        .category-title-group { flex: 1; min-width: 0; }
        .category h2 { color: var(--text-color); font-size: 1.5rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .category-description { font-size: 0.9rem; color: var(--text-muted); margin-top: 4px; }
        .category-actions { opacity: 0; transition: opacity 0.3s ease; display: flex; gap: 10px; }
        .category:hover .category-actions { opacity: 1; }
        .btn-text { background: none; border: none; cursor: pointer; padding: 5px; font-weight: bold; font-size: 0.9rem; text-transform: uppercase; transition: all 0.2s ease; }
        .btn-edit { color: var(--text-light); }
        .btn-edit:hover { color: white; text-shadow: 0 0 8px rgba(255, 255, 255, 0.7); }
        .btn-delete { color: var(--danger-color); }
        .btn-delete:hover { color: #ff6b7a; text-shadow: 0 0 8px rgba(255, 71, 87, 0.7); }
        .bookmark-grid { display: grid; gap: 12px; }
        .bookmark-grid.scrollable { max-height: 190px; overflow-y: auto; padding-right: 10px; }
        .bookmark-grid.scrollable::-webkit-scrollbar { width: 5px; }
        .bookmark-grid.scrollable::-webkit-scrollbar-track { background: transparent; }
        .bookmark-grid.scrollable::-webkit-scrollbar-thumb { background-color: var(--primary-color); border-radius: 10px; }
        .bookmark { display: flex; align-items: center; padding: 10px 15px; background: rgba(40, 40, 40, 0.7); border-radius: 10px; text-decoration: none; color: var(--text-color); transition: all 0.3s ease; border: 1px solid rgba(var(--primary-color-rgb), 0.2); position: relative; overflow: hidden; cursor: grab; }
        .bookmark:grabbing { cursor: grabbing; } 
        .bookmark.sortable-ghost { opacity: 0.4; background: #555;}
        .bookmark.sortable-chosen { transform: translateX(5px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .bookmark::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(var(--primary-color-rgb), 0.1), transparent); transition: left 0.5s ease; }
        .bookmark:hover::before { left: 100%; }
        .bookmark:hover { transform: translateX(5px); background: rgba(var(--primary-color-rgb), 0.1); border-color: var(--primary-color); }
        .bookmark-icon { width: 24px; height: 24px; margin-right: 15px; border-radius: 4px; background-color: var(--primary-color); background-size: cover; background-position: center; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 12px; flex-shrink: 0; }
        .bookmark-content { flex: 1; min-width: 0; }
        .bookmark-title { font-weight: 600; margin-bottom: 2px; color: var(--text-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .bookmark-description { font-size: 0.9rem; color: #aaa; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .bookmark-actions { opacity: 0; transition: opacity 0.3s ease; display: flex; gap: 5px; align-items: center; }
        .bookmark:hover .bookmark-actions { opacity: 1; }
        .btn-bookmark-action { background: none; border: 1px solid transparent; border-radius: 15px; padding: 3px 8px; font-size: 0.75rem; font-weight: bold; cursor: pointer; transition: all 0.2s ease; }
        .btn-bookmark-edit { color: var(--text-light); border-color: #666; }
        .btn-bookmark-edit:hover { color: white; background: #666; text-shadow: 0 0 5px #fff; }
        .btn-bookmark-delete { color: var(--danger-color); border-color: var(--danger-color); }
        .btn-bookmark-delete:hover { color: white; background: var(--danger-color); text-shadow: 0 0 5px var(--danger-color); }
        .category-footer-actions { display: flex; justify-content: flex-end; align-items: center; margin-top: 15px; gap: 10px; }
        .btn-expand { background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border-color); color: var(--text-light); border-radius: 20px; padding: 4px 12px; font-size: 0.8rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .btn-expand:hover { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .category-footer-actions .btn-add { background: rgba(255, 255, 255, 0.1); border: 1px solid var(--border-color); color: var(--text-light); border-radius: 50%; width: 32px; height: 32px; font-size: 1.2rem; cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; }
        .category-footer-actions .btn-add:hover { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        #searchToggleBtn { position: absolute; bottom: -18px; left: 50%; transform: translateX(-50%); width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border: none; border-radius: 50%; cursor: pointer; z-index: 10; display: flex; align-items: center; justify-content: center; transition: all 0.3s ease; perspective: 800px; transform-style: preserve-3d; }
        #searchToggleBtn svg { width: 24px; height: 24px; fill: white; transition: transform 0.4s ease; }
        #searchToggleBtn.expanded svg { transform: rotate(180deg); }
        #searchBarContainer { overflow: hidden; transition: max-height 0.5s ease-in-out, margin-top 0.5s ease-in-out, margin-bottom 0.5s ease-in-out; max-height: 0; margin-top: 0; margin-bottom: 0; }
        #searchBarContainer.expanded { max-height: 100px; margin-top: 15px; margin-bottom: 25px; }
        .search-bar { width: 100%; padding: 15px 20px; font-size: 1.1rem; border: 2px solid var(--border-color); border-radius: 25px; background: rgba(30, 30, 30, 0.9); color: var(--text-color); transition: all 0.3s ease; }
        .search-bar:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(var(--primary-color-rgb), 0.2); }
        .search-bar::placeholder { color: var(--text-muted); }
        .stats { position: absolute; top: 50%; right: 30px; transform: translateY(-50%); z-index: 5; display: flex; flex-direction: row; gap: 15px; align-items: center; }
        .stat { text-align: center; background: rgba(30, 30, 30, 0.8); padding: 10px 15px; border-radius: 20px; color: var(--text-color); backdrop-filter: blur(10px); border: 2px solid transparent; background-clip: padding-box; position: relative; perspective: 800px; transition: transform 0.1s linear; }
        .stat::before { content: ''; position: absolute; top: -2px; left: -2px; right: -2px; bottom: -2px; background: linear-gradient(45deg, var(--primary-color), #333); border-radius: 22px; z-index: -1; }
        .stat-number { font-size: 2rem; font-weight: 700; display: block; color: var(--primary-color); transition: transform 0.1s linear, color 0.3s ease; }
        .stat-label { font-size: 0.9rem; opacity: 0.9; }
        .file-upload-area { border: 2px dashed var(--primary-color); border-radius: 10px; padding: 20px; text-align: center; margin-bottom: 15px; cursor: pointer; transition: all 0.3s ease; }
        .file-upload-area:hover { background: rgba(var(--primary-color-rgb), 0.1); }
        .file-upload-area.dragover { background: rgba(var(--primary-color-rgb), 0.2); border-color: var(--secondary-color); }
        .icon-preview { width: 40px; height: 40px; border-radius: 8px; background: #333; display: inline-flex; align-items: center; justify-content: center; margin: 10px; background-size: cover; background-position: center; }
        .icon-picker { margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color); }
        .icon-picker-container { position: relative; display: flex; align-items: center; margin-top: 10px; }
        .icon-picker-arrow { background: var(--primary-color); opacity: 0.7; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; font-size: 1.8rem; line-height: 35px; cursor: pointer; z-index: 5; flex-shrink: 0; transition: opacity 0.2s ease; display: flex; align-items: center; justify-content: center; }
        .icon-picker-arrow:hover { opacity: 1; }
        .icon-picker-arrow.hidden { visibility: hidden; opacity: 0; }
        .icon-picker-arrow.left { margin-right: 10px; }
        .icon-picker-arrow.right { margin-left: 10px; }
        .icon-picker-grid { display: flex; flex-wrap: nowrap; gap: 15px; overflow-x: auto; padding: 10px 5px; scroll-behavior: smooth; scrollbar-width: none; -ms-overflow-style: none; perspective: 500px; }
        .icon-picker-grid::-webkit-scrollbar { display: none; }
        .icon-picker-item { width: 60px; height: 60px; border-radius: 12px; cursor: pointer; border: 3px solid transparent; transition: all 0.2s ease; flex-shrink: 0; background-color: transparent; padding: 5px; }
        .icon-picker-item div { width: 100%; height: 100%; background: var(--dark-orange); transition: background .2s ease; -webkit-mask-size: contain; mask-size: contain; -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat; -webkit-mask-position: center; mask-position: center; }
        .icon-picker-item:hover { border-color: var(--secondary-color); }
        .icon-picker-item:hover div { background: var(--secondary-color); }
        .icon-picker-item.selected { border-color: var(--primary-color); box-shadow: 0 0 8px var(--primary-color); }
        .icon-picker-item.selected div { background: var(--primary-color); }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 999; display: none; }
        
        #permanent-user-info {
            position: fixed;
            bottom: -200px;
            left: 20px;
            z-index: 1001;
            transition: bottom 0.5s ease-out;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #permanent-user-info.visible { bottom: 10px; }
        #permanent-user-info .user-display-name-container { cursor: pointer; transition: transform 0.2s ease; order: 3; margin-top: 0;}
        #permanent-user-info.hovering .user-display-name-container,
        #permanent-user-info.actions-expanded .user-display-name-container { transform: translateY(-2px); }
        #permanent-user-info .user-display-name { font-weight: bold; font-size: 1rem; background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
        #permanent-user-info-hover-content { 
            position: relative;
            margin-bottom: 0;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease-out;
            order: 1;
        }
        #permanent-user-info.hovering #permanent-user-info-hover-content {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        #permanent-user-info-actions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: all 0.4s ease-out;
            order: 2;
        }
        #permanent-user-info.actions-expanded #permanent-user-info-actions {
            max-height: 100px;
            opacity: 1;
            margin-top: 8px;
            margin-bottom: 8px;
        }

        .perm-user-action-btn { background: var(--card-bg); border: 1px solid var(--border-color); color: var(--text-light); padding: 8px 12px; border-radius: 8px; white-space: nowrap; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; text-align: center; width: 100%; }
        .perm-user-action-btn:hover { background: rgba(var(--primary-color-rgb), 0.1); border-color: var(--primary-color); color: var(--primary-color); }
        .hover-info-item { background: var(--card-bg); padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border-color); white-space: nowrap; display: flex; align-items: center; gap: 8px; }
        .hover-info-logo { width: 24px; height: 24px; background: var(--primary-color); -webkit-mask-image: url('https://i.imgur.com/LutzkGO.png'); mask-image: url('https://i.imgur.com/LutzkGO.png'); -webkit-mask-size: contain; -webkit-mask-position: center; -webkit-mask-repeat: no-repeat; mask-size: contain; mask-position: center; mask-repeat: no-repeat; }

        @keyframes dynamic-tilt-anim {
            0% { transform: rotateX(4deg) rotateY(-6deg) scale(1.02); }
            20% { transform: rotateX(-5deg) rotateY(8deg) scale(1); }
            40% { transform: rotateX(2deg) rotateY(-4deg) scale(1.02); }
            60% { transform: rotateX(6deg) rotateY(5deg) scale(1); }
            80% { transform: rotateX(-4deg) rotateY(-6deg) scale(1.02); }
            100% { transform: rotateX(4deg) rotateY(-6deg) scale(1.02); }
        }
        .tutorial-tooltip {
            position: fixed;
            background: rgba(30, 30, 30, 0.9);
            backdrop-filter: blur(10px);
            color: var(--text-light);
            padding: 10px 15px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            max-width: 280px;
            font-size: 0.95rem;
            line-height: 1.5;
            z-index: 3000;
            pointer-events: none;
            opacity: 0;
            transform-origin: center;
            transition: opacity 0.2s ease-out;
            will-change: transform, opacity;
            animation: dynamic-tilt-anim 16s cubic-bezier(0.45, 0.05, 0.55, 0.95) infinite;
        }
        .tutorial-tooltip.visible, .custom-tooltip.visible {
            opacity: 1;
        }
        .tutorial-title {
            position: absolute;
            top: -16px;
            background: var(--primary-color);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.3);
        }
        .tutorial-text {
            padding-top: 5px;
        }
        .creator-toast {
            position: absolute;
            top: 20px;
            left: 50%;
            background: var(--success-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            z-index: 9999;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            transform: translateX(-50%) translateY(20px);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        .creator-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        .creator-toast.warning { background: var(--danger-color); }
        .creator-toast.removal { background: var(--danger-color); }
        .creator-toast.front { background: var(--dark-orange); }
        .creator-toast.info { background: var(--primary-color); }

        .creator-toast img {
            width: 24px;
            height: 24px;
        }
        .custom-tooltip, #iconPickerTooltip {
            position: fixed;
            background: rgba(40, 40, 40, 0.9);
            backdrop-filter: blur(5px);
            color: var(--text-light);
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--primary-color);
            font-size: 0.9rem;
            max-width: 300px;
            z-index: 4000;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        #iconPickerTooltip.visible {
            opacity: 1;
        }
        
        .effect-layer {
            content: ''; position: absolute; inset: 0; border-radius: 15px; 
            pointer-events: none; z-index: 1;
            --c1: #ff0000; --c2: #00ff00; --c3: #0000ff; --c4: #ffff00; --c5: #ff00ff; --c6: #00ffff;
            --h1: #ffadad; --h2: #caffbf; --h3: #9bf6ff; --h4: #bdb2ff;
        }
        @keyframes animated-bg-pos { from { background-position: center, 0% 0%; } to   { background-position: center, 0% 100%; } }
        @keyframes animated-bg-pos-xy { from { background-position: 0% 50%; } to { background-position: 100% 50%; } }
        @keyframes animated-bg-pos-diag { from { background-position: 0% 0%; } to { background-position: 100% 100%; } }
        
        .effect-vmax { --space: 6%; background-image: url("https://i.imgur.com/sIWhgab.gif"), repeating-linear-gradient(-33deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: color-burn, screen; background-size: 60% 30%, 1100% 1100%; background-position: center, 0% var(--posy); filter: brightness(0.6) contrast(2.5) saturate(0.6); animation: animated-bg-pos 10s ease-in-out infinite alternate; }
        .effect-vstar { --space: 5%; background-image: url("https://i.imgur.com/mz3OADO.gif"), repeating-linear-gradient(0deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: soft-light, hue; background-size: 350%, 200% 700%; background-position: center, 0% var(--posy); filter: brightness(0.8) contrast(2) saturate(0.75); z-index: 1; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-vstar-overlay { background-image: url("https://i.imgur.com/2PWbY3R.gif"); background-size: 100%; background-position: center; filter: brightness(1.2) contrast(1.9) saturate(1.1); mix-blend-mode: exclusion; z-index: 1; }
        .effect-galaxy-shimmer { background-image: url("https://i.imgur.com/sy3V99N.gif"), repeating-linear-gradient(82deg, var(--c1) 0%, var(--c2) 25%, var(--c3) 50%, var(--c1) 75%); background-blend-mode: color-dodge, screen; background-size: cover, 600% 600%; background-position: center, calc(((50% - var(--posx)) * 2.5) + 50%) calc(((50% - var(--posy)) * 2.5) + 50%); filter: brightness(1.1) contrast(1.0) saturate(1.5); mix-blend-mode: darken; animation: animated-bg-pos 20s linear infinite; }
        .effect-rainbow-secret { --space: 14%; background-image: url("https://i.imgur.com/rHNaDqt.gif"), repeating-linear-gradient(-10deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c4) calc(var(--space) * 4), var(--c5) calc(var(--space) * 5), var(--c6) calc(var(--space) * 6), var(--c1) calc(var(--space) * 7)), url("https://i.imgur.com/nv1sCIo.gif"); background-size: 100% 100%, 500% 500%, 540px 700px; background-position: center, 0% calc(var(--posy) * 1.5), center; background-blend-mode: difference, soft-light, exclusion; filter: brightness(1.5) contrast(1.9) saturate(1); animation: animated-bg-pos 12s ease-in-out infinite alternate-reverse; z-index: 2;}
        .effect-gold-secret { background-image: repeating-linear-gradient(110deg, var(--c1) 0%, var(--c2) 50%, var(--c3) 100%), url("https://i.imgur.com/lbM1lFt.png"); background-size: 600% 600%, 250px; background-position: var(--posx) var(--posy), center; background-blend-mode: darken; filter: brightness(0.8) contrast(3) saturate(0.7); animation: animated-bg-pos 15s ease-in-out infinite; }
        .effect-trainer-gallery { --space: 5%; background-image: url("https://i.imgur.com/mz3OADO.gif"), repeating-linear-gradient(0deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: difference, hue; background-size: 350%, 200% 700%; background-position: center, 0% var(--posy); filter: brightness(0.8) contrast(2) saturate(0.75); z-index: 1; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-trainer-gallery-overlay { background-image: radial-gradient(farthest-corner ellipse at var(--posx) var(--posy), rgb(255, 255, 255) 5%, rgba(55, 0, 55, 0.6) 25%, rgb(55, 55, 55) 90%); background-position: center; background-size: 200% 200%; filter: brightness(0.6) contrast(0.85) saturate(1.1); mix-blend-mode: luminosity; z-index: 1; }
        .effect-radiant-flow { background-image: url("https://i.imgur.com/rrtsxFe.gif"), repeating-linear-gradient(42deg, var(--c1) 0%, var(--c2) 66%, var(--c3) 20%, var(--c1) 75%); background-blend-mode: color-dodge, screen; background-size: cover, 600% 600%; background-position: center, calc(((50% - var(--posx)) * 2.5) + 50%) calc(((50% - var(--posy)) * 2.5) + 50%); filter: brightness(1.1) contrast(1.0) saturate(1.5); mix-blend-mode: darken; animation: animated-bg-pos 20s linear infinite; }
        .effect-illusion { background-image: url("https://i.imgur.com/SEI0owt.gif"), repeating-linear-gradient(0deg, var(--c1) 0%, var(--c2) 25%, var(--c3) 50%, var(--c1) 75%); background-blend-mode: luminosity, hue; background-size: 55%, 55% 100%; background-position: center, 0% var(--posy); filter: brightness(0.7) contrast(2) saturate(1.5); animation: animated-bg-pos 18s ease-in-out infinite alternate; }
        .effect-v { --space: 5%; background-image: url("https://i.imgur.com/ffTHgak.gif"), repeating-linear-gradient(0deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: darken, luminosity; background-size: 500%, 100% 700%; background-position: center, 0% var(--posy); filter: brightness(0.8) contrast(2) saturate(0.75); z-index: 1; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-v-overlay { background-image: url("https://i.imgur.com/mK2qX3t.gif"); background-size: 100%; background-position: center; filter: brightness(1.2) contrast(1.9) saturate(1.1); mix-blend-mode: hard-light; z-index: 1; }
        .effect-galaxy-shimmer { background-image: url("https://i.imgur.com/sy3V99N.gif"), repeating-linear-gradient(82deg, var(--c1) 0%, var(--c2) 25%, var(--c3) 50%, var(--c1) 75%); background-blend-mode: color-dodge, screen; background-size: cover, 600% 600%; background-position: center, calc(((50% - var(--posx)) * 2.5) + 50%) calc(((50% - var(--posy)) * 2.5) + 50%); filter: brightness(1.1) contrast(1.0) saturate(1.5); mix-blend-mode: darken; animation: animated-bg-pos 20s linear infinite; }
        .effect-v-alt { background-image: url("https://i.imgur.com/sy3V99N.gif"); { --space: 5%; background-image: repeating-linear-gradient(45deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c4) calc(var(--space) * 4), var(--c5) calc(var(--space) * 5), var(--c6) calc(var(--space) * 6), var(--c1) calc(var(--space) * 7)); background-blend-mode: hue; background-size: 400% 400%; background-position: 0% 0%; filter: brightness(0.8) contrast(2.95) saturate(1.2); animation: animated-bg-pos-diag 10s ease-in-out infinite alternate; }
        .effect-full-art { --space: 5%; background-image: url("https://i.imgur.com/ffTHgak.gif"), repeating-linear-gradient(0deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: darken, luminosity; background-size: 500%, 100% 700%; background-position: center, 0% var(--posy); filter: brightness(0.8) contrast(2) saturate(0.75); z-index: 1; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-full-art-overlay { background-image: url("https://i.imgur.com/mK2qX3t.gif"); background-size: 100%; background-position: center; filter: brightness(1.2) contrast(1.9) saturate(1.1); mix-blend-mode: hard-light; z-index: 1; }
        .effect-trainer-full-art { --space: 5%; background-image: url("https://i.imgur.com/mz3OADO.gif"), repeating-linear-gradient(0deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3), var(--c1) calc(var(--space) * 4)); background-blend-mode: difference, hue; background-size: 350%, 200% 700%; background-position: center, 0% var(--posy); filter: brightness(0.8) contrast(2) saturate(0.75); z-index: 1; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-trainer-full-art-overlay { background-image: radial-gradient(farthest-corner ellipse at var(--posx) var(--posy), rgb(255, 255, 255) 5%, rgba(55, 0, 55, 0.6) 25%, rgb(55, 55, 55) 90%); background-position: center; background-size: 200% 200%; filter: brightness(0.6) contrast(0.85) saturate(1.1); mix-blend-mode: luminosity; z-index: 1; }
        .effect-rainbow-alt { --space: 14%; background-image: url("https://i.imgur.com/NeZwmHa.gif"), repeating-linear-gradient(-20deg, var(--c1) calc(var(--space) * 1), var(--c2) calc(var(--space) * 2), var(--c3) calc(var(--space) * 3)), url("https://i.imgur.com/JMfisvu.jpeg"); background-size: 50% 50%, 500% 500%, 540px 700px; background-position: center, 0% calc(var(--posy) * 1.5), center; background-blend-mode: inherit, soft-light, normal; filter: brightness(0.7) contrast(3) saturate(0.7); animation: animated-bg-pos 12s ease-in-out infinite alternate-reverse; z-index: 1; }
        .effect-gold-alt { background-image: url("https://i.imgur.com/NeZwmHa.gif"), repeating-linear-gradient(45deg, var(--c1) 0%, var(--c2) 50%), url(""); background-size: 300% 300%, 250px; background-position: var(--posx) var(--posy), center; background-blend-mode: overlay; filter: brightness(1.1) contrast(2) saturate(1.2); animation: animated-bg-pos-diag 12s linear infinite; }
        .effect-radiant-alt { background-image: repeating-linear-gradient(55deg, var(--c1) 0, var(--c2) 50%, var(--c1) 100%), radial-gradient(circle at var(--posx) var(--posy), hsla(0,0%,100%,.5) 0%, transparent 50%); background-size: 400% 400%, 200% 200%; background-position: calc(((var(--posx) - 50%) * -2.5) + 50%) calc(((var(--posy) - 50%) * -2.5) + 50%), center; background-blend-mode: exclusion, soft-light; filter: brightness(.95) contrast(4) saturate(1.5); mix-blend-mode: color-dodge; }
        .effect-trainer-gallery-v { --space: 5%; --angle: 133deg; background-image: url("https://res.cloudinary.com/simey/image/upload/Dev/PokemonCards/illusion.webp"), repeating-linear-gradient(0deg, var(--c1) 0, var(--c2) 100%), repeating-linear-gradient(var(--angle), #0e152e 0%, hsl(180, 10%, 60%) 3.8%, hsl(180, 29%, 66%) 4.5%, hsl(180, 10%, 60%) 5.2%, #0e152e 10%, #0e152e 12%); background-blend-mode: exclusion, hue, hard-light; background-size: 60%, 200% 700%, 300%; background-position: center, 0% var(--posy), var(--posx) var(--posy); filter: brightness(0.6) contrast(2.5) saturate(1); z-index: 2; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-trainer-gallery-v-overlay { background-image: radial-gradient(farthest-corner circle at var(--posx) var(--posy), rgba(0, 0, 0, 0.1) 12%, rgba(0, 0, 0, 0.15) 20%, rgba(0, 0, 0, 0.25) 120%); filter: brightness(0.9) contrast(2) saturate(1); mix-blend-mode: exclusion; z-index: 1; }
        .effect-trainer-gallery-vmax { --space: 5%; --angle: 133deg; background-image: url("https://res.cloudinary.com/simey/image/upload/Dev/PokemonCards/stylish.webp"), repeating-linear-gradient(0deg, var(--c1) 0, var(--c2) 100%), repeating-linear-gradient(var(--angle), #0e152e 0%, hsl(180, 10%, 60%) 3.8%, hsl(180, 29%, 66%) 4.5%, hsl(180, 10%, 60%) 5.2%, #0e152e 10%, #0e152e 12%); background-blend-mode: exclusion, hue, hard-light; background-size: 48%, 200% 700%, 300%; background-position: center, 0% var(--posy), var(--posx) var(--posy); filter: brightness(0.6) contrast(2.5) saturate(1); z-index: 2; animation: animated-bg-pos 15s ease-in-out infinite alternate; }
        .effect-trainer-gallery-vmax-overlay { background-image: radial-gradient(farthest-corner circle at var(--posx) var(--posy), rgba(0, 0, 0, 0.1) 12%, rgba(0, 0, 0, 0.15) 20%, rgba(0, 0, 0, 0.25) 120%); filter: brightness(0.9) contrast(2) saturate(1); mix-blend-mode: exclusion; z-index: 1; }
        .effect-holo-alt { --space: 2px; --bars: 24px; --bar-color: rgba(255, 255, 255, 0.6); --bar-bg: rgb(10, 10, 10); clip-path: inset(10% 8.5% 52.5% 8.5%); background-image: repeating-linear-gradient(90deg, var(--h1) calc(var(--space) * 0), var(--h1) calc(var(--space) * 3), var(--h2) calc(var(--space) * 4), var(--h2) calc(var(--space) * 7), var(--h3) calc(var(--space) * 8), var(--h3) calc(var(--space) * 11), var(--h4) calc(var(--space) * 12), var(--h4) calc(var(--space) * 15)), repeating-linear-gradient(90deg, var(--bar-bg) calc(var(--bars) * 2), var(--bar-color) calc(var(--bars) * 3), var(--bar-bg) calc(var(--bars) * 3.5), var(--bar-color) calc(var(--bars) * 4), var(--bar-bg) calc(var(--bars) * 5), var(--bar-bg) calc(var(--bars) * 12)); background-blend-mode: soft-light, screen; background-position: calc(((50% - var(--posx)) * 25) + 50%) center, var(--posx) var(--posy); background-size: 200% 200%, 237% 237%; filter: brightness(0.8) contrast(3.2) saturate(0.8); z-index: 2;}
        .effect-holo-alt-overlay { background-image: radial-gradient(farthest-corner circle at var(--posx) var(--posy), rgba(230, 230, 230, 0.85) 0%, rgba(200, 200, 200, 0.1) 25%, rgb(0, 0, 0) 90%); background-blend-mode: overlay; background-size: 120% 120%; filter: brightness(0.8) contrast(3.2) saturate(0.8); z-index: 1;}

        .force-sparkle-effect { opacity: 0.9; }
        
        #creatorPreview .tester-card:hover .effect-layer { animation-play-state: paused; }
        #creatorPreview .tester-card .tester-card-inner { transform-style: preserve-3d; }

        .premium-effects-container { border: 1px solid var(--border-color); border-radius: 8px; margin-top: 15px; }
        .premium-effects-header { padding: 10px 15px; background: rgba(var(--primary-color-rgb), 0.1); cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .premium-effects-header h4 { color: var(--primary-color); margin: 0; }
        .premium-effects-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease-out, padding 0.4s ease-out; padding: 0 15px; }
        .premium-effects-content.expanded { max-height: 380px; overflow-y: auto; padding: 15px 15px 5px 15px; scrollbar-width: thin; scrollbar-color: var(--primary-color) transparent; }
        .premium-effects-content.expanded::-webkit-scrollbar { width: 5px; }
        .premium-effects-content.expanded::-webkit-scrollbar-thumb { background-color: var(--primary-color); }
        .effect-entry { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid rgba(var(--primary-color-rgb), 0.1); }
        .effect-entry:last-child { border-bottom: none; margin-bottom: 0; }
        .effect-toggle-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .effect-colors { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; }
        
        @media (max-width: 900px) {
            .stats { flex-direction: column; gap: 10px; top: 20px; right: 20px; transform: none; }
            .header { padding-right: 140px; }
            .header h1 { font-size: 2.2rem; }
            #cardCreatorModalContent { flex-direction: column; }
            #creatorPreview .tester-card { transform: scale(1.0); } 
        }
        @media (max-width: 768px) { .categories { grid-template-columns: 1fr; } .header { padding-right: 30px; } .header h1 { font-size: 2rem; } .stats { display: none; } .burger-menu-content { right: -10px; min-width: 280px; } .tester-grid { grid-template-columns: 1fr; }}
    </style>
</head>
<body>
    <div class="full-screen-overlay" id="welcomeOverlay">
        <div id="welcome-prompt">
            <div id="welcome-logo"><div class="logo-inner"></div></div>
            <div id="typing-text-container"><span id="typing-text" class="gradient-text"></span><span id="typing-cursor"></span></div>
            <form id="welcome-input-form" onsubmit="event.preventDefault(); window.bookmarkManager.handleWelcomeSubmit();">
                <input type="text" id="usernameInput" placeholder="Enter your username...">
            </form>
        </div>
    </div>
    <div class="full-screen-overlay" id="importedCardOverlay"></div>
    <div class="full-screen-overlay" id="tutorialPromptOverlay"></div>
    
    <div class="modal-overlay" id="genericModal"><div class="modal-content" id="genericModalContent"></div></div>
    <div id="iconPickerTooltip"></div>
    
    <div class="app-container">
        <div class="overlay" id="overlay"></div>
        <button class="fixed-action-button" id="saveButton" data-tutorial-key="save-button">💾</button>
        <button class="fixed-action-button" id="aboutButton" data-tutorial-key="about-button">?</button>
        <div id="permanent-user-info" data-tutorial-key="permanent-user">
            <div id="permanent-user-info-hover-content">
                <div class="hover-info-item"><div class="hover-info-logo"></div><span id="appVersion"></span></div>
            </div>
            <div id="permanent-user-info-actions">
            </div>
            <div class="user-display-name-container">
                <span class="user-display-name"></span>
            </div>
        </div>
        <div class="burger-menu">
            <button class="burger-button" id="burgerButton" data-tutorial-key="burger-menu">☰</button>
            <div class="burger-menu-content" id="burgerMenuContent">
                <div class="menu-section"><div class="menu-section-header" onclick="toggleSection('addBookmark')" data-tutorial-key="add-bookmark-menu"><h3 class="menu-title">🔖 Add Bookmark</h3><svg class="menu-section-indicator" id="addBookmark-indicator" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"/></svg></div><div class="menu-section-content" id="addBookmark-content"><form id="addBookmarkForm"><div class="form-group"><label for="addBookmarkCategoryList">Category:</label><div id="addBookmarkCategoryList"></div></div><div class="form-group"><label for="titleInput">Title:</label><input type="text" id="titleInput" placeholder="Bookmark title" required=""></div><div class="form-group"><label for="urlInput">URL:</label><input type="text" id="urlInput" placeholder="example.com" required=""></div><div class="form-group"><label for="descriptionInput">Description:</label><textarea id="descriptionInput" placeholder="Brief description" rows="2"></textarea></div><button type="submit" class="btn">Add Bookmark</button></form></div></div>
                <div class="menu-section"><div class="menu-section-header" onclick="toggleSection('addCategory')" data-tutorial-key="add-category-menu"><h3 class="menu-title">📚 Add Category</h3><svg class="menu-section-indicator" id="addCategory-indicator" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"></circle></svg></div><div class="menu-section-content" id="addCategory-content"><form id="addCategoryForm"><div class="form-group"><label for="newCategoryInput">Category Name:</label><input type="text" id="newCategoryInput" placeholder="Enter category name" required=""></div><div class="form-group"><label for="newCategoryDescInput">Category Description:</label><input type="text" id="newCategoryDescInput" placeholder="Brief category description"></div><div class="form-group"><label>Category Icon:</label><div class="file-upload-area" id="iconUploadArea"><p>Drop icon file here or click to browse</p><p style="font-size: 0.8rem; color: #888;">.ico, .png, .jpg, .svg</p><input type="file" id="iconFileInput" accept=".ico,.png,.jpg,.jpeg,.svg" style="display: none;"></div><div id="iconPreview"></div></div><button type="submit" class="btn">Add Category</button></form></div></div>
                <div class="menu-section"><div class="menu-section-header" onclick="toggleSection('trustFactor')" data-tutorial-key="trust-factor-menu"><h3 class="menu-title">🛡️ Trust Factor</h3><svg class="menu-section-indicator" id="trustFactor-indicator" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"></circle></svg></div><div class="menu-section-content" id="trustFactor-content"><div id="trust-factor-container" class="trust-factor-container"></div></div></div>
                 <div class="menu-section">
                    <div class="menu-section-header" onclick="toggleSection('themeCustomizer')" data-tutorial-key="theme-customizer-menu">
                        <h3 class="menu-title">🎨 Theme Customizer</h3>
                        <svg class="menu-section-indicator" id="themeCustomizer-indicator" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"></circle></svg>
                    </div>
                    <div class="menu-section-content" id="themeCustomizer-content">
                        <div class="form-group"><label for="primaryColorPicker">Primary Color:</label><input type="color" id="primaryColorPicker" class="color-picker-input"></div>
                        <div class="form-group"><label for="secondaryColorPicker">Secondary Color:</label><input type="color" id="secondaryColorPicker" class="color-picker-input"></div>
                        <button class="btn" id="saveThemeBtn" style="width:calc(50% - 5px); margin:10px 0;">Save Theme</button>
                        <button class="btn btn-secondary" id="resetThemeBtn" style="width:calc(50% - 5px); margin:10px 0 10px 5px;">Reset Default</button>
                    </div>
                </div>
                <div class="menu-section">
                    <div class="menu-section-header" onclick="toggleSection('savedThemes')" data-tutorial-key="saved-themes-menu">
                        <h3 class="menu-title">🌟 Saved Themes <span id="themeCount"></span></h3>
                        <svg class="menu-section-indicator" id="savedThemes-indicator" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"></circle></svg>
                    </div>
                    <div class="menu-section-content" id="savedThemes-content">
                        <div id="savedThemesList"></div>
                    </div>
                </div>
                <div class="menu-section"><div class="menu-section-header" onclick="toggleSection('dataManagement')" data-tutorial-key="data-management-menu"><h3 class="menu-title">💾 Data Management</h3><svg class="menu-section-indicator" id="dataManagement-indicator" viewBox="0 0 24 24"><circle cx="12" cy="12" r="8"></circle></svg></div>
                    <div class="menu-section-content" id="dataManagement-content">
                        <div class="form-group"><label>Export Bookmarks:</label><div class="export-list-container" id="export-list-container"></div></div>
                        <button class="btn" id="exportSelectedBtn">Export Selected</button><button class="btn" id="exportAllBtn">Export All</button>
                        <div class="form-group" style="margin-top: 20px;"><label>Export Themes:</label><div class="export-list-container" id="export-theme-list-container"></div></div>
                        <button class="btn" id="exportSelectedThemesBtn">Export Selected</button><button class="btn" id="exportAllThemesBtn">Export All</button>
                        <hr style="border-color: var(--border-color); margin: 20px 0;">
                        <button class="btn" id="importBtn">Import Data</button>
                        <input type="file" id="importFile" accept=".xan,.xanth,.json" style="display: none;">
                        <button class="btn btn-danger" id="deleteAllDataBtn" style="margin-top: 20px;">⚠️Delete All Data⚠️</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="header">
                 <div class="stats">
                    <div class="stat"><span class="stat-number" id="totalBookmarks">0</span><span class="stat-label">Bookmarks</span></div>
                    <div class="stat"><span class="stat-number" id="totalCategories">0</span><span class="stat-label">Categories</span></div>
                </div>
                <h1 data-tutorial-key="main-title">Localized & Categorized</h1>
                <div class="header-subtitle-container"><span id="startEmoji" class="floating-emoji"></span><p class="header-subtitle">Categorize Your Piracy For Safe Sailing</p><span id="endEmoji" class="floating-emoji"></span></div>
                <button id="searchToggleBtn" data-tutorial-title="Toggle Search Bar">
                    <svg viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"></path></svg>
                </button>
            </div>
            <div id="searchBarContainer">
                <input type="text" class="search-bar" placeholder="🔍 Search bookmarks..." id="searchInput" data-tutorial-key="search-bar">
            </div>
            <div class="categories" id="categoriesContainer"></div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const localIconList = [ 'torrenting.svg', 'linux.svg', 'music.svg', 'adblocking.svg', 'shopping.svg', 'tools.svg', 'cooking.svg', 'modding.svg', 'mobile.svg', 'ai.svg', 'books.svg', 'sailing.svg', 'games.svg', 'emulation.svg', 'plugins.svg', 'graphics.svg', 'editing.svg', 'anime.svg', 'code.svg', 'movies.svg' ];
            const localIconFallbacks = { 'torrenting.svg': 'https://i.imgur.com/fcgHdgY.png', 'linux.svg': 'https://i.imgur.com/meYR8QI.png', 'music.svg': 'https://i.imgur.com/Ynx5eYN.png', 'adblocking.svg': 'https://i.imgur.com/21BXn3M.png', 'shopping.svg': 'https://i.imgur.com/r7kwtwW.png', 'tools.svg': 'https://i.imgur.com/HQJWmFE.png', 'cooking.svg': 'https://i.imgur.com/nV8xDn0.png', 'modding.svg': 'https://i.imgur.com/xieD7WA.png', 'mobile.svg': 'https://i.imgur.com/c10BMZA.png', 'ai.svg': 'https://i.imgur.com/IyXZaeT.png', 'books.svg': 'https://i.imgur.com/5RVzCUu.png', 'sailing.svg': 'https://i.imgur.com/v49Amay.png', 'games.svg': 'https://i.imgur.com/1jjsjEk.png', 'emulation.svg': 'https://i.imgur.com/bJoTZcW.png', 'plugins.svg': 'https://i.imgur.com/Sws1T4C.png', 'graphics.svg': 'https://i.imgur.com/g3NaeqV.png', 'editing.svg': 'https://i.imgur.com/UUh5jKv.png', 'anime.svg': 'https://i.imgur.com/u7hxNpj.png', 'code.svg': 'https://i.imgur.com/FN3y8lZ.png', 'movies.svg': 'https://i.imgur.com/8voSWhT.png' };
const ImgurUrls = 
[
  'https://i.imgur.com/6TFx5Vl.png', 'https://i.imgur.com/KM9HcFo.png', 'https://i.imgur.com/6STaaoi.png',
  'https://i.imgur.com/6gADSvZ.png', 'https://i.imgur.com/4f72SuN.png', 'https://i.imgur.com/D42o1F7.png',
  'https://i.imgur.com/Q8ECqq3.png', 'https://i.imgur.com/uSGtyJh.png', 'https://i.imgur.com/bDX9Xst.png',
  'https://i.imgur.com/4UDXK06.png', 'https://i.imgur.com/tZ4M0nA.png', 'https://i.imgur.com/HlwLbVs.png',
  'https://i.imgur.com/A5rh3k3.png', 'https://i.imgur.com/QjvJpJ3.png', 'https://i.imgur.com/Vq3FRMZ.png',
  'https://i.imgur.com/ckjdXOb.png', 'https://i.imgur.com/D8v8u1q.png', 'https://i.imgur.com/QIMeycG.png',
  'https://i.imgur.com/OqGNMEP.png', 'https://i.imgur.com/d7YaAJw.png', 'https://i.imgur.com/XQ4pZM5.png',
  'https://i.imgur.com/medTaJJ.png', 'https://i.imgur.com/rnWPRc1.png', //why am i doing this to myself ? 💀
  'https://i.imgur.com/zl60Fat.png', 'https://i.imgur.com/iCCFfoM.png', 'https://i.imgur.com/2szXdZP.png',
  'https://i.imgur.com/VZrLJYK.png', 'https://i.imgur.com/5kQy4cm.png', 'https://i.imgur.com/tsJjoOU.png',
  'https://i.imgur.com/X2361KH.png', 'https://i.imgur.com/6JvfKkm.png', 'https://i.imgur.com/7D25K7A.png',
  'https://i.imgur.com/csfWLvO.png', 'https://i.imgur.com/pd0byo1.png', 'https://i.imgur.com/tgqBohH.png',
  'https://i.imgur.com/e9PuGgX.png', 'https://i.imgur.com/DUPzkIC.png', 'https://i.imgur.com/ZiKjyNh.png',
  'https://i.imgur.com/uq2kLhT.png', 'https://i.imgur.com/tXTJf4s.png', 'https://i.imgur.com/0eLmGHq.png',
  'https://i.imgur.com/1FSv2dg.png', 'https://i.imgur.com/S8cXSlc.png', 'https://i.imgur.com/lAVX24m.png',
  'https://i.imgur.com/1E1KA6n.png', 'https://i.imgur.com/0dJaCKn.png', 'https://i.imgur.com/R7Tos9E.png',
  'https://i.imgur.com/yYUUano.png', 'https://i.imgur.com/AcHELX5.png', 'https://i.imgur.com/konenLn.png',
  'https://i.imgur.com/vUaBM10.png', 'https://i.imgur.com/78djS9g.png', 'https://i.imgur.com/EaoMenG.png',
  'https://i.imgur.com/ZIORGSd.png', 'https://i.imgur.com/yyKi0Kh.png', 'https://i.imgur.com/LsyTBzL.png',
  'https://i.imgur.com/H75PDhI.png', 'https://i.imgur.com/a5ctBdC.png', 'https://i.imgur.com/w3wrjfX.png',
  'https://i.imgur.com/BxyTDAD.png', 'https://i.imgur.com/6o4DfHg.png', 'https://i.imgur.com/1nqwNyM.png',
  'https://i.imgur.com/ZUHiE4B.png', 'https://i.imgur.com/SZLz5t6.png', 'https://i.imgur.com/0ErJAxv.png',
  'https://i.imgur.com/Vuw6etJ.png', 'https://i.imgur.com/HQTsWyg.png', 'https://i.imgur.com/yhUL4Fd.png',
  'https://i.imgur.com/2mmtYhU.png', 'https://i.imgur.com/VNzNPPr.png', 'https://i.imgur.com/Wb6NUx1.png',
  'https://i.imgur.com/P9H46SY.png', 'https://i.imgur.com/EdrnHbI.png', 'https://i.imgur.com/kRD6hDa.png',
  'https://i.imgur.com/ZMMqCQn.png', 'https://i.imgur.com/eNO0TPJ.png', 'https://i.imgur.com/23chd8L.png',
  'https://i.imgur.com/jilpQqr.png', 'https://i.imgur.com/WHZsn3J.png', 'https://i.imgur.com/i9YWVMG.png',
  'https://i.imgur.com/yalUM9H.png', 'https://i.imgur.com/pSs81qg.png', 'https://i.imgur.com/U7M1JHB.png',
  'https://i.imgur.com/tzQjXYU.png', 'https://i.imgur.com/blRI6gb.png', 'https://i.imgur.com/nKstRXh.png',
  'https://i.imgur.com/KIqoucn.png', 'https://i.imgur.com/yKxvnwe.png', 'https://i.imgur.com/4RCMb0V.png',
  'https://i.imgur.com/pgyhI1i.png', 'https://i.imgur.com/eUUdZR3.png', 'https://i.imgur.com/pGKYH0t.png',
  'https://i.imgur.com/jwXfzQD.png', 'https://i.imgur.com/VpRYev8.png', 'https://i.imgur.com/FRUjWcp.png',
  'https://i.imgur.com/puCcXWB.png', 'https://i.imgur.com/WGu7l7Y.png', 'https://i.imgur.com/pAifkCh.png',
  'https://i.imgur.com/7mkHk4t.png', 'https://i.imgur.com/R7jiBhZ.png'
];
            const badgeUrlsImplementingThisorKMS = [];
            for (let i = 0; i < 100; i++) { badgeUrlsImplementingThisorKMS.push(ImgurUrls[i % ImgurUrls.length]); }
            const userBadgeData = badgeUrlsImplementingThisorKMS.map((url, index) => ({ id: `user_badge_${index}`, url: url }));

            let hasUnsavedChanges = false;
            
            const BADGE_TYPES = { stars: { img: 'https://i.imgur.com/HxLN2U3.png', location: 'back' }, tester: { img: 'https://i.imgur.com/e8LUf0d.png', location: 'back' }, promo_gold: { img: 'https://i.imgur.com/Sj2wYkC.png', location: 'front' }, promo_lime: { img: 'https://i.imgur.com/H8y49ON.png', location: 'front' }, voo: { img: 'https://i.imgur.com/epuIvIt.png', location: 'back' }, ody: { img: 'https://i.imgur.com/66xMmcl.png', location: 'back' }, cxndy: { img: 'https://i.imgur.com/mzOQyd5.png', location: 'back' }, lime2: { img: 'https://i.imgur.com/4xZQNWe.png', location: 'back' } };
            
            window.addEventListener('beforeunload', (e) => { if (hasUnsavedChanges) { e.preventDefault(); e.returnValue = ''; } });
            
            window.scrollIconPicker = (direction) => { const grid = document.getElementById('iconPickerGrid'); if (grid) { const scrollAmount = grid.clientWidth * 0.8; grid.scrollLeft += direction === 'right' ? scrollAmount : -scrollAmount; } };
            window.updateIconPickerArrows = () => { const grid = document.getElementById('iconPickerGrid'); const leftArrow = document.querySelector('.icon-picker-arrow.left'); const rightArrow = document.querySelector('.icon-picker-arrow.right'); if (grid && leftArrow && rightArrow) { const buffer = 10; leftArrow.classList.toggle('hidden', grid.scrollLeft <= buffer); const maxScrollLeft = grid.scrollWidth - grid.clientWidth; rightArrow.classList.toggle('hidden', grid.scrollLeft >= maxScrollLeft - buffer); } };
            window.toggleSection = (sectionId) => { const content = document.getElementById(sectionId + '-content'); const indicator = document.getElementById(sectionId + '-indicator'); content.classList.toggle('expanded'); indicator.classList.toggle('expanded'); content.style.display = content.classList.contains('expanded') ? 'block' : 'none'; if (sectionId === 'trustFactor' && content.classList.contains('expanded')) { window.bookmarkManager.renderTrustFactorPanel(); } else if (sectionId === 'savedThemes' && content.classList.contains('expanded')) { window.bookmarkManager.themeManager.renderThemes(); } };
            
            let isDraggingOnOverlay = false;
            document.getElementById('genericModal').addEventListener('mousedown', (e) => { if (e.target.id === 'genericModal') isDraggingOnOverlay = true; });
            document.getElementById('genericModal').addEventListener('mouseup', (e) => { if (e.target.id === 'genericModal' && isDraggingOnOverlay) closeModal(); isDraggingOnOverlay = false; });
            document.getElementById('genericModal').addEventListener('mousemove', (e) => { if(e.buttons !== 1) isDraggingOnOverlay = false; });
            
            window.showModal = (contentHTML, isLarge = false) => { const modalContent = document.getElementById('genericModalContent'); modalContent.innerHTML = contentHTML; modalContent.classList.toggle('large', isLarge); document.getElementById('genericModal').style.display = 'flex'; document.querySelector('.app-container').classList.add('blurred'); };
            window.closeModal = () => { const modalContent = document.getElementById('genericModalContent'); modalContent.innerHTML = ''; modalContent.classList.remove('large'); document.getElementById('genericModal').style.display = 'none'; document.querySelector('.app-container').classList.remove('blurred'); if (window.bookmarkManager && window.bookmarkManager.aboutPanelCleanup) { window.bookmarkManager.aboutPanelCleanup(); window.bookmarkManager.aboutPanelCleanup = null; } };
            
            const lightenColor = (hex, percent) => { if(!hex || typeof hex !== 'string') return '#000000'; let r, g, b; try { r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16); } catch(e) { return '#000000';} if(isNaN(r) || isNaN(g) || isNaN(b)) return '#000000'; const p = percent / 100; r = Math.min(255, Math.max(0, r + (r * p))); g = Math.min(255, Math.max(0, g + (g * p))); b = Math.min(255, Math.max(0, b + (b * p))); return `#${Math.round(r).toString(16).padStart(2,'0')}${Math.round(g).toString(16).padStart(2,'0')}${Math.round(b).toString(16).padStart(2,'0')}`;};
            const hexToRgbCss = (hex) => { if(!hex) return '206, 42, 36'; const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex); return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '206, 42, 36'; };

            const cardEffectsManager = { preloadImages: {}, preloadImage(url) { if (!this.preloadedImages[url]) { const img = new Image(); img.src = url; this.preloadedImages[url] = img; } return this.preloadedImages[url]; }, particleSystem: { canvas: null, ctx: null, particles: [], active: false, rarityPresets: { common: { burstCount: 2, ambientCount: 0, speed: { burst: 0.6 }, life: 150, colors: ['#FFFFFF'], glow: 'rgba(255,255,255,0.5)', shape: 'circle' }, uncommon: { burstCount: 5, ambientCount: 0, speed: { burst: 1.0 }, life: 200, colors: ['#a0c4ff', '#9bf6ff'], glow: '#9bf6ff', shape: 'circle' }, holographic:{ burstCount: 8, ambientCount: 0, speed: { burst: 1.4 }, life: 250, colors: ['#ffadad', '#fdffb6', '#caffbf', '#9bf6ff', '#bdb2ff', '#ffc6ff'], glow: '#FFFFFF', shape: 'circle' }, shiny: { burstCount: 12, ambientCount: 0, speed: { burst: 1.8 }, life: 300, colors: ['#FFFFFF', '#e0f7fa', '#cce7f4'], glow: 'rgba(255,255,255,0.8)', shape: 'circle' }, promo: { burstCount: 15, ambientCount: 0, speed: { burst: 2.0 }, life: 350, colors: ['#FFD700', '#FFFDE4', '#DAA520'], glow: 'rgba(255,215,0,0.7)', shape: 'triangle' }, lime: { burstCount: 10, ambientCount: 0, speed: { burst: 1.5 }, life: 300, colors: [], glow: 'rgba(172, 255, 71, 0.7)', shape: 'image' } }, init(canvas) { this.canvas = canvas; if(this.canvas) { this.ctx = canvas.getContext('2d'); this.resize(); } }, resize() { if(!this.canvas) return; const rect = this.canvas.parentElement.getBoundingClientRect(); this.canvas.width = rect.width; this.canvas.height = rect.height; }, emit(originElement, rarity, particleImageUrl, isBurst = true) { const preset = this.rarityPresets[rarity] || this.rarityPresets.common; const count = isBurst ? preset.burstCount : preset.ambientCount; if(count === 0 || !this.canvas) return; const originRect = originElement.getBoundingClientRect(); const canvasRect = this.canvas.getBoundingClientRect(); const originX = (originRect.left - canvasRect.left) + (originRect.width / 2); const originY = (originRect.top - canvasRect.top) + (originRect.height / 2); for (let i = 0; i < count; i++) { const speed = isBurst ? preset.speed.burst : preset.speed.ambient; this.particles.push({ x: originX, y: originY, vx: (Math.random() - 0.5) * speed, vy: (Math.random() - 0.5) * speed - (speed * 0.5), life: preset.life + Math.random() * 50, initialLife: preset.life, size: Math.random() * (preset.shape === 'image' ? 12 : 2) + (preset.shape === 'image' ? 8 : 1.5), color: preset.colors.length > 0 ? preset.colors[Math.floor(Math.random() * preset.colors.length)] : null, glowColor: preset.glow, shape: preset.shape, image: preset.shape === 'image' ? cardEffectsManager.preloadImage(particleImageUrl) : null, angle: 0, rotationSpeed: (Math.random() - 0.5) * 0.1 }); } if(!this.active){ this.active = true; this.updateAndDraw(); } }, drawParticle(p) { this.ctx.save(); this.ctx.translate(p.x, p.y); this.ctx.rotate(p.angle); if (p.shape === 'triangle') { this.ctx.beginPath(); this.ctx.moveTo(0, -p.size); this.ctx.lineTo(-p.size, p.size); this.ctx.lineTo(p.size, p.size); this.ctx.closePath(); this.ctx.fill(); } else if (p.shape === 'image' && p.image?.complete) { this.ctx.drawImage(p.image, -p.size / 2, -p.size / 2, p.size, p.size); } else { this.ctx.beginPath(); this.ctx.arc(0, 0, p.size, 0, Math.PI * 2); this.ctx.fill(); } this.ctx.restore(); }, updateAndDraw() { if (!this.ctx || !this.canvas) { this.active = false; return; } this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); this.particles = this.particles.filter(p => { p.x += p.vx; p.y += p.vy; p.angle += p.rotationSpeed; p.life--; if (p.life > 0) { this.ctx.globalAlpha = p.life / p.initialLife; this.ctx.shadowBlur = 10; this.ctx.shadowColor = p.glowColor; this.ctx.fillStyle = p.color; this.drawParticle(p); return true; } return false; }); this.active = this.particles.length > 0; if (this.active) { requestAnimationFrame(() => this.updateAndDraw()); } else { this.ctx.shadowBlur = 0; } }, }, initCardEffects(cardElement) { const sparkles = cardElement.querySelectorAll('.sparkle'); sparkles.forEach(sparkle => { sparkle.style.setProperty('--x', Math.random()); sparkle.style.setProperty('--y', Math.random()); sparkle.style.setProperty('--r', Math.random()); sparkle.style.setProperty('--d', Math.random()); }); cardElement.addEventListener('mousemove', e => { const rect = cardElement.getBoundingClientRect(); const x = e.clientX - rect.left; const y = e.clientY - rect.top; const relX = x / rect.width; const relY = y / rect.height; cardElement.style.setProperty('--mx', `${(relX - 0.5) * 10}%`); cardElement.style.setProperty('--my', `${(relY - 0.5) * 10}%`); cardElement.style.setProperty('--angle', `${(relX - 0.5) * 360}deg`); cardElement.style.setProperty('--posx', `${relX * 100}%`); cardElement.style.setProperty('--posy', `${relY * 100}%`); }); }, async animateBadgesSequentially(cardElement) { const badges = cardElement.querySelectorAll('.tester-badge-container .tester-badge'); if (badges.length === 0) return; const delay = ms => new Promise(res => setTimeout(res, ms)); for (const badge of badges) { badge.classList.add('badge-is-animating'); await new Promise(resolve => { badge.addEventListener('animationend', resolve, { once: true }); }); badge.classList.remove('badge-is-animating'); await delay(500); } } };

            class TutorialManager {
                constructor() {
                    this.enabled = this.loadState();
                    this.tooltipElement = null;
                    this.activeTarget = null;
                    this.showTimeout = null;
                    this.tutorials = {
                        'save-button': { title: 'Save Data', text: 'Click to manually save all bookmarks and themes to the browser. You will also be provided the ability to download a backup file.' },
                        'about-button': { title: 'About Page', text: 'View project info, changelogs, and contributors. You can also toggle the interactive tutorial from here.' },
                        'burger-menu': { title: 'Main Menu', text: 'Open this to add bookmarks/categories, manage themes, import/export data, and more.' },
                        'permanent-user': { title: 'User Info', text: 'This shows your current username. Click to interact if you want to to change your name or edit your card.' },
                        'search-bar': { title: 'Search', text: 'Quickly find any bookmark by typing its title, URL, or description. Categories filter automatically.' },
                        'category-card': { title: 'Category', text: 'A category for your bookmarks. Drag to reorder. Hover to see edit and delete options.' },
                        'bookmark-item': { title: 'Bookmark', text: 'A single bookmark. Click to open the link. Drag to reorder or drag and drop to another category.' },
                        'add-category': { title: 'Add Category', text: 'Click here to open a modal and create a new category for your bookmarks.' },
                        'main-title': { title: 'Header', text: 'The main header. On the right, you can see live stats for your total number of bookmarks and categories.' },
                        'add-bookmark-menu': { title: 'Add Bookmark', text: 'Use this form to add a new bookmark to one of your existing categories.' },
                        'add-category-menu': { title: 'Add Category', text: 'Use this form to create a new category with a name, description, and baked in icon.' },
                        'trust-factor-menu': { title: 'Trust Factor', text: 'Quickly manage the trust status (e.g., Risky, Trusted) for all your bookmarks in one place.' },
                        'theme-customizer-menu': { title: 'Theme Customizer', text: 'Change the primary and secondary colors of the project interface in real time.' },
                        'saved-themes-menu': { title: 'Saved Themes', text: 'Apply, manage, and reorder your saved themes, or revert to the default one.' },
                        'data-management-menu': { title: 'Data Management', text: 'Import, export, or completely delete all application data, including bookmarks and themes.' },
                    };
                    this.init();
                }

                init() {
                    this.createTooltipElement();
                    document.body.addEventListener('mouseover', this.handleMouseOver.bind(this));
                    document.body.addEventListener('mouseout', this.handleMouseOut.bind(this));
                }

                createTooltipElement() {
                    this.tooltipElement = document.createElement('div');
                    this.tooltipElement.className = 'custom-tooltip tutorial-tooltip';
                    document.body.appendChild(this.tooltipElement);
                }

                handleMouseOver(e) {
                    if (!this.enabled) return;
                    const target = e.target.closest('[data-tutorial-title]');
                    if (target) {
                        clearTimeout(this.showTimeout);
                        this.showTimeout = setTimeout(() => {
                            if (target.matches(':hover')) {
                                this.activeTarget = target;
                                this.showTooltip(target, target.getAttribute('data-tutorial-title'));
                            }
                        }, 700);
                    } else {
                        const richTarget = e.target.closest('[data-tutorial-key]');
                        if (richTarget) {
                            clearTimeout(this.showTimeout);
                             this.showTimeout = setTimeout(() => {
                                if (richTarget.matches(':hover')) {
                                    this.activeTarget = richTarget;
                                    const key = richTarget.dataset.tutorialKey;
                                    const content = this.tutorials[key];
                                    if(content) this.showTooltip(richTarget, content.text, content.title);
                                }
                            }, 150);
                        }
                    }
                }
                
                handleMouseOut() {
                    clearTimeout(this.showTimeout);
                    if (this.activeTarget) {
                        this.hideTooltip();
                        this.activeTarget = null;
                    }
                }
                
                showTooltip(target, text, title = null) {
                    if (title) {
                        this.tooltipElement.classList.remove('custom-tooltip');
                        this.tooltipElement.classList.add('tutorial-tooltip');
                        this.tooltipElement.innerHTML = `<div class="tutorial-title">${title}</div><div class="tutorial-text">${text}</div>`;
                    } else {
                        this.tooltipElement.classList.remove('tutorial-tooltip');
                        this.tooltipElement.classList.add('custom-tooltip');
                        this.tooltipElement.textContent = text;
                    }
                    
                    this.tooltipElement.classList.add('visible');

                    const targetRect = target.getBoundingClientRect();
                    const tooltipRect = this.tooltipElement.getBoundingClientRect();
                    const margin = 10;
                    const vpPadding = 10;

                    let top, left;
                     if (title) {
                        const positions = {
                            right: { top: targetRect.top + targetRect.height / 2 - tooltipRect.height / 2, left: targetRect.right + margin, fits: targetRect.right + tooltipRect.width + margin < window.innerWidth - vpPadding },
                            left: { top: targetRect.top + targetRect.height / 2 - tooltipRect.height / 2, left: targetRect.left - tooltipRect.width - margin, fits: targetRect.left - tooltipRect.width - margin > vpPadding },
                            bottom: { top: targetRect.bottom + margin, left: targetRect.left + targetRect.width / 2 - tooltipRect.width / 2, fits: targetRect.bottom + tooltipRect.height + margin < window.innerHeight - vpPadding },
                            top: { top: targetRect.top - tooltipRect.height - margin, left: targetRect.left + targetRect.width / 2 - tooltipRect.width / 2, fits: targetRect.top - tooltipRect.height - margin > vpPadding }
                        };
                        let pos = positions.right.fits ? positions.right : positions.left.fits ? positions.left : positions.bottom.fits ? positions.bottom : positions.top;
                        top = pos.top;
                        left = pos.left;
                        this.tooltipElement.style.transform = '';
                    } else {
                        top = targetRect.bottom + margin;
                        left = targetRect.left + targetRect.width / 2;
                        if (top + tooltipRect.height > window.innerHeight - vpPadding) {
                           top = targetRect.top - tooltipRect.height - margin;
                        }
                        this.tooltipElement.style.transform = 'translateX(-50%)';
                    }
                    
                    top = Math.max(vpPadding, Math.min(top, window.innerHeight - tooltipRect.height - vpPadding));
                    left = Math.max(vpPadding, Math.min(left, window.innerWidth - tooltipRect.width - vpPadding));
                    
                    this.tooltipElement.style.top = `${top}px`;
                    this.tooltipElement.style.left = `${left}px`;
                }

                hideTooltip() {
                    this.tooltipElement.classList.remove('visible');
                }

                toggle(enabled) {
                    this.enabled = enabled;
                    localStorage.setItem('tutorial_enabled', this.enabled);
                    if (!this.enabled) this.hideTooltip();
                }

                loadState() {
                    return localStorage.getItem('tutorial_enabled') === 'true';
                }
            }

            class ThemeManager {
                constructor(appManager) { this.appManager = appManager; this.themes = this.loadData('saved_themes', []); this.MAX_THEMES = 50; }
                loadData(key, defaultValue) { try { const data = localStorage.getItem(key); return data ? JSON.parse(data) : defaultValue; } catch (e) { console.error(`Error loading ${key}:`, e); return defaultValue; } }
                saveData(key, data) { try { localStorage.setItem(key, JSON.stringify(data)); hasUnsavedChanges = true; } catch (e) { console.error(`Error saving ${key}:`, e); } }
                saveCurrentTheme() { if (this.themes.length >= this.MAX_THEMES) { alert(`Cannot save theme. The maximum of ${this.MAX_THEMES} themes has been reached.`); return; } const themeName = prompt("Enter a name for this theme:", "My Custom Theme"); if (themeName && themeName.trim() !== "") { const newTheme = { id: `theme_${Date.now()}`, name: themeName.trim(), primary: document.getElementById('primaryColorPicker').value, secondary: document.getElementById('secondaryColorPicker').value, }; this.themes.push(newTheme); this.saveData('saved_themes', this.themes); this.renderThemes(); alert(`Theme "${newTheme.name}" saved!`); } }
                editTheme(themeId) { const theme = this.themes.find(t => t.id === themeId); if (!theme) return; const content = `<button class="modal-close-btn" onclick="closeModal()">×</button><h2>Edit Theme</h2><div class="form-group"><label for="editThemeName">Theme Name:</label><input type="text" id="editThemeName" value="${theme.name}" required></div><div class="form-group"><label for="editThemePrimary">Primary Color:</label><input type="color" id="editThemePrimary" class="color-picker-input" value="${theme.primary}"></div><div class="form-group"><label for="editThemeSecondary">Secondary Color:</label><input type="color" id="editThemeSecondary" class="color-picker-input" value="${theme.secondary}"></div><button class="btn" onclick="window.bookmarkManager.themeManager.updateThemeFromModal('${themeId}')">Save Changes</button>`; showModal(content); }
                updateThemeFromModal(themeId) { const themeIndex = this.themes.findIndex(t => t.id === themeId); if (themeIndex === -1) return; const newName = document.getElementById('editThemeName').value.trim(); const newPrimary = document.getElementById('editThemePrimary').value; const newSecondary = document.getElementById('editThemeSecondary').value; if (newName) { this.themes[themeIndex].name = newName; this.themes[themeIndex].primary = newPrimary; this.themes[themeIndex].secondary = newSecondary; this.saveData('saved_themes', this.themes); this.renderThemes(); closeModal(); } else { alert("Theme name cannot be empty."); } }
                deleteTheme(themeId) { const theme = this.themes.find(t => t.id === themeId); if(theme && confirm(`Are you sure you want to delete the theme "${theme.name}"?`)) { this.themes = this.themes.filter(t => t.id !== themeId); this.saveData('saved_themes', this.themes); this.renderThemes(); } }
                renderThemes() { const container = document.getElementById('savedThemesList'); const countEl = document.getElementById('themeCount'); container.innerHTML = ''; countEl.textContent = `(${this.themes.length}/${this.MAX_THEMES})`; if (this.themes.length === 0) { container.innerHTML = `<p class="no-category-msg">No saved themes. Customize and save one!</p>`; } else { this.themes.forEach(theme => { const item = document.createElement('div'); item.className = 'saved-theme-item'; item.dataset.id = theme.id; item.style.background = `linear-gradient(135deg, ${theme.primary}, ${theme.secondary})`; item.innerHTML = `<span class="theme-name-bubble" title="${theme.name}">${theme.name}</span><div class="theme-actions"><button class="btn-bookmark-action btn-bookmark-edit" data-tutorial-title="Edit Theme">Edit</button><button class="btn-bookmark-action btn-bookmark-delete" data-tutorial-title="Delete Theme">Delete</button></div>`; item.addEventListener('click', (e) => { if (!e.target.closest('button')) { this.appManager.applyTheme(theme.primary, theme.secondary); document.getElementById('primaryColorPicker').value = theme.primary; document.getElementById('secondaryColorPicker').value = theme.secondary; } }); item.querySelector('.btn-bookmark-edit').addEventListener('click', (e) => { e.stopPropagation(); this.editTheme(theme.id); }); item.querySelector('.btn-bookmark-delete').addEventListener('click', (e) => { e.stopPropagation(); this.deleteTheme(theme.id); }); container.appendChild(item); }); } this.renderExportCheckboxes(); if (!this.sortable) { this.initSortable(container); } }
                initSortable(container) { if (this.sortable) this.sortable.destroy(); this.sortable = new Sortable(container, { animation: 150, ghostClass: 'sortable-ghost', chosenClass: 'sortable-chosen', onEnd: (evt) => { const newOrderIds = Array.from(evt.to.children).map(c => c.dataset.id).filter(id => id); this.themes.sort((a, b) => newOrderIds.indexOf(a.id) - newOrderIds.indexOf(b.id)); this.saveData('saved_themes', this.themes); } }); }
                renderExportCheckboxes() { const container = document.getElementById('export-theme-list-container'); container.innerHTML = ''; this.themes.forEach(theme => { container.innerHTML += `<div class="export-item"><span>${theme.name}</span><button class="btn-toggle-select" data-id="${theme.id}">Select</button></div>`; }); }
                exportThemes(type) { let dataToExport = []; let filename = ''; const dateStr = new Date().toISOString().split('T')[0]; if (type === 'all') { dataToExport = this.themes; filename = `themes_all_${dateStr}.xanth`; } else if (type === 'selected') { const selectedIds = Array.from(document.querySelectorAll('#export-theme-list-container .btn-toggle-select.selected')).map(btn => btn.dataset.id); if (selectedIds.length === 0) { alert('Please select at least one theme to export.'); return; } dataToExport = this.themes.filter(t => selectedIds.includes(t.id)); filename = `themes_selected_${dateStr}.xanth`; } else { return; } const exportObject = { version: '1.0', type: 'themes_v1', exportDate: new Date().toISOString(), user_card_data: this.appManager.loadData('user_card_data', null), data: dataToExport }; const blob = new Blob([JSON.stringify(exportObject, null, 2)], { type: 'application/json' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(a.href); alert(`${dataToExport.length} theme(s) exported successfully!`); }
            }
            
            class BookmarkManager {
                constructor() {
                    this.categories = this.loadData('categories', []);
                    this.themeManager = new ThemeManager(this);
                    this.tutorialManager = new TutorialManager(); 
                    this.selectedIcon = null;
                    this.selectedCategoryIcon = null;
                    this.currentAboutPanelIndex = 0;
                    this.aboutPanelsData = [];
                    this.aboutPanelCleanup = null;
                    this.specialUserCards = {};
                    this.appVersion = '0.4.4';
                    this.premiumEffects = this.getPremiumEffectsList();
                    this.init();
                }

                init() {
                    this.initAboutPanelData();
                    this.loadAndApplyTheme();
                    this.handleWelcomeScreen();
                    this.bindEvents();
                    this.initIconPickerTooltip();
                    this.render();
                    this.updateStats();
                }

                hexToRgb(hex) {
                    if(!hex) return '255, 107, 53';
                    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                    return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : '255, 107, 53';
                }
                
                initAboutPanelData() {
                    const contributors = [ 
                        { name: 'X A N N I E', nameAliases: ['xannie'], role: 'DEV', description: 'Made this project out of boredom xd', avatar: 'https://i.imgur.com/0Kc0Nux.png', cardBackgroundFront: null, cardBackgroundBack: null, cardRarity: 'lime', themeColor: '#abff4f', overlayImage: 'url(https://i.imgur.com/H8y49ON.png', particleImage: 'https://i.imgur.com/H8y49ON.png', badges: [{ type: 'promo_lime', rarity: 'lime', location: 'front'}, { type: 'lime2', rarity: 'shiny', location: 'back' }] },
                        { name: 'voohvn', nameAliases: ['voo'], role: 'CONTRIBUTOR', description: 'Contributed To The Idea For a Theme System', avatar: 'https://i.imgur.com/fKXWWSP.png', cardBackgroundFront: `url('https://i.imgur.com/HckXHZ4.gif')`, cardBackgroundBack: `'https://i.imgur.com/HckXHZ4.gif')`, cardRarity: 'shiny', themeColor: '#9bf6ff', overlayImage: null, particleImage: null, badges: [{ type: 'voo', rarity: 'shiny', location: 'back' }, { type: 'ody', rarity: 'holographic', location: 'back' }] },
                        { name: 'cxndyflip', nameAliases: ['cxndy'], role: 'TESTER', description: 'First Person To Ever Test This Project', avatar: 'https://i.imgur.com/66MrAcU.png', cardBackgroundFront: `url('https://i.imgur.com/EGW0Gyr.gif')`, cardBackgroundBack: `url('https://i.imgur.com/KaKv7el.gif')`, cardRarity: 'holographic', themeColor: '#546bf0', overlayImage: null, particleImage: null, badges: [{ type: 'cxndy', rarity: 'uncommon', location: 'back' }] }
                    ];
                    
                    contributors.forEach(c => { this.specialUserCards[c.name.toLowerCase()] = c; if(c.nameAliases) { c.nameAliases.forEach(alias => { this.specialUserCards[alias.toLowerCase()] = c; }); } });
                    
                    const generateSparkles = () => { let html = ''; for (let i = 0; i < 25; i++) { html += '<div class="sparkle"></div>'; } return html; };
                    
                    const tutorialToggleHTML = `
                        <div style="border-top: 1px solid var(--border-color); margin-top: 20px; padding-top: 20px; display: flex; align-items: center; justify-content: space-between;">
                            <strong style="font-size: 1.1rem;">Enable Interactive Tutorial</strong>
                            <label class="toggle-switch">
                                <input type="checkbox" id="tutorialToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <p style="font-size: 0.9rem; color: var(--text-muted); margin-top: 8px;">
                            Hover over elements to learn about their functionality and features. You can always change this later in the "How to Use" section of the About menu.
                        </p>`;
                        
                    this.aboutPanelsData = [
                        { title: 'Description & Purpose', content: `<h3>Information regarding this project</h3><p>This is a fully client-sided bookmark manager. All data is securely stored in your browser’s local storage, meaning it never leaves your computer. You can import or export your data at any time via the Data Management section in the menu. You might be wondering what's the point of this? Lately, I’ve noticed a lot of websites and threads getting taken down. This tool lets you localize and preserve what you already have (or may find in the future), so you can continue sharing pirated content with others through loadable files. Said files are already a huge stylized part in this project.</p>` },
                        { 
    title: 'Changelog', 
    content: `<h3>Version Updates</h3>
<p><strong>v0.4.4 - Final Update ?</strong></p><ul><li>Finally fixed all special user card effects.</li><li>Removed 2 card effects that were not worth fixing.</li></ul>
<p><strong>v0.4.3 – Finalizing</strong></p><ul><li>Final code optimizations were made (there still might be some leftover non-functional code features or non critical errors in code that were overlooked or just left in).</li><li>Some things are still unfinished or broken but there is nothing significant or critical interrupting the proper functionality of this project.</li><li>Gutted out code comments (unfathomable 😱).</li><li>Everything that is broken can be found in the "Issues & Upcoming Fixes/Updates" page in the About section.</li></ul>
<p><strong>v0.4.2 – Insignificant change</strong></p><ul><li>Hooked the recognized name in the special user card creation menu to the color of the card now it shifts color in real time based on the color picker.</li></ul>
<p><strong>v0.4.1 – Toast</strong></p><ul><li>Added Toast notifications (notification bubbles) in both card creation systems displaying the icon applied to the card and text based on action.</li></ul>
<p><strong>v0.4.0 – Special User Deluxe</strong></p><ul><li>Now the special user card creation system has been upgraded to a more feature rich one.</li><li>It has its own respective exclusive effects (some are currently extremely broken and missing proper logic and I don't have the will to fix them for now xd).</li><li>Credits to Simon Goellner (@simeydotme) for creating this <a href="https://github.com/simeydotme/pokemon-cards-css" target="_blank">pokemon-cards-css</a> which I used to get ideas from and have a better understanding on how to create the special user card effects on my end.</li><li>Now special user cards have been properly fixed to display the new implemented effects in the import screen.</li></ul>
<p><strong>v0.3.9 – Minor Additions</strong></p><ul><li>Replaced old tooltips with the new basic modern ones used in the tutorial system for hovering over icons in the icon picker.</li><li>Completely eliminated the old tooltip upon hovering over bookmark descriptions.</li><li>Implemented a new more stylized tooltip for bookmark descriptions that recognizes length and looks identical to the basic tooltips of the tutorial system.</li><li>Both features are always enabled and do not interact with the tutorial system.</li></ul>
<p><strong>v0.3.8 – Addition to the tutorial system</strong></p><ul><li>Improved stylized info boxes making them more dynamic using a standalone idle animation.</li><li>Added stylized info boxes inside the burger menu.</li></ul>
<p><strong>v0.3.7 – Introduced a New Tutorial System</strong></p><ul><li>Now new users are prompted with a screen giving them the opportunity to enable interactive tutorials.</li><li>Interactive tutorials have been made rich in visual representation.</li><li>Implemented different more basic tooltips for hovering over buttons.</li><li>Added a delay to tooltips for hovering over buttons.</li><li>Fixed spacing for stylized information boxes to make them more compact and visually pleasing.</li></ul>
<p><strong>v0.3.6 – Polishing Furthermore</strong></p><ul><li>Fixed live card preview for all user types in the card editor.</li><li>Corrected the UI for the permanent user info box to use hover then click for actions and fixed centering.</li><li>Re-implemented the general badge picker for special users, alongside their personalized badges.</li><li>Fixed all badge selection logic, live preview rendering, and toast notifications.</li></ul>
<p><strong>v0.3.5 – Patches to Previously Implemented Features</strong></p><ul><li>Fixed live card preview for all user types in the card editor.</li><li>Corrected the UI for the permanent user info box to use hover then click for actions and fixed centering.</li><li>Re Implemented the general badge picker for special users, alongside their personalized badges.</li><li>Fixed all badge selection logic, live preview rendering, and toast notifications.</li><li>Implemented a new custom, theme aware tooltip for long bookmark descriptions.</li><li>Introduced a new onboarding prompt for the tutorial system.</li></ul>
<p><strong>v0.3.4 – Badge'o Plenty</strong></p><ul><li>Boosted the count of custom badges from 20 to 100 for users to pick from.</li></ul>
<p><strong>v0.3.3 – Adjustments to how systems interact with each other</strong></p><ul><li>Fixed a critical bug that caused a blank screen when new users agreed to create a user card.</li><li>The card creation modal now appears and functions correctly with a live preview.</li><li>Added missing logic for updating the permanent user display and changing usernames.</li><li>The custom user card now correctly appears on exported files and is shown during import.</li></ul>
<p><strong>v0.3.2 – A new addition to the introduction system</strong></p><ul><li>Now new users are met with a stylized screen prompt allowing them to accept or decline the creation of their user card.</li><li>Users who accept are brought to their respective card creation menu.</li><li>Users who refuse are automatically assigned a default card with their username applied to it.</li></ul>
<p><strong>v0.3.1 – New system improvements</strong></p><ul><li>Made a stylish visually appealing display for the cards in the import system.</li><li>Added the project logo on top of the text with its own personalized animation.</li><li>Reworked theme logic allowing the text logo and button to follow the card's color scheme instead of the earlier tests where the user theme was prioritized.</li><li>Ensured that imported cards work correctly with all their properties both for special users and regular users.</li></ul>
<p><strong>v0.3.0 – Introducing a new system</strong></p><ul><li>Now user cards are displayed when importing both themes and bookmarks.</li></ul>
<p><strong>v0.2.9 – Even further fixes and improvements for special user cards</strong></p><ul><li>Fixed an issue with inherited properties preventing special user cards to display badges and back text in the live preview.</li><li>Resolved a logic problem with special user badges conflicting with regular badges allowing special users to apply more than 3 badges on the back and more than 1 badge to the face of cards.</li><li>Implemented missing logic for personalized badges to correspond to their respectful side of the card.</li></ul>
<p><strong>v0.2.8 – Further Fixes for Special Users Card system</strong></p><ul><li>Fixed a bug where applied badges were improperly displayed on the back and front.</li><li>Now special user cards inherit their features from the special user card system.</li></ul>
<p><strong>v0.2.7 – Fixes and Features To The New Card systems</strong></p><ul><li>Resolved an issue in poorly thought out logic causing the inability for special users to pick a front facing badge if 3 back badges are applied and vice versa.</li><li>Completely reworked cycling logic for special user card badges so now badges can be applied without interfering with each other.</li></ul>
<p><strong>v0.2.6 – Card Creation Systems Scrapped and rebuilt</strong></p><ul><li>Now card systems have their own personal properties.</li><li>Both card systems were completely restructured from bare bone while managing to withhold the urge to kms in the process xd</li><li>Each system now works adequately and does not create issues for the other.</li></ul>
<p><strong>v0.2.5 – Card Creation Logic Remaster</strong></p><ul><li>Semi-split card logic into two for regular users and special users so they share some properties but not all.</li><li>Optimized entire structure in terms of card creation modals and their logic for better readability.</li><li>Introduced new badge containers for special users based on their own respected badges.</li><li>Completely broke the card creation systems 😭</li></ul>
<p><strong>v0.2.4 – Pain</strong></p><ul><li>Came to the conclusion that shared card logic does not properly handle data for special users compared to regular users.</li><li>Tried multiple different approaches to resolve the issue none worked 💀</li><li>Found an approach that works but creates further issues down the road in regard of card creation logic for both user classes.</li><li>Sleep xd</li></ul>
<p><strong>v0.2.3 – New Card Creation logic</strong></p><ul><li>Now special users and regular users share the card creation logic.</li><li>Improved core functionality of the logic to prevent further issues with how data is handled for user classes.</li><li>Fixed text input fields not displaying text and applying images to the cards in real time.</li></ul>
<p><strong>v0.2.2 – System Bug Fixes</strong></p><ul><li>Fixed an occurring issue with how recognized user data is handled in logic.</li><li>Resolved an issue where users would not be recognized by the system when data is reset.</li><li>Fixed text animation issues making the recognized user prompt softlock not letting the user move to the main page.</li></ul>
<p><strong>v0.2.1 – Implementations To The New System</strong></p><ul><li>Now recognized users are greeted with their prompt screen rather than using the old basic pop up prompt.</li><li>Reworked user recognition to be able to recognize special users regardless of username capitalization.</li></ul>
<p><strong>v0.2.0 – User System Rewrite</strong></p><ul><li>Completely rewrote and redesigned le user system.</li><li>Entirely new welcome screen.</li><li>Added a more modern design to the welcoming prompt.</li><li>Implemented a typing animation when welcomed.</li><li>Now username falls down and is preserved on the main page.</li><li>Implemented the ability for the user to change names.</li></ul>
<p><strong>v0.1.7 – Special User Recognition System</strong></p><ul><li>Now Special Users Are Recognized By The Welcoming System.</li><li>Tweaked Recognition To Display Their Username Rather Than Their Status.</li></ul>
<p><strong>v0.1.6 – Quick fix</strong></p><ul><li>Fixed an issue with contributor cards opting in to follow color regulations from theme instead of their own.</li></ul>
<p><strong>v0.1.5 – Minor Visual Tweaks</strong></p><ul><li>Implemented separators to the "Trust Factor" category in the burger menu.</li><li>Improved separator design for separators in "Trust Factor".</li><li>Fixed an issue where icon buttons would be completely white unless hovered over instead of respecting the color scheme.</li></ul>
<p><strong>v0.1.4 – Visual Readjustments</strong></p><ul><li>Added the possibility to expand and retract the search bar to minimize visual clutter.</li><li>Moved displays for bookmark and category count on top of the title banner.</li><li>Fixed a small issue making the search button move to the right when hovered over.</li><li>Redesigned search bar expansion button to have a circular shape more fitting for the current visual style of the project.</li></ul>
<p><strong>v0.1.3 – Design Flaw Corrections</strong></p><ul><li>Made icons respect the color theme by using a mask over colored pixels.</li><li>Now the user color theme can be saved Through the "Quick Save" button.</li></ul>
<p><strong>v0.1.2 – Complete Design Overhaul</strong></p><ul><li>A full rewrite of how colors are handled.</li><li>Added the possibility for the user to make his own color theme.</li><li>Reworked contributor card logic.</li></ul>
<p><strong>v0.1.1 – Trust Factor Finalized</strong></p><ul><li>Fixed the "About" section with a clean, arrow-based navigation system.</li><li>Redesigned multi-category export using themed toggle buttons.</li><li>Reworked "bake in" functionality for local icons that remain in exported files.</li><li>Remade the Previously Seen "Admin Panel" into an interactive "Trust Factor" section.</li><li>Fixed several critical bugs from previous updates.</li></ul>
<p><strong>v0.1.0 – UX Rework</strong></p><ul><li>Replaced native drag & drop with SortableJS for smoother reordering.</li><li>Switched bookmark buttons to clean text-based ones (“Edit”, “Delete”).</li><li>Added local icon picker when editing categories.</li><li>Improved import logic to preserve existing category order.</li></ul>
<p><strong>v0.0.9 – Quality of Life</strong></p><ul><li>Added multiple tier status options for bookmarks to easily mark sites based on trust and priority.</li><li>Added the ability to edit a bookmark's status directly from the edit modal itself.</li></ul>
<p><strong>v0.0.8 – Visual Overhaul</strong></p><ul><li>Implemented custom cards and badges for contributors and testers.</li><li>Enabled use of gifs on stylized cards for custom unique looks.</li><li>Added fallback system for icons: will auto-load from URL if local icons are missing or misnamed.</li><li>Fixed layering conflict with 2.5D/3D visual effects.</li><li>Completely reworked contributor/tester section in the About panel.</li></ul>
<p><strong>v0.0.7 – Icon System and 2.5D/Tilt Effects</strong></p><ul><li>Added 20 stylized icons stored locally and referenced from the HTML directory.</li><li>Added 2.5D effect to icons and the About section.</li><li>Made possible icon “bake in” through the burger menu directly to the config.</li><li>Fixed broken button functionality outside of the burger menu due to some event issues. (this was a pain in the ass to fix xd).</li><li>Fixed requesting https inclusion in links due to it refusing to auto load protocol after le initial fix prior.</li></ul>
<p><strong>v0.0.6 – Drag & Drop System (God Tier Update xd)</strong></p><ul><li>Added drag & drop support for category reordering.</li><li>Added drag & drop support for bookmarks within and between categories.</li><li>Allowed the creation of new categories without the need to open the burger menu every 5 picoseconds.</li></ul>
<p><strong>v0.0.5 – Bookmark Editor Rewrite</strong></p><ul><li>Reworked bookmark editor to use visual status buttons instead of dropdowns.</li><li>Fixed layout breaking issue when bookmark/category names were too long.</li><li>Patched bug where URLs weren’t recognized unless they started with https://.</li><li>Improved how categories and bookmark ratings are handled in le burger menu.</li><li>Fixed cycle buttons for ratings beeing absolutely geeked 💀.</li></ul>
<p><strong>v0.0.4 – Save System and Export Improvements</strong></p><ul><li>Implemented localStorage save system (autosaves data without needing file downloads).</li><li>I do still advise users to ocasionally drop a backup.</li><li>Upgraded export system: now it can export multiple categories at once (instead of one or all).</li><li>Reworked welcome screen to fix softlock when username input was not locked in 😳.</li></ul>
<p><strong>v0.0.3 – Search recognition & Config System</strong></p><ul><li>Added search functionality to filter bookmarks by their name, description or URL.</li><li>Added configuration file support to let users export/import custom categories.</li><li>Implemented the ability to export single categories for sharing/importing.</li></ul>
<p><strong>v0.0.2 – Design & Misc</strong></p><ul><li>Fully reworked UI for a consistent and modern design.</li><li>Added a quick save button (top left corner).</li><li>Added an About button (bottom right).</li><li>Made the entire About section styled to fit le rest of the project visuals.</li></ul>
<p><strong>v0.0.1 – Initial Build</strong></p><ul><li>Wrote a basic skeleton base for the project.</li><li>Added a username system with a welcome prompt that appears on top of the screen.</li><li>Built le burger menu for navigation and access.</li><li>Implemented a category system for bookmarks.</li><li>Dropped the first working design layout.</li></ul>` 
},
                        { title: 'How to Use', content: `<h3>Usage Tips and Interactive Tutorials</h3><ul><h3>How to Use</h3><ul><li><strong>Interactive Tutorials Toggle:</strong> is at the bottom of this page. Scroll all the way down and enable it if you want a more user-friendly tutorial system, providing information about every feature that is missed / not explained in this section.</li><li><strong>Adding Items:</strong> Use the burger menu (☰) to add new bookmarks and categories. Or simply use the modal that lets you create categories from the main screen directly. As for bookmarks you could once again use the burger menu (☰) or you could directly add bookmarks to categories by clicking the + button on the bottom right of your category modals.</li><li><strong>Reordering:</strong> Now i've implemented a drag and drop system to this project, you can simply drag and drop both categories and the bookmarks inside categories. If you prefer you could also expand a category and use the drag and drop function inside the said expanded category.</li><li><strong>Editing:</strong> Hover over a category or bookmark to reveal the "Edit" and "Delete" buttons, or simply use the burger menu (☰) once again.</li><li><strong>Icons:</strong> Icons can be chosen when creating or editing a category from the main screen modals, otherwise you can choose locally hosted icons. Local icons can be 'baked in' configs for portability.</li><li><strong>Expanding:</strong> For categories with more than 3 bookmarks, a scrollbar will appear. You can then use the "Expand" button to view all bookmarks in a bigger scale.</li></ul></li></ul>${tutorialToggleHTML}` },
                        { title: 'Issues & Upcoming Fixes/Updates', content: `<h3>Known Issues & Upcoming Fixes/Updates</h3><p></strong></p><ul><li>Forgot that earlier I copied one of the effect code blocks twice to test different effects. Went too deep, and now they depend on each other. I could rewrite it, but it's unnecessary for a project of this scale, and they do not cause any issues.<li>Minor issue with some of the color pickers for certain special user cards being non responsive due to later on implementations that were not hooked properly.</li><li>Visual error not displaying special user pre applied badges in the card editor's live preview on first time use.</li><li>Extremely poor support for mobile devices. It is functional but clunky as hell scales are wrong, items overlap, interactive tutorials don't disappear unless you click on another button, tooltips render through modals. Usage on mobile is currently not recommended.</li></p><p>Current User: <strong>${localStorage.getItem('bookmarks_username') || 'Guest'}</strong></p>` },
                        {
                            title: 'Contributors & Testers',
                            render: () => { 
                                const lightenColorForGradient = (hex, percent) => { if (!hex) return 'rgb(255,255,255)'; let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16); if (isNaN(r) || isNaN(g) || isNaN(b)) return 'rgb(255,255,255)'; let t = percent < 0 ? 0 : 255, p = percent < 0 ? percent * -1 : percent; r = Math.round((t - r) * p) + r; g = Math.round((t - g) * p) + g; b = Math.round((t - b) * p) + b; return `rgb(${r},${g},${b})`; };
                                const cardsHTML = contributors.map(c => {
                                    const frontBgStyle = c.cardBackgroundFront ? `background-image: ${c.cardBackgroundFront};` : `background-color: #2c2c2c;`;
                                    const backBgStyle = c.cardBackgroundBack ? `background-image: ${c.cardBackgroundBack};` : `background-color: #2c2c2c;`;
                                    const badgesOnFront = c.badges.filter(b => b.location === 'front'); 
                                    const badgesOnBack = c.badges.filter(b => b.location === 'back');
                                    return `<div class="tester-card" data-rarity="${c.cardRarity}"> <div class="tester-card-inner"> <div class="tester-card-front" style="${frontBgStyle}"> <div class="holo-shine-layer"></div> <div class="sparkle-overlay">${generateSparkles()}</div> ${c.overlayImage ? `<div class="custom-overlay" style="background-image: ${c.overlayImage};"></div>` : ''} ${badgesOnFront.map(b => `<img src="${BADGE_TYPES[b.type].img}" class="tester-badge badge-on-front" alt="${b.type} badge">`).join('')} <img src="${c.avatar}" class="tester-image" style="border: 3px solid ${c.themeColor};" alt="${c.name}"> <div class="tester-name" style="background: linear-gradient(45deg, ${c.themeColor}, ${lightenColorForGradient(c.themeColor, 0.5)}); -webkit-background-clip: text; color: transparent;">${c.name}</div> </div> <div class="tester-card-back" style="${backBgStyle}"> <canvas class="particle-canvas"></canvas> <div class="holo-shine-layer"></div> <div class="sparkle-overlay">${generateSparkles()}</div> ${c.overlayImage ? `<div class="custom-overlay" style="background-image: ${c.overlayImage};"></div>` : ''} <div class="role-label" style="background-color:${c.themeColor}aa;">${c.role}</div> <div class="tester-back-content"> <p class="tester-desc" style="color:${c.themeColor};text-shadow: 1px 1px 3px rgba(0,0,0,1);">${c.description || ''}</p> <div class="tester-badge-container">${badgesOnBack.map(b => `<img src="${BADGE_TYPES[b.type].img}" class="tester-badge" data-badge-rarity="${b.rarity}" alt="${b.type} badge" data-particle-img="${c.particleImage || ''}">`).join('')}</div> </div> </div> </div> </div>`;
                                }).join('');
                                return `<h3>Credits</h3><div class="tester-grid">${cardsHTML}</div>`;
                            }
                        }
                    ];
                }
                
                async typewriterEffect(element, text, options) { const { speed = 80, errorChance = 0.05, mistakeCharacterPool = 'abcdef' } = options; element.textContent = ''; for (let i = 0; i < text.length; i++) { await new Promise(resolve => setTimeout(resolve, speed)); if (Math.random() < errorChance) { const randomMistake = mistakeCharacterPool[Math.floor(Math.random() * mistakeCharacterPool.length)]; element.textContent += randomMistake; await new Promise(resolve => setTimeout(resolve, speed * 2)); element.textContent = element.textContent.slice(0, -1); await new Promise(resolve => setTimeout(resolve, speed)); } element.textContent += text[i]; } }
                async handleWelcomeScreen() { const username = localStorage.getItem('bookmarks_username'); const welcomeOverlay = document.getElementById('welcomeOverlay'); const welcomePrompt = document.getElementById('welcome-prompt'); document.body.style.overflow = 'hidden'; if (username) { welcomeOverlay.classList.add('visible'); welcomePrompt.classList.add('visible'); await this.runWelcomeSequence(username, true); } else { const textElement = document.getElementById('typing-text'); const cursor = document.getElementById('typing-cursor'); const formElement = document.getElementById('welcome-input-form'); const inputElement = document.getElementById('usernameInput'); welcomeOverlay.classList.add('visible'); await new Promise(r => setTimeout(r, 100)); welcomePrompt.classList.add('visible'); const greeting = "Welcome!"; await this.typewriterEffect(textElement, greeting, { speed: 120, errorChance: 0, mistakeCharacterPool: "" }); cursor.style.display = 'none'; formElement.classList.add('visible'); inputElement.focus(); } }
                
                async handleWelcomeSubmit() {
                    const newUsername = document.getElementById('usernameInput').value.trim();
                    if (!newUsername) return;
                    localStorage.setItem('bookmarks_username', newUsername);
                    const specialUserCard = this.specialUserCards[newUsername.toLowerCase()];
                    const welcomePrompt = document.getElementById('welcome-prompt');
                    document.getElementById('welcome-input-form').style.display = 'none';
                    const textElement = document.getElementById('typing-text');
                    const logo = document.getElementById('welcome-logo');
                    if (logo) logo.style.display = 'none';

                    if (specialUserCard) {
                        this.saveData('user_card_data', { ...specialUserCard, isCustom: false });
                        this.saveData('user_card_prompt_seen', 'true');
                        await this.typewriterEffect(textElement, `Oh, I know you! You're ${newUsername}, a ${specialUserCard.role} to this site.`, { speed: 60 });
                        await new Promise(r => setTimeout(r, 800));
                        await this.typewriterEffect(textElement, `We've already set up your personalized user card.`, { speed: 60 });
                        await new Promise(r => setTimeout(r, 1000));
                        this.runWelcomeSequence(newUsername, false, true);
                    } else if (!this.loadData('user_card_prompt_seen')) {
                        this.saveData('user_card_prompt_seen', 'true');
                        const defaultCard = this.createDefaultUserCard(newUsername);
                        this.saveData('user_card_data', defaultCard);
                        welcomePrompt.style.transition = 'opacity 0.4s ease';
                        welcomePrompt.style.opacity = 0;
                        setTimeout(() => this.showCardCreationPrompt(welcomePrompt), 400);
                    } else {
                        this.runWelcomeSequence(newUsername, false, false);
                    }
                }
                
                showCardCreationPrompt(promptContainer) {
                    const promptHTML = `<div class="prompt-container"> <h2 style="font-size: 1.8rem; margin-bottom: 20px;">Create your User Card?</h2> <p style="color: var(--text-light); max-width: 500px; margin: 0 auto 30px;">This card gets baked into exported files so others see who shared them!</p> <div><button id="createCardYes" class="themed-prompt-button">Yes!</button><button id="createCardNo" class="themed-prompt-button secondary">NO?</button></div> </div>`;
                    promptContainer.innerHTML = promptHTML;
                    promptContainer.style.opacity = 1;
                    const yesBtn = document.getElementById('createCardYes');
                    const noBtn = document.getElementById('createCardNo');
                    this.apply3dHoverEffect(yesBtn, yesBtn, {maxRotate: 10, scale: 1.05});
                    this.apply3dHoverEffect(noBtn, noBtn, {maxRotate: 10, scale: 1.05});
                    
                    yesBtn.onclick = () => {
                        this.showCardCreatorModal();
                        const originalCloseModal = window.closeModal;
                        window.closeModal = () => {
                            originalCloseModal();
                            this.showTutorialPrompt();
                            window.closeModal = originalCloseModal;
                        };
                    };
                    noBtn.onclick = () => this.declineCardCreation();
                }
                
                declineCardCreation() {
                    const username = localStorage.getItem('bookmarks_username');
                    const defaultCard = this.createDefaultUserCard(username);
                    this.saveData('user_card_data', defaultCard);
                    this.runWelcomeSequence(username, false, true);
                }

                async runWelcomeSequence(user, isReturning = false, showTutorial = false) {
                    const welcomeOverlay = document.getElementById('welcomeOverlay');
                    const welcomePrompt = document.getElementById('welcome-prompt');
                    const permUserInfo = document.getElementById('permanent-user-info');
                    if (isReturning) { welcomePrompt.classList.add('welcome-back-animation'); const textElement = document.getElementById('typing-text'); if (textElement) { textElement.textContent = ''; await this.typewriterEffect(textElement, `Welcome back, ${user}`, { speed: 80, errorChance: 0.08, mistakeCharacterPool: "zxcvbnm," }); document.getElementById('typing-cursor').style.display = 'none'; } await new Promise(r => setTimeout(r, 800)); }
                    welcomePrompt.style.transition = 'transform 0.8s ease-in-out, opacity 0.8s ease-in-out';
                    const { top, left, width, height } = permUserInfo.getBoundingClientRect();
                    const scaleFactor = 0.2;
                    const xOffset = left - (window.innerWidth / 2) + (width * (1-scaleFactor) ) / 2;
                    const yOffset = top - (window.innerHeight / 2) + (height * (1-scaleFactor)) / 2 + 50; 
                    welcomePrompt.style.transform = `translate(${xOffset}px, ${yOffset}px) scale(${scaleFactor})`;
                    welcomePrompt.style.opacity = 0;
                    
                    await new Promise(resolve => setTimeout(resolve, 800));
                    welcomeOverlay.style.opacity = 0;
                    setTimeout(() => { welcomeOverlay.innerHTML = ''; welcomeOverlay.classList.remove('visible'); }, 500);

                    const appContainer = document.querySelector('.app-container');
                    appContainer.classList.add('visible');
                    document.body.style.overflow = 'auto';
                    this.updatePermanentUser(user);
                    permUserInfo.classList.add('visible');
                    
                    if (showTutorial) {
                        this.showTutorialPrompt();
                    }
                }
                
                showTutorialPrompt() {
                    const overlay = document.getElementById('tutorialPromptOverlay');
                    overlay.innerHTML = `<div class="prompt-container">
                        <h2 style="font-size: 1.8rem; margin-bottom: 20px;">Enable Interactive Tutorials?</h2>
                        <p style="color: var(--text-light); max-width: 500px; margin: 0 auto 30px;">
                            Hover over elements to learn about them. You can always change this later in the "How to Use" section of the About menu.
                        </p>
                        <div>
                            <button id="tutorialYes" class="themed-prompt-button">Yes, please!</button>
                            <button id="tutorialNo" class="themed-prompt-button secondary">No, thanks.</button>
                        </div>
                    </div>`;
                    overlay.classList.add('visible');

                    document.getElementById('tutorialYes').onclick = () => {
                        this.tutorialManager.toggle(true);
                        overlay.classList.remove('visible');
                    };
                    document.getElementById('tutorialNo').onclick = () => {
                        this.tutorialManager.toggle(false);
                        overlay.classList.remove('visible');
                    };
                }

                updatePermanentUser(username) { const userDisplay = document.querySelector('#permanent-user-info .user-display-name'); const versionDisplay = document.getElementById('appVersion'); if(userDisplay) userDisplay.textContent = username; if(versionDisplay) versionDisplay.textContent = `v${this.appVersion}`; }
                
                handleChangeUsername() {
                    const currentUsername = localStorage.getItem('bookmarks_username') || '';
                    const newUsername = prompt("Enter a new username:", currentUsername);
                    if (newUsername && newUsername.trim() !== "" && newUsername.trim() !== currentUsername) {
                        const trimmedUsername = newUsername.trim();
                        localStorage.setItem('bookmarks_username', trimmedUsername);
                        this.updatePermanentUser(trimmedUsername);
                        const specialUserCardData = this.specialUserCards[trimmedUsername.toLowerCase()];
                        let oldCardData = this.loadData('user_card_data');
                        
                        if (specialUserCardData) {
                            this.saveData('user_card_data', { ...specialUserCardData, isCustom: false });
                            alert(`Oh hello, ${trimmedUsername}! Your special ${specialUserCardData.role} user card has been applied.`);
                        } else {
                            if (oldCardData && oldCardData.isCustom) {
                                oldCardData.name = trimmedUsername;
                                this.saveData('user_card_data', oldCardData);
                            } else {
                                this.saveData('user_card_data', this.createDefaultUserCard(trimmedUsername));
                            }
                            alert("Username updated. Your name on the card has been changed automatically.");
                        }
                        this.saveAndRerender();
                    }
                }
                
                bindEvents() {
                    document.getElementById('saveButton').addEventListener('click', () => this.handleSaveButtonClick());
                    document.getElementById('burgerButton').addEventListener('click', (e) => { e.stopPropagation(); this.toggleBurgerMenu(); });
                    document.getElementById('overlay').addEventListener('click', () => this.closeBurgerMenu());
                    document.getElementById('addBookmarkForm').addEventListener('submit', (e) => { e.preventDefault(); this.addBookmark(); });
                    document.getElementById('addCategoryForm').addEventListener('submit', (e) => { e.preventDefault(); this.addCategory(); });
                    document.getElementById('searchInput').addEventListener('input', (e) => this.search(e.target.value));
                    document.getElementById('exportSelectedBtn').addEventListener('click', () => this.exportData('multiple'));
                    document.getElementById('exportAllBtn').addEventListener('click', () => this.exportData('all'));
                    document.getElementById('importBtn').addEventListener('click', () => document.getElementById('importFile').click());
                    document.getElementById('importFile').addEventListener('change', (e) => this.importData(e));
                    document.getElementById('deleteAllDataBtn').addEventListener('click', () => this.deleteAllData());
                    document.getElementById('aboutButton').addEventListener('click', () => this.showAboutModal());
                    
                    const permUserInfoContainer = document.getElementById('permanent-user-info');
                    if (permUserInfoContainer) {
                        permUserInfoContainer.addEventListener('mouseenter', () => permUserInfoContainer.classList.add('hovering'));
                        permUserInfoContainer.addEventListener('mouseleave', () => permUserInfoContainer.classList.remove('hovering'));
                        permUserInfoContainer.querySelector('.user-display-name-container').addEventListener('click', () => permUserInfoContainer.classList.toggle('actions-expanded'));
                    }
                    const actionsContainer = document.getElementById('permanent-user-info-actions');
                    actionsContainer.innerHTML = `<button id="permEditCardBtn" class="perm-user-action-btn">Edit User Card</button><button id="permChangeUserBtn" class="perm-user-action-btn">Change Username</button>`;
                    document.getElementById('permChangeUserBtn').addEventListener('click', () => this.handleChangeUsername());
                    document.getElementById('permEditCardBtn').addEventListener('click', () => { this.showCardCreatorModal(true); });

                    document.addEventListener('click', (e) => { if (!e.target.closest('.burger-menu') && !e.target.closest('.modal-overlay')) { this.closeBurgerMenu(); } });
                    document.getElementById('dataManagement-content').addEventListener('click', (e) => { if (e.target.classList.contains('btn-toggle-select')) { const container = e.target.closest('.export-list-container'); if (container && (container.id === 'export-list-container' || container.id === 'export-theme-list-container')) { e.target.classList.toggle('selected'); e.target.textContent = e.target.classList.contains('selected') ? 'Selected' : 'Select'; } } });
                    document.getElementById('trustFactor-content').addEventListener('click', (e) => { const cycleButton = e.target.closest('.btn-status-cycle'); if(cycleButton) { const bookmarkId = cycleButton.dataset.bookmarkId; this.cycleTrustFactor(bookmarkId); return; } const categoryHeader = e.target.closest('.trust-factor-category h4'); if (categoryHeader) { const bookmarkList = categoryHeader.nextElementSibling; bookmarkList.style.display = bookmarkList.style.display === 'block' ? 'none' : 'block'; } });
                    const iconUploadArea = document.getElementById('iconUploadArea');
                    const iconFileInput = document.getElementById('iconFileInput');
                    iconUploadArea.addEventListener('click', () => iconFileInput.click());
                    iconUploadArea.addEventListener('dragover', (e) => { e.preventDefault(); iconUploadArea.classList.add('dragover'); });
                    iconUploadArea.addEventListener('dragleave', () => iconUploadArea.classList.remove('dragover'));
                    iconUploadArea.addEventListener('drop', (e) => { e.preventDefault(); iconUploadArea.classList.remove('dragover'); this.handleIconUpload(e.dataTransfer.files[0]); });
                    iconFileInput.addEventListener('change', (e) => { if (e.target.files[0]) this.handleIconUpload(e.target.files[0]); });
                    document.getElementById('primaryColorPicker').addEventListener('input', (e) => this.applyTheme(e.target.value, null));
                    document.getElementById('secondaryColorPicker').addEventListener('input', (e) => this.applyTheme(null, e.target.value));
                    document.getElementById('saveThemeBtn').addEventListener('click', () => this.themeManager.saveCurrentTheme());
                    document.getElementById('resetThemeBtn').addEventListener('click', () => this.resetTheme());
                    document.getElementById('exportAllThemesBtn').addEventListener('click', () => this.themeManager.exportThemes('all'));
                    document.getElementById('exportSelectedThemesBtn').addEventListener('click', () => this.themeManager.exportThemes('selected'));
                    document.getElementById('searchToggleBtn').addEventListener('click', () => { document.getElementById('searchBarContainer').classList.toggle('expanded'); document.getElementById('searchToggleBtn').classList.toggle('expanded'); }); 
                }

                toggleBurgerMenu() { const menu = document.getElementById('burgerMenuContent'); const overlay = document.getElementById('overlay'); const isVisible = menu.style.display === 'block'; menu.style.display = isVisible ? 'none' : 'block'; overlay.style.display = isVisible ? 'none' : 'block'; if (isVisible) { document.querySelectorAll('.menu-section-content.expanded').forEach(c => { c.classList.remove('expanded'); c.style.display = 'none';}); document.querySelectorAll('.menu-section-indicator.expanded').forEach(i => i.classList.remove('expanded')); } }
                closeBurgerMenu() { document.getElementById('burgerMenuContent').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; }
                getCategoryByName(name) { return this.categories.find(c => c.name.toLowerCase() === name.toLowerCase()); }
                addCategory() { const nameInput = document.getElementById('newCategoryInput'); const descInput = document.getElementById('newCategoryDescInput'); const categoryName = nameInput.value.trim(); const categoryDesc = descInput.value.trim(); if (!categoryName) { alert('Please enter a category name'); return; } if (this.getCategoryByName(categoryName)) { alert('Category already exists'); return; } this.categories.push({ id: `cat_${Date.now()}`, name: categoryName, description: categoryDesc, icon: this.selectedIcon || '', bookmarks: [] }); this.saveAndRerender(); nameInput.value = ''; descInput.value = ''; document.getElementById('iconPreview').innerHTML = ''; this.selectedIcon = null; alert('Category added successfully!'); this.closeBurgerMenu(); }
                addBookmark(categoryNameOverride = null) { const inModal = !!categoryNameOverride; let title, url, description, formToReset, categoryName; if (inModal) { categoryName = categoryNameOverride; title = document.getElementById('titleInputModal').value.trim(); url = document.getElementById('urlInputModal').value.trim(); description = document.getElementById('descriptionInputModal').value.trim(); } else { const selectedCategoryElement = document.querySelector('#addBookmarkCategoryList .selected'); categoryName = selectedCategoryElement ? selectedCategoryElement.dataset.name : null; title = document.getElementById('titleInput').value.trim(); url = document.getElementById('urlInput').value.trim(); description = document.getElementById('descriptionInput').value.trim(); formToReset = document.getElementById('addBookmarkForm'); } if (!categoryName || !title || !url) { alert('Please fill in all required fields (Category, Title, and URL)'); return; } if (url && !/^https?:\/\//i.test(url)) { url = 'https://' + url; } const category = this.getCategoryByName(categoryName); if (!category) { alert('Category not found!'); return; } let faviconUrl = ''; try { const domain = new URL(url).hostname; faviconUrl = `https://www.google.com/s2/favicons?domain=${domain}&sz=64`; } catch (e) { console.warn("Could not parse URL for favicon."); } category.bookmarks.push({ id: `bm_${Date.now()}`, title, url, description, status: '', favicon: faviconUrl, createdAt: new Date().toISOString() }); this.saveAndRerender(); if(inModal){ closeModal(); } else { formToReset.reset(); const currentSelection = document.querySelector('#addBookmarkCategoryList .selected'); if(currentSelection) currentSelection.classList.remove('selected'); alert('Bookmark added successfully!'); } }
                showEditBookmarkModal(categoryId, bookmarkId) { const category = this.categories.find(c => c.id === categoryId); const bookmark = category?.bookmarks.find(b => b.id === bookmarkId); if (!bookmark) return; const status = bookmark.status || ''; const classMap = { '': 'none', '❌': 'risky', '❔': 'unverified', '✅': 'trusted', '🐐': 'goat' }; const textMap = { '': 'No Status', '❌': '❌ Risky', '❔': '❔ Unverified', '✅': '✅ Trusted', '🐐': '🐐 GOAT' }; const buttonClass = `btn-status-cycle status-${classMap[status]}`; const buttonText = textMap[status]; const content = ` <button class="modal-close-btn" onclick="closeModal()">×</button> <h2>Edit Bookmark</h2> <div class="form-group"> <label>Title:</label> <input type="text" id="editBookmarkTitle" value="${bookmark.title}" required> </div> <div class="form-group"> <label>URL:</label> <input type="text" id="editBookmarkUrl" value="${bookmark.url}" required> </div> <div class="form-group"> <label>Description:</label> <textarea id="editBookmarkDesc" rows="3">${bookmark.description || ''}</textarea> </div> <div class="form-group"> <label>Status:</label> <button type="button" id="modalStatusButton" class="${buttonClass}" data-status="${status}" onclick="window.bookmarkManager.cycleModalStatusButton(this)"> ${buttonText} </button> </div> <button class="btn" onclick="window.bookmarkManager.updateBookmark('${categoryId}', '${bookmarkId}')">Save Changes</button>`; showModal(content); }
                cycleModalStatusButton(buttonElement) { const statuses = ['', '❌', '❔', '✅', '🐐']; const classMap = { '': 'none', '❌': 'risky', '❔': 'unverified', '✅': 'trusted', '🐐': 'goat' }; const textMap = { '': 'No Status', '❌': '❌ Risky', '❔': '❔ Unverified', '✅': '✅ Trusted', '🐐': '🐐 GOAT' }; const currentStatus = buttonElement.dataset.status; const currentIndex = statuses.indexOf(currentStatus); const nextIndex = (currentIndex + 1) % statuses.length; const newStatus = statuses[nextIndex]; buttonElement.dataset.status = newStatus; buttonElement.className = `btn-status-cycle status-${classMap[newStatus]}`; buttonElement.textContent = textMap[newStatus]; }
                updateBookmark(categoryId, bookmarkId) { const category = this.categories.find(c => c.id === categoryId); const bookmark = category?.bookmarks.find(b => b.id === bookmarkId); if (!bookmark) return; bookmark.title = document.getElementById('editBookmarkTitle').value.trim(); let url = document.getElementById('editBookmarkUrl').value.trim(); bookmark.description = document.getElementById('editBookmarkDesc').value.trim(); bookmark.status = document.getElementById('modalStatusButton').dataset.status; if (url && !/^https?:\/\//i.test(url)) { url = 'https://' + url; } bookmark.url = url; try { bookmark.favicon = `https://www.google.com/s2/favicons?domain=${new URL(bookmark.url).hostname}&sz=64`; } catch(e) { bookmark.favicon = ''; } this.saveAndRerender(); closeModal(); }
                showAddCategoryModal() { this.selectedCategoryIcon = null; const content = `<button class="modal-close-btn" onclick="closeModal()">×</button> <h2>Add New Category</h2> <div class="form-group"> <label>Category Name:</label> <input type="text" id="editCategoryName" value="" required placeholder="Enter category name"> </div> <div class="form-group"> <label>Category Description:</label> <input type="text" id="editCategoryDesc" value="" placeholder="Brief category description"> </div> ${this.renderIconPicker(null)} <button class="btn" onclick="window.bookmarkManager.addCategoryFromModal()">Add Category</button>`; showModal(content); this.initIconPickerHoverEffects(); }
                addCategoryFromModal() { const nameInput = document.getElementById('editCategoryName'); const descInput = document.getElementById('editCategoryDesc'); const categoryName = nameInput.value.trim(); const categoryDesc = descInput.value.trim(); if (!categoryName) { alert('Please enter a category name'); return; } if (this.getCategoryByName(categoryName)) { alert('Category with this name already exists.'); return; } this.categories.push({ id: `cat_${Date.now()}`, name: categoryName, description: categoryDesc, icon: this.selectedIcon || '', bookmarks: [] }); this.saveAndRerender(); closeModal(); alert('Category added successfully!'); }
                showEditCategoryModal(categoryId) { const category = this.categories.find(c => c.id === categoryId); if (!category) return; this.selectedCategoryIcon = category.icon; const content = `<button class="modal-close-btn" onclick="closeModal()">×</button><h2>Edit Category</h2><div class="form-group"><label>Category Name:</label><input type="text" id="editCategoryName" value="${category.name}" required></div><div class="form-group"><label>Category Description:</label><input type="text" id="editCategoryDesc" value="${category.description || ''}"></div>${this.renderIconPicker(category.icon)}<button class="btn" onclick="window.bookmarkManager.updateCategory('${categoryId}')">Save Changes</button>`; showModal(content); this.initIconPickerHoverEffects(); }
                updateCategory(categoryId) { const category = this.categories.find(c => c.id === categoryId); if (!category) return; const newName = document.getElementById('editCategoryName').value.trim(); if (!newName) { alert('Category name cannot be empty.'); return; } const oldName = category.name; if (newName.toLowerCase() !== oldName.toLowerCase() && this.getCategoryByName(newName)) { alert('Another category with this name already exists.'); return; } category.name = newName; category.description = document.getElementById('editCategoryDesc').value.trim(); category.icon = this.selectedCategoryIcon; this.saveAndRerender(); closeModal(); }
                deleteBookmark(categoryId, bookmarkId) { if (!confirm('Are you sure you want to delete this bookmark?')) return; const catIndex = this.categories.findIndex(c => c.id === categoryId); if (catIndex > -1) { this.categories[catIndex].bookmarks = this.categories[catIndex].bookmarks.filter(b => b.id !== bookmarkId); this.saveAndRerender(); } }
                deleteCategory(categoryId) { const category = this.categories.find(c => c.id === categoryId); if (!confirm(`Are you sure you want to delete the entire "${category.name}" category and all its bookmarks?`)) return; this.categories = this.categories.filter(c => c.id !== categoryId); this.saveAndRerender(); }
                deleteAllData() { if (confirm("Are you sure you want to delete ALL data? This includes categories, bookmarks, themes, username, and active theme settings.")) { if (confirm("This action CANNOT be undone. Are you absolutely sure?")) { if (confirm("FINAL WARNING: This will permanently wipe all application data.")) { localStorage.clear(); location.reload(); } } } }
                search(query) { const lowerCaseQuery = query.toLowerCase(); document.querySelectorAll('.category').forEach(categoryElem => { let categoryHasVisibleBookmarks = false; categoryElem.querySelectorAll('.bookmark').forEach(bookmarkElem => { const bookmark = this.getBookmarkFromElement(bookmarkElem); if (bookmark) { const isVisible = bookmark.title.toLowerCase().includes(lowerCaseQuery) || (bookmark.description && bookmark.description.toLowerCase().includes(lowerCaseQuery)) || bookmark.url.toLowerCase().includes(lowerCaseQuery); bookmarkElem.style.display = isVisible ? 'flex' : 'none'; if (isVisible) categoryHasVisibleBookmarks = true; } }); categoryElem.style.display = categoryHasVisibleBookmarks || lowerCaseQuery === '' ? 'block' : 'none'; }); const placeholder = document.querySelector('.add-category-placeholder'); if (placeholder) { placeholder.style.display = lowerCaseQuery === '' ? 'flex' : 'none'; } }
                getBookmarkFromElement(element) { const bookmarkId = element.dataset.id; for (const category of this.categories) { const found = category.bookmarks.find(b => b.id === bookmarkId); if (found) return found; } return null; }
                render() {
                    const container = document.getElementById('categoriesContainer');
                    container.innerHTML = '';
                    this.renderDropdowns();
                    this.categories.forEach((category) => {
                        let categoryIconHTML;
                        if (category.icon && !category.icon.trim().startsWith('<svg')) { const filename = category.icon.split('/').pop(); const fallbackUrl = localIconFallbacks[filename]; const styleString = `style="-webkit-mask-image: url('${category.icon}'), url('${fallbackUrl}'); mask-image: url('${category.icon}'), url('${fallbackUrl}');"`; const innerMaskHTML = `<div class="category-image-mask" ${styleString}></div>`; categoryIconHTML = `<div class="category-icon">${innerMaskHTML}</div>`; } else { let iconContent = ''; if (category.icon) { iconContent = category.icon; } else { iconContent = `<span>${category.name.charAt(0).toUpperCase()}</span>`; } categoryIconHTML = `<div class="category-icon has-content-bg">${iconContent}</div>`; }
                        const jsEscapedCategoryName = category.name.replace(/\\/g, '\\\\').replace(/'/g, "\\'");
                        const categoryDiv = document.createElement('div');
                        categoryDiv.className = 'category';
                        categoryDiv.setAttribute('data-id', category.id);
                        categoryDiv.setAttribute('data-tutorial-key', 'category-card');
                        const isScrollable = category.bookmarks.length > 3;
                        categoryDiv.innerHTML = `<div class="category-header">${categoryIconHTML}<div class="category-title-group"><h2>${category.name}</h2>${category.description ? `<p class="category-description">${category.description}</p>` : ''}</div><div class="category-actions"><button class="btn-text btn-edit" data-tutorial-title="Edit Category" onclick="window.bookmarkManager.showEditCategoryModal('${category.id}')">Edit</button><button class="btn-text btn-delete" data-tutorial-title="Delete Category" onclick="window.bookmarkManager.deleteCategory('${category.id}')">Delete</button></div></div><div class="bookmark-grid ${isScrollable ? 'scrollable' : ''}">${category.bookmarks.map(b => this.renderBookmark(b, category.id)).join('')}</div><div class="category-footer-actions">${isScrollable ? `<button class="btn-expand" data-tutorial-title="Expand to see all bookmarks" onclick="window.bookmarkManager.showExpandCategoryModal('${category.id}')">Expand</button>` : ''}<button class="btn-add" data-tutorial-title="Add Bookmark to ${category.name}" onclick="window.bookmarkManager.showAddBookmarkModal('${jsEscapedCategoryName}')">+</button></div>`;
                        container.appendChild(categoryDiv);
                    });
                    const placeholder = document.createElement('div');
                    placeholder.className = 'add-category-placeholder';
                    placeholder.setAttribute('data-tutorial-key', 'add-category');
                    const text = this.categories.length === 0 ? "No categories found.<br>Add your first one to start!" : "Add New Category";
                    placeholder.innerHTML = `<div class="add-category-plus">+</div><p>${text}</p>`;
                    placeholder.onclick = () => this.showAddCategoryModal();
                    container.appendChild(placeholder);
                    this.initHoverEffects();
                    this.initCategorySortable();
                    this.initBookmarkSortables();
                }
                renderBookmark(bookmark, categoryId) { return `<a href="${bookmark.url}" class="bookmark" target="_blank" data-id="${bookmark.id}" data-tutorial-key="bookmark-item"><div class="bookmark-icon" style="background-image: url('${bookmark.favicon}')">${!bookmark.favicon ? bookmark.title.charAt(0).toUpperCase() : ''}</div><div class="bookmark-content"><div class="bookmark-title">${bookmark.title} <span class="bookmark-status">${bookmark.status || ''}</span></div><div class="bookmark-description" data-description="${bookmark.description || ''}">${bookmark.description || ''}</div></div><div class="bookmark-actions"><button class="btn-bookmark-action btn-bookmark-edit" data-tutorial-title="Edit Bookmark" onclick="event.preventDefault(); window.bookmarkManager.showEditBookmarkModal('${categoryId}', '${bookmark.id}')">Edit</button><button class="btn-bookmark-action btn-bookmark-delete" data-tutorial-title="Delete Bookmark" onclick="event.preventDefault(); window.bookmarkManager.deleteBookmark('${categoryId}', '${bookmark.id}')">Delete</button></div></a>`; }
                renderDropdowns() { this.renderExportCheckboxes(); this.themeManager.renderThemes(); this.renderTrustFactorPanel(); const listContainer = document.getElementById('addBookmarkCategoryList'); listContainer.innerHTML = ''; if (this.categories.length === 0) { listContainer.innerHTML = `<p class="no-category-msg">Please create a category first.</p>`; } else { this.categories.forEach(category => { const item = document.createElement('button'); item.type = 'button'; item.className = 'category-select-item'; item.textContent = category.name; item.dataset.name = category.name; listContainer.appendChild(item); }); } }
                renderExportCheckboxes() { const container = document.getElementById('export-list-container'); container.innerHTML = ''; this.categories.forEach(category => { container.innerHTML += `<div class="export-item"><span>${category.name}</span><button class="btn-toggle-select" data-id="${category.id}">Select</button></div>`; }); }
                updateStats() { const totalBookmarks = this.categories.reduce((total, cat) => total + cat.bookmarks.length, 0); document.getElementById('totalBookmarks').textContent = totalBookmarks; document.getElementById('totalCategories').textContent = this.categories.length; }
                saveAndRerender() { this.saveData('categories', this.categories); this.render(); this.updateStats(); hasUnsavedChanges = true; }
                renderTrustFactorPanel() { const container = document.getElementById('trust-factor-container'); container.innerHTML = ''; if(this.categories.length === 0){ container.innerHTML = `<p style="text-align:center; color: var(--text-muted); padding: 20px' 0;">No bookmarks found.</p>`; return; } this.categories.forEach(cat => { const catDiv = document.createElement('div'); catDiv.className = 'trust-factor-category'; const title = document.createElement('h4'); title.textContent = cat.name; catDiv.appendChild(title); const bookmarkList = document.createElement('div'); bookmarkList.className = 'trust-factor-bookmarks'; if (cat.bookmarks.length > 0) { cat.bookmarks.forEach(bm => { const itemDiv = document.createElement('div'); itemDiv.className = 'trust-factor-bookmark-item'; const nameSpan = document.createElement('span'); nameSpan.textContent = bm.title; nameSpan.title = bm.title; const statusButton = this.createStatusButton(bm.status, bm.id); itemDiv.appendChild(nameSpan); itemDiv.appendChild(statusButton); bookmarkList.appendChild(itemDiv); }); } else { bookmarkList.innerHTML = `<p style="font-style: italic; color: var(--text-muted); font-size: 0.9rem;">No bookmarks in this category.</p>`; } catDiv.appendChild(bookmarkList); container.appendChild(catDiv); }); }
                createStatusButton(status, bookmarkId) { const button = document.createElement('button'); const classMap = { '': 'none', '❌': 'risky', '❔': 'unverified', '✅': 'trusted', '🐐': 'goat' }; const textMap = { '': 'No Status', '❌': '❌ Risky', '❔': '❔ Unverified', '✅': '✅ Trusted', '🐐': '🐐 GOAT' }; const currentStatus = textMap.hasOwnProperty(status) ? status : ''; button.className = `btn-status-cycle status-${classMap[currentStatus]}`; button.textContent = textMap[currentStatus]; button.dataset.bookmarkId = bookmarkId; return button; }
                cycleTrustFactor(bookmarkId) { const statuses = ['', '❌', '❔', '✅', '🐐']; const classMap = { '': 'none', '❌': 'risky', '❔': 'unverified', '✅': 'trusted', '🐐': 'goat' }; const textMap = { '': 'No Status', '❌': '❌ Risky', '❔': '❔ Unverified', '✅': '✅ Trusted', '🐐': '🐐 GOAT' }; let bookmark; for (const cat of this.categories) { const found = cat.bookmarks.find(bm => bm.id === bookmarkId); if (found) { bookmark = found; break; } } if (bookmark) { const currentIndex = statuses.indexOf(bookmark.status); const nextIndex = (currentIndex + 1) % statuses.length; const newStatus = statuses[nextIndex]; bookmark.status = newStatus; this.saveData('categories', this.categories); hasUnsavedChanges = true; const bookmarkElementOnPage = document.querySelector(`.bookmark[data-id="${bookmarkId}"]`); if (bookmarkElementOnPage) { const statusSpan = bookmarkElementOnPage.querySelector('.bookmark-status'); if (statusSpan) { statusSpan.textContent = newStatus || ''; } } const trustPanelButton = document.querySelector(`#trustFactor-content .btn-status-cycle[data-bookmark-id="${bookmarkId}"]`); if(trustPanelButton) { trustPanelButton.className = `btn-status-cycle status-${classMap[newStatus]}`; trustPanelButton.textContent = textMap[newStatus]; } } }
                showAboutModal() {
                    this.currentAboutPanelIndex = 0;
                    const modalContent = document.createElement('div');
                    modalContent.id = 'aboutModalContent';
                    modalContent.innerHTML = ` <button class="modal-close-btn" onclick="closeModal()">×</button> <h2 id="about-title" style="text-align:center; color: var(--primary-color); margin-bottom: 20px;"></h2> <div class="about-modal-body"> <div class="about-panels-container"></div> <button class="about-arrow left" onclick="window.bookmarkManager.navigateAboutPanel('prev')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg></button> <button class="about-arrow right" onclick="window.bookmarkManager.navigateAboutPanel('next')"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg></button> </div>`;
                    const panelsContainer = modalContent.querySelector('.about-panels-container');
                    this.aboutPanelsData.forEach((panelData, index) => {
                        const panel = document.createElement('div'); panel.className = 'about-panel'; panel.dataset.index = index;
                        if (typeof panelData.render === 'function') { panel.innerHTML = panelData.render(); } 
                        else { panel.innerHTML = panelData.content; }
                        panelsContainer.appendChild(panel);
                    });
                    showModal(''); document.getElementById('genericModalContent').appendChild(modalContent);
                    
                    const tutorialToggle = document.getElementById('tutorialToggle');
                    if (tutorialToggle) {
                        tutorialToggle.checked = this.tutorialManager.enabled;
                        tutorialToggle.addEventListener('change', (e) => {
                            this.tutorialManager.toggle(e.target.checked);
                        });
                    }

                    this.updateAboutPanels();
                }
                
                initAboutPanelEffects() { if (this.aboutPanelCleanup) this.aboutPanelCleanup(); const container = document.querySelector('.about-panels-container'); if (!container) return; let cardInstances = []; const panelMouseMoveHandler = e => { const activePanel = container.querySelector(`.about-panel[data-index='${this.currentAboutPanelIndex}']`); if (activePanel && !activePanel.querySelector('.tester-grid')) { const rect = container.getBoundingClientRect(); const x = e.clientX - rect.left - rect.width / 2; const y = e.clientY - rect.top - rect.height / 2; const rotateY = (x / (rect.width / 2)) * 5; const rotateX = -(y / (rect.height / 2)) * 5; activePanel.style.transition = 'transform 0.05s linear'; activePanel.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) translateX(0%)`; } }; const panelMouseLeaveHandler = () => { const activePanel = container.querySelector(`.about-panel[data-index='${this.currentAboutPanelIndex}']`); if (activePanel && !activePanel.querySelector('.tester-grid')) { activePanel.style.transition = 'transform 0.4s ease-out'; activePanel.style.transform = `translateX(0%)`; } }; container.addEventListener('mousemove', panelMouseMoveHandler); container.addEventListener('mouseleave', panelMouseLeaveHandler); document.querySelectorAll('.about-panels-container .tester-card').forEach(card => { cardEffectsManager.initCardEffects(card); const cardParticleSystem = Object.create(cardEffectsManager.particleSystem); const particleCanvas = card.querySelector('.particle-canvas'); cardParticleSystem.init(particleCanvas); const cardDesc = card.querySelector('.tester-desc'); const cardInner = card.querySelector('.tester-card-inner'); const cardMouseMoveHandler = e => { if (card.dataset.isFlipping === 'true') return; const rect = card.getBoundingClientRect(); const x = e.clientX - rect.left - rect.width / 2; const y = e.clientY - rect.top - rect.height / 2; const rotateY = (x / (rect.width / 2)) * 20; const rotateX = -(y / (rect.height / 2)) * 20; const flipTransform = card.classList.contains('flipped') ? 'rotateY(180deg) ' : ''; const hoverTransform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`; cardInner.style.transition = 'transform 0.05s linear'; cardInner.style.transform = flipTransform + hoverTransform; }; const cardMouseLeaveHandler = () => { cardInner.style.transition = 'transform 0.4s ease-out'; cardInner.style.transform = card.classList.contains('flipped') ? 'rotateY(180deg)' : 'rotateY(0deg)'; }; const cardClickHandler = () => { card.dataset.isFlipping = 'true'; card.classList.add('is-hover-locked'); const isFlippingToBack = !card.classList.contains('flipped'); card.classList.toggle('flipped'); cardInner.style.transition = 'transform 0.6s ease-out'; cardInner.style.transform = card.classList.contains('flipped') ? 'rotateY(180deg)' : 'rotateY(0deg)'; card.querySelectorAll('.tester-badge').forEach(b => b.classList.remove('pulsing')); if(cardDesc) cardDesc.classList.remove('pulsing'); if (isFlippingToBack) { setTimeout(() => { if (card.classList.contains('flipped')) { cardEffectsManager.animateBadgesSequentially(card); card.querySelectorAll('.tester-badge').forEach(b => b.classList.add('pulsing')); if (cardDesc) cardDesc.classList.add('pulsing'); card.querySelectorAll('.tester-badge-container .tester-badge').forEach(b => { cardParticleSystem.emit(b, b.dataset.badgeRarity, b.dataset.particleImg, true); }); if (cardParticleSystem.particles.length > 0 && !cardParticleSystem.active) { cardParticleSystem.updateAndDraw(); } } }, 350); } setTimeout(() => { card.dataset.isFlipping = 'false'; card.classList.remove('is-hover-locked'); }, 650); }; card.addEventListener('mousemove', cardMouseMoveHandler); card.addEventListener('mouseleave', cardMouseLeaveHandler); card.addEventListener('click', cardClickHandler); cardInstances.push({ card, cardMouseMoveHandler, cardMouseLeaveHandler, cardClickHandler }); }); this.aboutPanelCleanup = () => { container.removeEventListener('mousemove', panelMouseMoveHandler); container.removeEventListener('mouseleave', panelMouseLeaveHandler); cardInstances.forEach(({ card, cardMouseMoveHandler, cardMouseLeaveHandler, cardClickHandler }) => { card.removeEventListener('mousemove', cardMouseMoveHandler); card.removeEventListener('mouseleave', cardMouseLeaveHandler); card.removeEventListener('click', cardClickHandler); }); cardInstances = []; }; }
                navigateAboutPanel(direction) { if (direction === 'next') { this.currentAboutPanelIndex = (this.currentAboutPanelIndex + 1) % this.aboutPanelsData.length; } else { this.currentAboutPanelIndex = (this.currentAboutPanelIndex - 1 + this.aboutPanelsData.length) % this.aboutPanelsData.length; } this.updateAboutPanels(); }
                updateAboutPanels() { const titleElem = document.getElementById('about-title'); if (titleElem) { titleElem.textContent = this.aboutPanelsData[this.currentAboutPanelIndex].title; } document.querySelectorAll('.about-panel').forEach((panel, index) => { const offset = index - this.currentAboutPanelIndex; panel.style.transform = `translateX(${offset * 100}%)`; }); setTimeout(() => { this.initAboutPanelEffects(); }, 400); }
                showAddBookmarkModal(categoryName) { const jsEscapedCategoryName = categoryName.replace(/\\/g, '\\\\').replace(/'/g, "\\'"); const content = `<button class="modal-close-btn" onclick="closeModal()">×</button><h2>Add Bookmark to ${categoryName}</h2><form id="addBookmarkModalForm" onsubmit="event.preventDefault();"><div class="form-group"><label for="titleInputModal">Title:</label><input type="text" id="titleInputModal" placeholder="Bookmark title" required></div><div class="form-group"><label for="urlInputModal">URL:</label><input type="text" id="urlInputModal" placeholder="example.com" required></div><div class="form-group"><label for="descriptionInputModal">Description:</label><textarea id="descriptionInputModal" placeholder="Brief description" rows="2"></textarea></div><button type="button" class="btn" onclick="window.bookmarkManager.addBookmark('${jsEscapedCategoryName}')">Add Bookmark</button></form>`; showModal(content); }
                showExpandCategoryModal(categoryId) { const category = this.categories.find(c => c.id === categoryId); if (!category) return; let finalIconHTML; if (category.icon && !category.icon.trim().startsWith('<svg')) { const filename = category.icon.split('/').pop(); const fallbackUrl = localIconFallbacks[filename]; const styleString = `style="-webkit-mask-image: url('${category.icon}'), url('${fallbackUrl}'); mask-image: url('${category.icon}'), url('${fallbackUrl}');"`; const innerMaskHTML = `<div class="category-image-mask" ${styleString}></div>`; finalIconHTML = `<div class="category-icon" style="width: 50px; height: 50px;">${innerMaskHTML}</div>`; } else { let iconContent = ''; if (category.icon) { iconContent = category.icon; } else { iconContent = `<span>${category.name.charAt(0).toUpperCase()}</span>`; } finalIconHTML = `<div class="category-icon has-content-bg" style="width: 50px; height: 50px;">${iconContent}</div>`; } const content = `<button class="modal-close-btn" onclick="closeModal()">×</button><div class="category-header" style="margin-bottom: 20px; border: none; perspective: 1000px;">${finalIconHTML}<div class="category-title-group" style="perspective: 800px;"><h2 style="font-size: 1.8rem;">${category.name}</h2>${category.description ? `<p class="category-description">${category.description}</p>` : ''}</div></div><div class="bookmark-grid" data-id="${categoryId}">${category.bookmarks.map(bookmark => this.renderBookmark(bookmark, category.id)).join('')}</div>`; showModal(content); const modalHeader = document.querySelector('#genericModal .category-header'); if(modalHeader) { this.apply3dHoverEffect(modalHeader, modalHeader.querySelector('.category-icon'), { maxRotate: 15, scale: 1.2 }); this.apply3dHoverEffect(modalHeader, modalHeader.querySelector('.category-title-group h2'), { maxRotate: 5 }); } const modalGrid = document.querySelector('#genericModal .bookmark-grid'); if(modalGrid) { this.initBookmarkSortable(modalGrid); } }
                apply3dHoverEffect(triggerElement, targetElement, options = {}) { if (!triggerElement || !targetElement) return; const { maxRotate = 15, scale = 1.0, perspective = '1000px' } = options; let initialTransform = getComputedStyle(targetElement).transform; if (initialTransform === 'none') { initialTransform = ''; } triggerElement.addEventListener('mousemove', e => { const rect = triggerElement.getBoundingClientRect(); const x = e.clientX - rect.left - rect.width / 2; const y = e.clientY - rect.top - rect.height / 2; const rotateY = (x / (rect.width / 2)) * maxRotate; const rotateX = -(y / (rect.height / 2)) * maxRotate; targetElement.style.transition = 'transform 0.05s linear'; targetElement.style.transform = `${initialTransform} perspective(${perspective}) scale(${scale}) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`; }); triggerElement.addEventListener('mouseleave', () => { targetElement.style.transition = 'transform 0.4s ease-out'; targetElement.style.transform = initialTransform; }); }
                initHoverEffects() { document.querySelectorAll('.category').forEach(category => { this.apply3dHoverEffect(category, category.querySelector('.category-icon'), { maxRotate: 15, scale: 1.4, perspective: '1000px'}); }); document.querySelectorAll('.stat').forEach(stat => { this.apply3dHoverEffect(stat, stat, { maxRotate: 10, scale: 1.05, perspective: '800px'}); this.apply3dHoverEffect(stat, stat.querySelector('.stat-number'), { maxRotate: 10, scale: 1.05, perspective: '800px'}); }); const searchBtn = document.getElementById('searchToggleBtn'); this.apply3dHoverEffect(searchBtn, searchBtn, { maxRotate: 25, scale: 1.1, perspective: '800px' }); const header = document.querySelector('.header'); if(header) { this.apply3dHoverEffect(header, header.querySelector('h1'), { maxRotate: 5, perspective: '800px'}); } }
                
                initIconPickerTooltip() {
                    const tooltip = document.getElementById('iconPickerTooltip');
                    if (!tooltip) return;

                    document.body.addEventListener('mouseover', e => {
                        const item = e.target.closest('.icon-picker-item');
                        if (item) {
                            const title = item.getAttribute('title');
                            if(title){
                                item.setAttribute('data-title-temp', title);
                                item.removeAttribute('title');
                                tooltip.textContent = title;
                                tooltip.classList.add('visible');
                            }
                        }
                    });

                    document.body.addEventListener('mousemove', e => {
                        if (tooltip.classList.contains('visible')) {
                            const x = e.clientX + 15;
                            const y = e.clientY + 15;
                            tooltip.style.left = `${x}px`;
                            tooltip.style.top = `${y}px`;
                        }
                    });

                    document.body.addEventListener('mouseout', e => {
                        const item = e.target.closest('.icon-picker-item');
                        if (item) {
                            const tempTitle = item.getAttribute('data-title-temp');
                             if(tempTitle){
                                item.setAttribute('title', tempTitle);
                                item.removeAttribute('data-title-temp');
                                tooltip.classList.remove('visible');
                            }
                        }
                    });
                }

                initIconPickerHoverEffects() { const pickerItems = document.querySelectorAll('.icon-picker-item'); pickerItems.forEach(item => { this.apply3dHoverEffect(item, item, { maxRotate: 20, scale: 1.2, perspective: '500px'}); }); const grid = document.getElementById('iconPickerGrid'); if (grid) { setTimeout(() => { grid.addEventListener('scroll', window.updateIconPickerArrows); window.updateIconPickerArrows(); }, 0); } }
                initCategorySortable() { const container = document.getElementById('categoriesContainer'); new Sortable(container, { animation: 150, ghostClass: 'sortable-ghost', chosenClass: 'sortable-chosen', filter: '.add-category-placeholder', onEnd: (evt) => { const newOrderIds = Array.from(evt.to.children).map(c => c.dataset.id).filter(id => id); if (newOrderIds.length !== this.categories.length) { this.render(); return; } this.categories.sort((a, b) => newOrderIds.indexOf(a.id) - newOrderIds.indexOf(b.id)); this.saveData('categories', this.categories); hasUnsavedChanges = true; } }); }
                initBookmarkSortables() { const grids = document.querySelectorAll('.bookmark-grid'); grids.forEach(grid => this.initBookmarkSortable(grid)); }
                initBookmarkSortable(gridElement) { new Sortable(gridElement, { group: 'bookmarks', animation: 150, ghostClass: 'sortable-ghost', chosenClass: 'sortable-chosen', onEnd: (evt) => { const bookmarkId = evt.item.dataset.id; const fromCategoryId = evt.from.closest('[data-id]')?.dataset.id; const toCategoryId = evt.to.closest('[data-id]')?.dataset.id; if (!fromCategoryId || !toCategoryId) { console.error("Could not determine source or destination category."); this.render(); return; } const fromCategory = this.categories.find(c => c.id === fromCategoryId); const toCategory = this.categories.find(c => c.id === toCategoryId); if (!fromCategory || !toCategory || !bookmarkId) { this.render(); return; } const bookmarkIndex = fromCategory.bookmarks.findIndex(b => b.id === bookmarkId); if(bookmarkIndex === -1) return; const [movedBookmark] = fromCategory.bookmarks.splice(bookmarkIndex, 1); toCategory.bookmarks.splice(evt.newIndex, 0, movedBookmark); this.saveData('categories', this.categories); hasUnsavedChanges = true; if (fromCategoryId !== toCategoryId) { this.render(); } } }); }
                loadData(key, defaultValue) { try { const data = localStorage.getItem(key); return data ? JSON.parse(data) : defaultValue; } catch (e) { console.error(`Error loading ${key}:`, e); return defaultValue; } }
                saveData(key, data) { try { localStorage.setItem(key, JSON.stringify(data)); } catch (e) { console.error(`Error saving ${key}:`, e); } }
                saveToLocalStorage() { this.saveData('categories', this.categories); this.themeManager.saveData('saved_themes', this.themeManager.themes); this.saveActiveTheme(); hasUnsavedChanges = false; console.log('Data and theme saved to localStorage'); }
                handleSaveButtonClick() { this.saveToLocalStorage(); alert('Data and theme settings have been saved to your browser.'); if (confirm("Would you also like to download a backup copy of your bookmarks?")) { this.exportData('all'); } }
                exportData(type) { let dataToExport = []; let filename = ''; const dateStr = new Date().toISOString().split('T')[0]; if (type === 'all') { dataToExport = this.categories; filename = `bookmarks_all_${dateStr}.xan`; } else if (type === 'multiple') { const selectedIds = Array.from(document.querySelectorAll('#export-list-container .btn-toggle-select.selected')).map(btn => btn.dataset.id); if (selectedIds.length === 0) { alert('Please select at least one category to export.'); return; } dataToExport = this.categories.filter(c => selectedIds.includes(c.id)); filename = `bookmarks_selected_${dateStr}.xan`; } else { return; } const exportObject = { version: '2.1', type: 'bookmarks_v2', exportDate: new Date().toISOString(), user_card_data: this.loadData('user_card_data', null), theme: { primary: document.getElementById('primaryColorPicker').value, secondary: document.getElementById('secondaryColorPicker').value }, data: dataToExport }; const blob = new Blob([JSON.stringify(exportObject, null, 2)], { type: 'application/json' }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(a.href); alert(`${dataToExport.length} categor(y/ies) exported successfully!`); }
                importData(event) { const file = event.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { try { const imported = JSON.parse(e.target.result); const processImport = () => { if (imported.type === 'themes_v1') { this.processThemeImport(imported); } else if (imported.type === 'bookmarks_v2') { this.processBookmarkImport(imported); } else { alert('Error: Unknown or unsupported file format.'); } }; if (imported.user_card_data) { this.showImportedCardScreen(imported.user_card_data, imported.type, processImport); } else { processImport(); } } catch (error) { console.error('Import error:', error); alert('Error importing file.'); } finally { event.target.value = ''; } }; reader.readAsText(file); }
                processThemeImport(imported) { if (confirm('Merge imported themes with existing themes? (Cancel to replace)')) { imported.data.forEach(newTheme => { if(!this.themeManager.themes.some(t => t.id === newTheme.id)) { this.themeManager.themes.push(newTheme); } }); } else { this.themeManager.themes = imported.data; } this.themeManager.saveData('saved_themes', this.themeManager.themes); this.themeManager.renderThemes(); alert('Themes imported successfully!'); }
                processBookmarkImport(imported) { let dataToImport = imported.data; if (confirm('Do you want to merge with existing data? (Cancel to replace all)')) { dataToImport.forEach(newCat => { const existingCat = this.getCategoryByName(newCat.name); if (existingCat) { newCat.bookmarks.forEach(bm => { if(!existingCat.bookmarks.some(exBm => exBm.url === bm.url)) existingCat.bookmarks.push(bm); }); } else { this.categories.push(newCat); } }); } else { this.categories = dataToImport; } if (imported.theme && imported.theme.primary && confirm('This config includes a theme. Do you want to apply it?')) { this.applyTheme(imported.theme.primary, imported.theme.secondary); document.getElementById('primaryColorPicker').value = imported.theme.primary; document.getElementById('secondaryColorPicker').value = imported.theme.secondary; this.saveActiveTheme(); } this.saveAndRerender(); alert('Data imported successfully!'); }
                createDefaultUserCard(username) { return { name: username, role: 'USER', isCustom: true, avatar: 'https://i.imgur.com/djAAX7s.png', themeColor: '#888888', bgColor: '#333333', effects: [], premiumEffects: [], effectColors: {}, badge: null, badgeFront: null, customText: '', cardBackgroundFront: null, cardBackgroundBack: null, holoColor: '#cccccc', shinyColor: '#9bf6ff', overlayImage: null, backTextColor: '#ffffff' }; }
                
                showCardCreatorModal(isUpdate = false) {
                    const username = localStorage.getItem('bookmarks_username');
                    if (!username) return;

                    if (!isUpdate) {
                        const appContainer = document.querySelector('.app-container');
                        const welcomeOverlay = document.getElementById('welcomeOverlay');
                        welcomeOverlay.style.transition = 'opacity 0.5s ease';
                        welcomeOverlay.style.opacity = 0;
                        setTimeout(() => {
                            welcomeOverlay.classList.remove('visible');
                            document.body.style.overflow = 'auto';
                        }, 500);
                        appContainer.classList.add('visible');
                    }

                    const cardData = this.loadData('user_card_data', this.createDefaultUserCard(username));
                    const specialUserCard = this.specialUserCards[username.toLowerCase()];
                    const contentHTML = this.getCardCreatorHTML(username, cardData, specialUserCard);
                    
                    showModal(contentHTML, true);
                    
                    setTimeout(() => {
                        this.initCardCreatorLivePreview();
                        const previewContainer = document.getElementById('creatorPreview');
                        if (previewContainer) {
                             const handleTilt = (e) => {
                                const cardInner = previewContainer.querySelector('.tester-card-inner');
                                if (!cardInner || cardInner.classList.contains('flipping')) return;
                                const rect = previewContainer.getBoundingClientRect();
                                const x = e.clientX - rect.left - rect.width / 2;
                                const y = e.clientY - rect.top - rect.height / 2;
                                const maxRotate = 15;
                                const rotateY = (x / (rect.width / 2)) * maxRotate;
                                const rotateX = -(y / (rect.height / 2)) * maxRotate;
                                let flipTransform = previewContainer.querySelector('.tester-card.flipped') ? 'rotateY(180deg) ' : '';
                                cardInner.style.transition = 'transform 0.05s linear';
                                cardInner.style.transform = `${flipTransform}perspective(1200px) rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
                            };
                            const handleLeave = () => {
                                const cardInner = previewContainer.querySelector('.tester-card-inner');
                                if (!cardInner || cardInner.classList.contains('flipping')) return;
                                let flipTransform = previewContainer.querySelector('.tester-card.flipped') ? 'rotateY(180deg)' : '';
                                cardInner.style.transition = 'transform 0.4s ease-out';
                                cardInner.style.transform = flipTransform;
                            };
                            previewContainer.addEventListener('mousemove', handleTilt);
                            previewContainer.addEventListener('mouseleave', handleLeave);
                        }
                        if (!isUpdate) {
                            this.updatePermanentUser(username);
                            document.getElementById('permanent-user-info').classList.add('visible');
                        }
                    }, 100);
                }
                
                initCardCreatorLivePreview() {
                    const inputs = document.querySelectorAll('#cardCreatorModalContent .card-builder-input');
                    const username = localStorage.getItem('bookmarks_username');
                    const isSpecialUser = !!this.specialUserCards[username?.toLowerCase()];

                    inputs.forEach(input => {
                        const eventType = (input.type === 'color' || input.type === 'range' || input.nodeName === 'TEXTAREA' || (input.type ==='text' || input.type === 'url')) ? 'input' : 'change';
                        input.addEventListener(eventType, () => this.updateCardCreatorPreview());
                    });
                    
                    document.getElementById('creatorCardColor')?.addEventListener('input', (e) => {
                        const nameSpan = document.querySelector('#creator-header-name > span');
                        if (nameSpan) {
                            nameSpan.style.color = e.target.value;
                        }
                    });

                    if (!isSpecialUser) {
                        const holoToggle = document.getElementById('creatorHoloEffect');
                        const sparkleToggle = document.getElementById('creatorSparkleEffect');
                        if (holoToggle && sparkleToggle) {
                            holoToggle.addEventListener('change', () => { if (holoToggle.checked) {sparkleToggle.checked = false; this.updateCardCreatorPreview();} });
                            sparkleToggle.addEventListener('change', () => { if (sparkleToggle.checked) {holoToggle.checked = false; this.updateCardCreatorPreview();} });
                        }
                    }
                    
                    const badgePickers = document.querySelectorAll('.creatorBadgePicker');
                    badgePickers.forEach(picker => {
                        picker.addEventListener('click', (e) => {
                            const item = e.target.closest('.badge-pick-item');
                            if(item) {
                                if (isSpecialUser) {
                                    this.handleSpecialBadgeClick(item);
                                } else {
                                    this.handleNormalBadgeClick(item);
                                }
                            }
                        });
                    });
                    
                    this.updateCardCreatorPreview();
                }

                updateCardCreatorPreview() { const cardData = this.getCardDataFromCreator(); const previewContainer = document.getElementById('livePreviewContainer'); if (previewContainer) { const existingCard = previewContainer.querySelector('.tester-card'); const wasFlipped = existingCard ? existingCard.classList.contains('flipped') : false; previewContainer.innerHTML = this.renderCustomUserCardHTML(cardData); const newCard = previewContainer.querySelector('.tester-card'); if (newCard) { if (wasFlipped) { newCard.classList.add('flipped'); newCard.querySelector('.tester-card-inner').style.transform = 'rotateY(180deg)'; } cardEffectsManager.initCardEffects(newCard); } } }
                
                flipCreatorPreview() {
                    const previewCard = document.querySelector('#livePreviewContainer .tester-card');
                    if (previewCard) {
                        const isFlippingToBack = !previewCard.classList.contains('flipped');
                        const cardInner = previewCard.querySelector('.tester-card-inner');
                        
                        cardInner.classList.add('flipping');
                        previewCard.classList.toggle('flipped');
                        
                        cardInner.style.transition = 'transform 0.6s';
                        cardInner.style.transform = previewCard.classList.contains('flipped') ? 'rotateY(180deg)' : 'rotateY(0deg)';
                        
                        cardInner.addEventListener('transitionend', () => {
                            cardInner.classList.remove('flipping');
                        }, { once: true });

                        const username = localStorage.getItem('bookmarks_username');
                        if (isFlippingToBack && this.specialUserCards[username?.toLowerCase()]) {
                             setTimeout(() => {
                                if (previewCard.classList.contains('flipped')) {
                                    cardEffectsManager.animateBadgesSequentially(previewCard);
                                    previewCard.querySelectorAll('.tester-badge-container .tester-badge').forEach(b => b.classList.add('pulsing'));
                                }
                            }, 350);
                        } else {
                             previewCard.querySelectorAll('.tester-badge-container .tester-badge').forEach(b => b.classList.remove('pulsing'));
                        }
                    }
                }
                
                saveCustomUserCard() {
                    const cardData = this.getCardDataFromCreator();
                    this.saveData('user_card_data', cardData);
                    closeModal();
                    alert('Your user card has been saved!');
                    this.saveAndRerender();
                }
                
                toggleBadgePicker(pickerId) { const picker = document.getElementById(pickerId); const button = picker.nextElementSibling; if (picker && button) { const isExpanding = !picker.classList.contains('expanded'); if (!isExpanding) { picker.scrollTop = 0; } picker.classList.toggle('expanded', isExpanding); button.textContent = isExpanding ? 'Show Less' : 'Show More'; } }
                
                togglePremiumEffects(button) {
                    const content = document.getElementById('premiumEffectsContent');
                    const isExpanding = !content.classList.contains('expanded');
                    content.classList.toggle('expanded', isExpanding);
                    button.textContent = isExpanding ? 'Hide Exclusive Effects' : 'Show Exclusive Effects';
                }

                getPremiumEffectsList() {
                    return [
                        { id: 'vmax', name: 'StarShine', layers: ['effect-vmax'], colors: [{label: 'C1', default: '#ce2a24'}, {label: 'C2', default: '#9dadef'}, {label: 'C3', default: '#2d9992'}] },
                        { id: 'vstar', name: 'EyeMotion', layers: ['effect-vstar', 'effect-vstar-overlay'], colors: [{label: 'C1', default: '#ff7773'}, {label: 'C2', default: '#ffed5f'}, {label: 'C3', default: '#a8ff5f'}] },
                        { id: 'galaxy-shimmer', name: 'StarSpin', layers: ['effect-galaxy-shimmer'], colors: [{label: 'C1', default: '#da3832'}, {label: 'C2', default: '#dbcc56'}, {label: 'C3', default: '#4762cf'}] },
                        { id: 'rainbow-secret', name: 'WavePop', layers: ['effect-rainbow-secret'], colors: [{label: 'C1', default: '#fd4741'},{label: 'C2', default: '#fff397'},{label: 'C3', default: '#a8ff5f'},{label: 'C4', default: '#83fff7'},{label: 'C5', default: '#4bc6ff'},{label: 'C6', default: '#ff49f6'}] },
                        { id: 'gold-secret', name: 'CubeLayer', layers: ['effect-gold-secret'], colors: [{label: 'C1', default: '#592e50'}, {label: 'C2', default: '#d8b75c'}, {label: 'C3', default: '#ffffff'}] },
                        { id: 'trainer-gallery', name: 'EyeSpiral', layers: ['effect-trainer-gallery', 'effect-trainer-gallery-overlay'], colors: [{label: 'C1', default: '#ae66ca'},{label: 'C2', default: '#e44d48'},{label: 'C3', default: '#d8c537'},{label: 'C4', default: '#7cc93e'},{label: 'C5', default: '#50b1aa'},{label: 'C6', default: '#88a0ff'}]},
                        { id: 'radiant-flow', name: 'SeepIn', layers: ['effect-radiant-flow'], colors: [{label: 'C1', default: '#ffA19e'}, {label: 'C2', default: '#55b2ff'}, {label: 'C3', default: '#ffc792'}]},
                        { id: 'illusion', name: 'DogSwing', layers: ['effect-illusion'], colors: [{label: 'C1', default: '#ff7773'}, {label: 'C2', default: '#ffed5f'}, {label: 'C3', default: '#a8ff5f'}] },
                        { id: 'v', name: 'GetOut', layers: ['effect-v', 'effect-v-overlay'], colors: [{label: 'C1', default: '#ff7773'},{label: 'C2', default: '#ffed5f'},{label: 'C3', default: '#a8ff5f'},{label: 'C4', default: '#83fff7'},{label: 'C5', default: '#7894ff'},{label: 'C6', default: '#d875ff'}] },
                        { id: 'v-alt', name: '3DSpace', layers: ['effect-v-alt'], colors: [{label: 'C1', default: '#ff7773'},{label: 'C2', default: '#ffed5f'},{label: 'C3', default: '#a8ff5f'},{label: 'C4', default: '#83fff7'},{label: 'C5', default: '#7894ff'},{label: 'C6', default: '#d875ff'}] },
                        { id: 'trainer-full-art', name: 'OrbGlow', layers: ['effect-trainer-full-art', 'effect-trainer-full-art-overlay'], colors: [{label: 'C1', default: '#ff7773'}, {label: 'C2', default: '#ffed5f'}, {label: 'C3', default: '#a8ff5f'}] },
                        { id: 'rainbow-alt', name: 'HypnoToad', layers: ['effect-rainbow-alt'], colors: [{label: 'C1', default: '#fd4741'},{label: 'C2', default: '#fff397'},{label: 'C3', default: '#a8ff5f'}] },
                        { id: 'gold-alt', name: 'PersonaAhh', layers: ['effect-gold-alt'], colors: [{label: 'C1', default: '#592e50'}, {label: 'C2', default: '#d8b75c'}] },
                        { id: 'radiant-alt', name: 'CellChain', layers: ['effect-radiant-alt'], colors: [{label: 'C1', default: '#ffA19e'}, {label: 'C2', default: '#55b2ff'}]},
                        { id: 'trainer-gallery-v', name: 'CubeTravel', layers: ['effect-trainer-gallery-v', 'effect-trainer-gallery-v-overlay'], colors: [{label: 'C1', default: '#ff7773'}, {label: 'C2', default: '#ffed5f'}]},
                        { id: 'holo-alt', name: 'MissingImage', layers: ['effect-holo-alt'], colors: [{label: 'H1', default: '#ffadad'}, {label: 'H2', default: '#caffbf'}, {label: 'H3', default: '#9bf6ff'}, {label: 'H4', default: '#bdb2ff'}]},
                    ];
                }

                getCardCreatorHTML(username, cardData = {}, specialUserCard = null) {
                    const cleanUrl = (url) => url ? url.replace(/url\(['"]?|['"]?\)/g, '') : '';
                    let headerHTML = ''; 
                    const currentThemeColor = cardData.themeColor || specialUserCard?.themeColor || '#ff6b35';
                    if (specialUserCard) { 
                        headerHTML = `<h2 id="creator-header-name">Oh hello, <span style="color: ${currentThemeColor}">${specialUserCard.name}</span>!</h2><p style="margin-bottom:20px; color:var(--text-muted)">Feel free to customize your special card's appearance.</p>`; 
                    } else { 
                        headerHTML = `<h2>${cardData.isCustom ? 'Edit' : 'Create'} Your User Card</h2><p style="margin-bottom:20px; color:var(--text-muted)">Your username: ${username}</p>`; 
                    }
                    
                    const normalBadgePickerHTML = () => `<div class="form-group"><label>Choose Your Badge (Back):</label><div id="creatorBadgePickerContainer"><div id="creatorBadgePicker" class="creatorBadgePicker">${userBadgeData.map(badge => `<div class="badge-pick-item ${cardData.badge === badge.id ? 'selected-back' : ''}" data-id="${badge.id}" style="background-image:url('${badge.url}')"></div>`).join('')}</div><button type="button" class="btn btn-secondary" onclick="window.bookmarkManager.toggleBadgePicker('creatorBadgePicker')" style="width: 100%; margin-top: 10px;">Show More</button></div></div>`;
                    
                    let badgePickersHTML = '';
                    let effectTogglesHTML = '';

                    if (specialUserCard) {
                        const currentBadges = cardData.badges || specialUserCard.badges || [];
                        const allSpecialBadges = (specialUserCard.badges || []).map(b => ({ ...b, id: b.type, url: BADGE_TYPES[b.type]?.img })).filter(b => b.url);
                        
                        const renderPicker = (id, label, badges, isFrontPicker = false) => {
                            if (!badges || badges.length === 0) return '';
                            return `<div class="form-group" style="flex: 1;"><label>${label}:</label><div id="${id}" class="creatorBadgePicker specialBadgePicker" data-is-front="${isFrontPicker}">${badges.map(b => {
                                const isSelected = currentBadges.some(cb => cb.id === b.id);
                                const className = isSelected ? (isFrontPicker ? 'selected-front' : 'selected-back') : '';
                                return `<div class="badge-pick-item ${className}" data-id="${b.id}" data-location="${b.location}" style="background-image:url('${b.url}')"></div>`;
                            }).join('')}</div></div>`;
                        };
                        
                        const specialBadgeBacks = allSpecialBadges.filter(b => b.location === 'back');
                        const specialBadgeFronts = allSpecialBadges.filter(b => b.location === 'front');

                        const generalBadgePickerHTML = `<div class="form-group"><label>General Badges (Click to cycle placement):</label><div id="generalBadgePickerContainer"><div id="generalBadgePicker" class="creatorBadgePicker">${userBadgeData.map(badge => {
                                const isSelectedBack = currentBadges.some(b => b.type === 'custom' && b.id === badge.id && b.location === 'back');
                                const isSelectedFront = currentBadges.some(b => b.type === 'custom' && b.id === badge.id && b.location === 'front');
                                const className = isSelectedFront ? 'selected-front' : (isSelectedBack ? 'selected-back' : '');
                                return `<div class="badge-pick-item ${className}" data-id="${badge.id}" style="background-image:url('${badge.url}')"></div>`;
                            }).join('')}</div><button type="button" class="btn btn-secondary" onclick="window.bookmarkManager.toggleBadgePicker('generalBadgePicker')" style="width: 100%; margin-top: 10px;">Show More</button></div></div>`;

                        badgePickersHTML = `<div class="form-group"><label>Your Personalized Badges:</label><div style="display:flex; gap: 10px;">
                            ${renderPicker('specialBadgePickerBack', 'Back Badges (Max 3)', specialBadgeBacks, false)}
                            ${renderPicker('specialBadgePickerFront', 'Front Badge (Max 1)', specialBadgeFronts, true)}
                        </div></div>${generalBadgePickerHTML}`;
                        
                        const currentEffects = cardData.premiumEffects || [];
                        const effectColors = cardData.effectColors || {};
                        const premiumEffectsHTML = this.premiumEffects.map(effect => {
                            const colorsHTML = effect.colors.map((color, index) => {
                                const colorKey = color.label.startsWith('H') ? color.label.toLowerCase() : `c${index + 1}`;
                                return `
                                <div class="form-group" style="margin-bottom:0;">
                                    <label>${color.label}:</label>
                                    <input type="color" id="effect-color-${effect.id}-${index}" class="color-picker-input card-builder-input" value="${effectColors[effect.id]?.[colorKey] || color.default}">
                                </div>`;
                            }).join('');
                            return `
                                <div class="effect-entry">
                                    <div class="effect-toggle-row">
                                        <label>${effect.name}</label>
                                        <label class="toggle-switch">
                                            <input type="checkbox" class="card-builder-input" id="effect-toggle-${effect.id}" data-effect-id="${effect.id}" ${currentEffects.includes(effect.id) ? 'checked' : ''}>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                    <div class="effect-colors">${colorsHTML}</div>
                                </div>`;
                        }).join('');

                        effectTogglesHTML = `
                            <div class="premium-effects-container">
                                <div class="premium-effects-header" onclick="window.bookmarkManager.togglePremiumEffects(this.querySelector('button'))">
                                    <h4>Exclusive Effects</h4>
                                    <button type="button" class="btn-expand">Show Exclusive Effects</button>
                                </div>
                                <div class="premium-effects-content" id="premiumEffectsContent">
                                    ${premiumEffectsHTML}
                                </div>
                            </div>
                        `;

                    } else {
                        badgePickersHTML = normalBadgePickerHTML();
                        effectTogglesHTML = `<div style="display: flex; justify-content: space-around; margin: 20px 0;"><div class="form-group inline"><label style="margin-right:10px;">Holo Effect</label><label class="toggle-switch"><input type="checkbox" class="card-builder-input" id="creatorHoloEffect" ${cardData.effects?.includes('holographic') ? 'checked' : ''}><span class="slider"></span></label></div><div class="form-group inline"><label style="margin-right:10px;">Sparkle Effect</label><label class="toggle-switch"><input type="checkbox" class="card-builder-input" id="creatorSparkleEffect" ${cardData.effects?.includes('shiny') ? 'checked' : ''}><span class="slider"></span></label></div></div>`;
                    }
                    
                    const customTextField = specialUserCard ? '' : `<div class="form-group"><label>Back Description:</label><textarea id="creatorCustomText" class="card-builder-input" placeholder="Text for the back of your card" rows="2">${cardData.customText || ''}</textarea></div>`;

                    return `<button class="modal-close-btn" onclick="closeModal()">×</button><div id="cardCreatorModalContent"><div id="creatorControls">${headerHTML}<div class="form-group"><label>Avatar URL (.png/.gif):</label><input type="url" id="creatorAvatar" class="card-builder-input" placeholder="https://i.imgur.com/..." value="${cardData.avatar || ''}"></div><div class="form-group"><label>Front BG URL (.png/.gif):</label><input type="url" id="creatorBgFront" class="card-builder-input" placeholder="https://i.imgur.com/..." value="${cleanUrl(cardData.cardBackgroundFront)}"></div><div class="form-group"><label>Back BG URL (.png/.gif):</label><input type="url" id="creatorBgBack" class="card-builder-input" placeholder="https://i.imgur.com/..." value="${cleanUrl(cardData.cardBackgroundBack)}"></div><div class="form-group"><label>Repeating Overlay URL (.png):</label><input type="url" id="creatorOverlay" class="card-builder-input" placeholder="https://i.imgur.com/..." value="${cleanUrl(cardData.overlayImage)}"></div>
                        ${customTextField}
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                          <div class="form-group" style="margin-bottom:0;"><label>Border/Name Color:</label><input type="color" id="creatorCardColor" class="color-picker-input card-builder-input" value="${currentThemeColor}"></div>
                          <div class="form-group" style="margin-bottom:0;"><label>Back Text Color:</label><input type="color" id="creatorBackTextColor" class="color-picker-input card-builder-input" value="${cardData.backTextColor || '#ffffff'}"></div>
                          <div class="form-group" style="margin-bottom:0;"><label>Background Color:</label><input type="color" id="creatorBgColor" class="color-picker-input card-builder-input" value="${cardData.bgColor || '#2c2c2c'}"></div>
                        </div>
                        ${effectTogglesHTML}
                        ${badgePickersHTML}
                        <button class="btn" onclick="window.bookmarkManager.saveCustomUserCard()" style="width: 100%; font-size: 1.2rem;">Save Card</button></div><div id="creatorPreview"><div id="livePreviewContainer"></div><button type="button" class="icon-picker-arrow left" onclick="window.bookmarkManager.flipCreatorPreview()" style="opacity:1; position:absolute; top:50%; left:10px; transform: translateY(-50%);">‹</button><button type="button" class="icon-picker-arrow right" onclick="window.bookmarkManager.flipCreatorPreview()" style="opacity:1; position:absolute; top:50%; right:10px; transform: translateY(-50%);">›</button></div></div>`;
                }

                getCardDataFromCreator() {
                    const username = localStorage.getItem('bookmarks_username');
                    const specialUserCard = this.specialUserCards[username?.toLowerCase()];
                    const isSpecialUser = !!specialUserCard;

                    const getUrl = (id) => { const val = document.getElementById(id)?.value; return val ? `url('${val}')` : null; };
                    
                    let cardData = {
                        name: username,
                        avatar: document.getElementById('creatorAvatar')?.value || 'https://i.imgur.com/djAAX7s.png',
                        cardBackgroundFront: getUrl('creatorBgFront'),
                        cardBackgroundBack: getUrl('creatorBgBack'),
                        overlayImage: getUrl('creatorOverlay'),
                        themeColor: document.getElementById('creatorCardColor')?.value,
                        bgColor: document.getElementById('creatorBgColor')?.value,
                        backTextColor: document.getElementById('creatorBackTextColor')?.value,
                        effects: [],
                        premiumEffects: [],
                        effectColors: {},
                    };

                    if (isSpecialUser) {
                        const badges = [];
                        document.querySelectorAll('.creatorBadgePicker .badge-pick-item.selected-front').forEach(item => {
                            const isSpecial = !!item.closest('.specialBadgePicker');
                            badges.push({ type: isSpecial ? item.dataset.id : 'custom', id: item.dataset.id, location: 'front' });
                        });
                        document.querySelectorAll('.creatorBadgePicker .badge-pick-item.selected-back').forEach(item => {
                            const isSpecial = !!item.closest('.specialBadgePicker');
                             badges.push({ type: isSpecial ? item.dataset.id : 'custom', id: item.dataset.id, location: 'back' });
                        });

                        this.premiumEffects.forEach(effect => {
                            const toggle = document.getElementById(`effect-toggle-${effect.id}`);
                            if (toggle?.checked) {
                                cardData.premiumEffects.push(effect.id);
                                cardData.effectColors[effect.id] = {};
                                effect.colors.forEach((color, index) => {
                                    const colorInput = document.getElementById(`effect-color-${effect.id}-${index}`);
                                    if(colorInput) {
                                      const colorKey = color.label.startsWith('H') ? color.label.toLowerCase() : `c${index+1}`;
                                      cardData.effectColors[effect.id][colorKey] = colorInput.value;
                                    }
                                });
                            }
                        });

                        Object.assign(cardData, {
                            ...specialUserCard,
                            ...cardData,
                            isCustom: false,
                            badges: badges,
                        });
                    } else {
                         Object.assign(cardData, {
                            isCustom: true,
                            role: 'USER',
                            effects: [
                                ...(document.getElementById('creatorHoloEffect')?.checked ? ['holographic'] : []), 
                                ...(document.getElementById('creatorSparkleEffect')?.checked ? ['shiny'] : [])
                            ],
                            customText: document.getElementById('creatorCustomText')?.value || '',
                            badge: document.querySelector('#creatorBadgePicker .selected-back')?.dataset.id || null,
                            badgeFront: null
                        });
                    }
                    return cardData;
                }

                renderCustomUserCardHTML(cardData) {
                    if (!cardData) return '';
                    
                    const isCustom = cardData.isCustom;
                    const premiumEffects = cardData.premiumEffects || [];
                    const effects = cardData.effects || [];

                    const hasShiny = effects.includes('shiny') || premiumEffects.includes('sparkle');
                    const hasHolo = effects.includes('holographic') || premiumEffects.includes('holo');
                    
                    let cardRarity = cardData.cardRarity || 'common';
                    if (isCustom) {
                        if (hasShiny) cardRarity = 'shiny';
                        else if (hasHolo) cardRarity = 'holographic';
                    }
                    
                    const borderColor = cardData.themeColor || '#888888';
                    const lighterBorderColor = lightenColor(borderColor, 40);
                    const borderGradient = `linear-gradient(45deg, ${borderColor}, ${lighterBorderColor})`;
                    
                    let frontBgStyle = cardData.cardBackgroundFront ? `background-image: ${cardData.cardBackgroundFront};` : `background-color: ${cardData.bgColor || '#2c2c2c'};`;
                    let backBgStyle = cardData.cardBackgroundBack ? `background-image: ${cardData.cardBackgroundBack};` : `background-color: ${cardData.bgColor || '#2c2c2c'};`;
                    
                    let beforeStyle = `style="background: ${borderGradient};"`;
                    if (cardRarity === 'shiny') { const shinyColor = lightenColor(borderColor, 20); const lightShiny = lightenColor(shinyColor, 50); const shinyGradient = `conic-gradient(from var(--angle, 0deg) at 50% 50%, #ffffff, ${lightShiny}, #ffffff, ${shinyColor}, #ffffff)`; beforeStyle = `style="background: ${shinyGradient}; animation: rotate-holo-bg 12s linear infinite; filter: blur(15px) brightness(1.1); z-index: -2;"`; }
                    else if (cardRarity === 'holographic') { const holoColor = lightenColor(borderColor, -10); const bgColorForHolo = cardData.bgColor || '#2c2c2c'; const lightHolo = lightenColor(holoColor, 40); const darkHolo = lightenColor(holoColor, -20); const holoGradient = `conic-gradient(from var(--angle, 0deg) at 50% 50%, ${holoColor}, ${lightHolo}, ${bgColorForHolo}, ${cardData.themeColor}, ${darkHolo}, ${holoColor})`; beforeStyle = `style="background: ${holoGradient}; animation: rotate-holo-bg 12s linear infinite; filter: blur(15px) brightness(0.9); z-index: -2;"`; }
                    
                    const nameStyle = `style="background: ${borderGradient}; -webkit-background-clip: text; color: transparent;"`;
                    
                    const generateSparkles = () => { let html = ''; for (let i = 0; i < 25; i++) { html += '<div class="sparkle"></div>'; } return html; };
                    const sparkleHTML = `<div class="sparkle-overlay ${hasShiny ? 'force-sparkle-effect' : ''}">${generateSparkles()}</div>`;
                    const overlayHTML = cardData.overlayImage ? `<div class="custom-overlay" style="background-image: ${cardData.overlayImage};"></div>` : '';
                    
                    let effectLayersHTML = '';
                    const effectColors = cardData.effectColors || {};
                    premiumEffects.forEach(effectId => {
                        const effectDef = this.premiumEffects.find(e => e.id === effectId);
                        if(effectDef) {
                            let style = '';
                            const colorsForEffect = effectColors[effectId] || {};
                            effectDef.colors.forEach((color, index) => {
                                const colorKey = color.label.startsWith('H') ? color.label.toLowerCase() : `c${index+1}`;
                                style += `--${colorKey}: ${colorsForEffect[colorKey] || color.default}; `;
                            });
                            effectDef.layers.forEach(layerClass => {
                                effectLayersHTML += `<div class="effect-layer ${layerClass}" style="${style}"></div>`;
                            });
                        }
                    });

                    let backContentHTML = '', frontBadgesHTML = '';
                    const getBadgeUrl = (badge) => badge.type === 'custom' ? userBadgeData.find(udb => udb.id === badge.id)?.url : BADGE_TYPES[badge.type]?.img;
                    
                    if (isCustom) {
                        const textHTML = cardData.customText ? `<p class="tester-desc" style="color: ${cardData.backTextColor || '#ffffff'}">${cardData.customText}</p>` : '';
                        const frontBadgeInfo = userBadgeData.find(b => b.id === cardData.badgeFront);
                        const backBadgeInfo = userBadgeData.find(b => b.id === cardData.badge);
                        frontBadgesHTML = frontBadgeInfo ? `<img src="${frontBadgeInfo.url}" class="tester-badge badge-on-front" alt="User Front Badge">` : '';
                        backContentHTML = `${textHTML}${backBadgeInfo ? `<div class="tester-badge-container"><img src="${backBadgeInfo.url}" class="tester-badge user-card-badge" alt="User Back Badge"></div>` : ''}`;
                    } else {
                        const backDescStyle = `style="color:${cardData.backTextColor || cardData.themeColor};text-shadow: 1px 1px 3px rgba(0,0,0,1);"`;
                        backContentHTML = `<p class="tester-desc" ${backDescStyle}>${cardData.description || ''}</p>`;
                        if (cardData.badges && Array.isArray(cardData.badges)) {
                            const frontBadges = cardData.badges.filter(b => b.location === 'front');
                            const backBadges = cardData.badges.filter(b => b.location === 'back');
                            frontBadgesHTML = frontBadges.map(b => { const url = getBadgeUrl(b); return url ? `<img src="${url}" class="tester-badge badge-on-front" alt="Badge">` : ''; }).join('');
                            const backBadgesHTML = backBadges.map(b => { const url = getBadgeUrl(b); return url ? `<img src="${url}" class="tester-badge" alt="Badge">` : ''; }).join('');
                            if (backBadges.length > 0) backContentHTML += `<div class="tester-badge-container">${backBadgesHTML}</div>`;
                        }
                    }
                    const holoShineLayerClass = hasHolo ? `holo-shine-layer force-holo-effect` : `holo-shine-layer`;

                    return `<div class="tester-card" data-rarity="${cardRarity}"> <div class="tester-card-inner"> <div class="tester-card-front" style="${frontBgStyle}"> <div class="tester-card-front-pseudo" ${beforeStyle}></div> ${effectLayersHTML} <div class="${holoShineLayerClass}"></div> ${sparkleHTML} ${overlayHTML} ${frontBadgesHTML} <img src="${cardData.avatar}" class="tester-image" style="border: 3px solid ${borderColor};" alt="${cardData.name}"> <div class="tester-name" ${nameStyle}>${cardData.name}</div> </div> <div class="tester-card-back" style="${backBgStyle}"> <div class="tester-card-back-pseudo" ${beforeStyle}></div> ${effectLayersHTML} <canvas class="particle-canvas"></canvas> <div class="${holoShineLayerClass}"></div> ${sparkleHTML} ${overlayHTML} <div class="role-label" style="background-color:${borderColor}aa;">${cardData.role}</div> <div class="tester-back-content">${backContentHTML}</div> </div> </div> </div>`;
                }

                showImportedCardScreen(cardData, importType, callback) { const overlay = document.getElementById('importedCardOverlay'); const typeText = importType === 'themes_v1' ? 'themes' : 'bookmarks'; const themedColor = cardData.themeColor || 'var(--primary-color)'; const themedGradient = `linear-gradient(45deg, ${themedColor}, ${lightenColor(themedColor, 20)})`; overlay.innerHTML = `<div class="prompt-container"> <div style="margin-bottom:20px; perspective: 800px; display: inline-block;"> <div class="hover-info-logo" id="import-logo" style="width:40px; height:40px; margin:0 auto; background: ${themedColor};"></div> </div> <h2 id="importedCardHeader"> <strong style="color: ${themedColor};">${cardData.name}</strong> shared their ${typeText} with you! </h2> <div id="importedCardContainer"> ${this.renderCustomUserCardHTML(cardData)} </div> <button id="importContinueBtn" class="themed-prompt-button" style="background: ${themedGradient}; animation: none;">Continue</button> </div>`; overlay.classList.add('visible'); const newCard = overlay.querySelector('.tester-card'); const continueBtn = document.getElementById('importContinueBtn'); const logoContainer = overlay.querySelector('#import-logo').parentElement; const logo = overlay.querySelector('#import-logo'); if (logoContainer && logo) { logoContainer.style.animation = 'import-logo-entrance 1.8s ease-out forwards'; logoContainer.addEventListener('animationend', () => { logoContainer.style.animation = ''; const randomTiltX = (Math.random() - 0.5) * 15; const randomTiltY = (Math.random() - 0.5) * 15; logoContainer.style.transform = `scale(1.1) rotateX(${randomTiltX}deg) rotateY(${randomTiltY}deg)`; this.apply3dHoverEffect(logoContainer, logo, { maxRotate: 20, scale: 1.1 }); }, { once: true }); } if (newCard) { cardEffectsManager.initCardEffects(newCard); newCard.querySelector('.tester-card-inner').style.animation = 'slow-spin-tilt 20s linear infinite'; if (!cardData.isCustom) { newCard.classList.add('special-import-animation'); newCard.style.setProperty('--special-glow-color', themedColor); continueBtn.style.setProperty('--special-glow-color', themedColor); continueBtn.style.animation = 'import-glow 4s ease-in-out infinite'; newCard.querySelectorAll('.tester-card-back .tester-desc, .tester-card-back .tester-badge').forEach(el => el.classList.add('pulsing')); setTimeout(() => { cardEffectsManager.animateBadgesSequentially(newCard); }, 1000); const particleCanvas = newCard.querySelector('.particle-canvas'); const cardParticleSystem = Object.create(cardEffectsManager.particleSystem); cardParticleSystem.init(particleCanvas); setTimeout(() => { if (particleCanvas && newCard.parentElement) { cardParticleSystem.resize(); cardParticleSystem.emit(newCard, cardData.cardRarity, cardData.particleImage, true); if (cardParticleSystem.particles.length > 0 && !cardParticleSystem.active) { cardParticleSystem.updateAndDraw(); } } }, 500); const shineOverlay = document.createElement('div'); shineOverlay.className = 'shine-overlay'; const cardInner = newCard.querySelector('.tester-card-inner'); if (cardInner) { cardInner.appendChild(shineOverlay); const animateShine = () => { const directionClass = Math.random() < 0.5 ? 'animate-ltr' : 'animate-rtl'; shineOverlay.classList.remove('animate-ltr', 'animate-rtl'); setTimeout(() => { shineOverlay.classList.add(directionClass); }, 10); }; shineOverlay.addEventListener('animationend', () => { const randomDelay = Math.random() * 300 + 300; setTimeout(animateShine, randomDelay); }); animateShine(); } } } this.apply3dHoverEffect(continueBtn, continueBtn, {maxRotate: 10, scale: 1.05}); continueBtn.onclick = () => { overlay.innerHTML = ''; overlay.classList.remove('visible'); callback(); }; }
                handleIconUpload(file) { if (!file) return; const reader = new FileReader(); reader.onload = (e) => { document.getElementById('iconPreview').innerHTML = `<div class="icon-preview" style="background-image: url('${e.target.result}')"></div>`; this.selectedIcon = e.target.result; }; reader.readAsDataURL(file); }
                renderIconPicker(currentIcon) { if (localIconList.length === 0) return ''; const iconsHTML = localIconList.map(filename => { const path = `icons/${filename}`; const isSelected = currentIcon === path ? 'selected' : ''; const fallbackUrl = localIconFallbacks[filename]; const style = `style="-webkit-mask-image: url('${path}'), url('${fallbackUrl}'); mask-image: url('${path}'), url('${fallbackUrl}');"`; return `<div class="icon-picker-item ${isSelected}" onclick="window.bookmarkManager.selectLocalIcon(this, '${path}')" title="${filename.split('.')[0]}"><div ${style}></div></div>`; }).join(''); return `<div class="icon-picker"><label>Choose from local icons:</label><div class="icon-picker-container"><button type="button" class="icon-picker-arrow left hidden" onclick="window.scrollIconPicker('left')">‹</button><div class="icon-picker-grid" id="iconPickerGrid">${iconsHTML}</div><button type="button" class="icon-picker-arrow right" onclick="window.scrollIconPicker('right')">›</button></div></div>`; }
                async selectLocalIcon(element, iconPath) { document.querySelectorAll('.icon-picker-item').forEach(item => item.classList.remove('selected')); element.classList.add('selected'); try { const response = await fetch(iconPath); if (!response.ok) { throw new Error(`Failed to fetch icon: ${response.statusText}`); } if (iconPath.endsWith('.svg')) { const svgText = await response.text(); this.selectedCategoryIcon = svgText; } else { const blob = await response.blob(); this.selectedCategoryIcon = await new Promise((resolve, reject) => { const reader = new FileReader(); reader.onloadend = () => resolve(reader.result); reader.onerror = reject; reader.readAsDataURL(blob); }); } } catch (error) { console.error("Error baking in local icon:", error); this.selectedCategoryIcon = iconPath; } }
                applyTheme(primary, secondary) { const root = document.documentElement; if (primary) { root.style.setProperty('--primary-color', primary); root.style.setProperty('--primary-color-rgb', this.hexToRgb(primary)); const darkShade = lightenColor(primary, -30); root.style.setProperty('--dark-orange', darkShade); this.updateFavicon(primary); } if (secondary) { root.style.setProperty('--secondary-color', secondary); root.style.setProperty('--secondary-color-rgb', this.hexToRgb(secondary)); } }
                updateFavicon(color) { const canvas = document.createElement('canvas'); canvas.width = 32; canvas.height = 32; const ctx = canvas.getContext('2d'); const image = new Image(); image.crossOrigin = 'Anonymous'; image.onload = () => { ctx.fillStyle = color; ctx.fillRect(0, 0, 32, 32); ctx.globalCompositeOperation = 'destination-in'; ctx.drawImage(image, 0, 0, 32, 32); const link = document.getElementById('favicon'); if (link) { link.href = canvas.toDataURL('image/png'); } }; image.src = 'https://i.imgur.com/LutzkGO.png'; }
                saveActiveTheme() { localStorage.setItem('theme_primary', document.getElementById('primaryColorPicker').value); localStorage.setItem('theme_secondary', document.getElementById('secondaryColorPicker').value); hasUnsavedChanges = true; }
                loadAndApplyTheme() { const primary = localStorage.getItem('theme_primary') || '#ff6b35'; const secondary = localStorage.getItem('theme_secondary') || '#ff8f35'; this.applyTheme(primary, secondary); document.getElementById('primaryColorPicker').value = primary; document.getElementById('secondaryColorPicker').value = secondary; }
                resetTheme() { if (confirm("Are you sure you want to reset the theme to default? This will not affect your saved themes.")){ const defaultPrimary = '#ff6b35'; const defaultSecondary = '#ff8f35'; this.applyTheme(defaultPrimary, defaultSecondary); localStorage.removeItem('theme_primary'); localStorage.removeItem('theme_secondary'); document.getElementById('primaryColorPicker').value = defaultPrimary; document.getElementById('secondaryColorPicker').value = defaultSecondary; } }

                showToast(message, type = 'info', iconUrl = null) {
                    let toast = document.querySelector('.creator-toast');
                    if (toast) { toast.remove(); }
                    toast = document.createElement('div');
                    toast.className = 'creator-toast';
                    toast.classList.add(type);
                    
                    let content = '';
                    if(iconUrl) {
                        content += `<img src="${iconUrl}" alt="badge icon">`;
                    }
                    content += `<span>${message}</span>`;
                    toast.innerHTML = content;
                    
                    const preview = document.getElementById('creatorPreview');
                    if (preview) {
                        preview.appendChild(toast);
                        setTimeout(() => toast.classList.add('show'), 10);
                        setTimeout(() => {
                            toast.classList.remove('show');
                            setTimeout(() => toast.remove(), 300);
                        }, 2000);
                    }
                }
                
                handleNormalBadgeClick(item) {
                    const isSelected = item.classList.contains('selected-back');
                    document.querySelectorAll('#creatorBadgePicker .badge-pick-item').forEach(el => el.classList.remove('selected-back'));
                    if (!isSelected) {
                        item.classList.add('selected-back');
                        this.showToast('Badge applied', 'info', item.style.backgroundImage.slice(5, -2));
                    } else {
                        this.showToast('Badge removed', 'removal', item.style.backgroundImage.slice(5, -2));
                    }
                    this.updateCardCreatorPreview();
                }

                handleSpecialBadgeClick(item) {
                    const iconUrl = item.style.backgroundImage.slice(5, -2);
                    const picker = item.closest('.creatorBadgePicker');
                    const isPersonalizedPicker = picker.classList.contains('specialBadgePicker');

                    if (isPersonalizedPicker) {
                        const location = item.dataset.location;
                        const isFrontBadge = location === 'front';
                        const targetClass = isFrontBadge ? 'selected-front' : 'selected-back';
                        
                        if (item.classList.contains(targetClass)) {
                            item.classList.remove(targetClass);
                            this.showToast('Badge removed', 'removal', iconUrl);
                        } else {
                            const currentFrontCount = document.querySelectorAll('.badge-pick-item.selected-front').length;
                            const currentBackCount = document.querySelectorAll('.badge-pick-item.selected-back').length;
                            
                            if (isFrontBadge && currentFrontCount < 1) {
                                item.classList.add(targetClass);
                                this.showToast(`Badge applied to ${location}`, 'front', iconUrl);
                            } else if (!isFrontBadge && currentBackCount < 3) {
                                item.classList.add(targetClass);
                                this.showToast(`Badge applied to ${location}`, 'info', iconUrl);
                            } else {
                                this.showToast(`Max ${location} badges reached!`, 'warning', iconUrl);
                            }
                        }
                    } else {
                        const isBack = item.classList.contains('selected-back');
                        const isFront = item.classList.contains('selected-front');
                        
                        const currentFrontCount = document.querySelectorAll('.badge-pick-item.selected-front').length;
                        const currentBackCount = document.querySelectorAll('.badge-pick-item.selected-back').length;

                        if (isFront) {
                            item.classList.remove('selected-front');
                            this.showToast('Badge removed', 'removal', iconUrl);
                        } else if (isBack) {
                            item.classList.remove('selected-back');
                            if (currentFrontCount < 1) {
                                item.classList.add('selected-front');
                                this.showToast('Badge moved to front', 'front', iconUrl);
                            } else {
                                this.showToast('Badge removed', 'removal', iconUrl);
                            }
                        } else {
                            if (currentBackCount < 3) {
                                item.classList.add('selected-back');
                                this.showToast('Badge applied to back', 'info', iconUrl);
                            } else if (currentFrontCount < 1) {
                                item.classList.add('selected-front');
                                this.showToast('Badge applied to front', 'front', iconUrl);
                            } else {
                                this.showToast('Max badges reached!', 'warning', iconUrl);
                            }
                        }
                    }
                    this.updateCardCreatorPreview();
                }
            }
            
            window.bookmarkManager = new BookmarkManager();

            const initFloatingEmojis = () => { const emojiList = ['😎', '😳', '🥺', '😱', '💀', '😭', '🥴', '🥀', '😋', '😮', '🕸️', '🎴', '🤤', '🤪', '😵‍💫', '🏴‍☠️', '🫨']; const startEmojiSpan = document.getElementById('startEmoji'); const endEmojiSpan = document.getElementById('endEmoji'); if(!startEmojiSpan || !endEmojiSpan) return; const randomEmoji = emojiList[Math.floor(Math.random() * emojiList.length)]; startEmojiSpan.textContent = randomEmoji; endEmojiSpan.textContent = randomEmoji; const animateEmoji = (element) => { const maxRotation = 25; const randomX = Math.random() * (2 * maxRotation) - maxRotation; const randomY = Math.random() * (2 * maxRotation) - maxRotation; const randomZ = Math.random() * (2 * maxRotation) - maxRotation; element.style.transition = 'transform 2s ease-in-out'; element.style.transform = `rotateX(${randomX}deg) rotateY(${randomY}deg) rotateZ(${randomZ}deg)`; }; animateEmoji(startEmojiSpan); animateEmoji(endEmojiSpan); setInterval(() => animateEmoji(startEmojiSpan), 2000); setInterval(() => animateEmoji(endEmojiSpan), 2000); };
            initFloatingEmojis();
            
            const descTooltipElement = document.createElement('div');
            descTooltipElement.className = 'custom-tooltip';
            document.body.appendChild(descTooltipElement);
            let descTooltipTimeout;

            document.body.addEventListener('mouseover', e => {
                const descElem = e.target.closest('.bookmark-description');
                if (descElem && descElem.scrollWidth > descElem.clientWidth) {
                    clearTimeout(descTooltipTimeout);
                    descTooltipTimeout = setTimeout(() => {
                        if (descElem.matches(':hover')) {
                            descTooltipElement.textContent = descElem.dataset.description;
                            const x = e.clientX + 15;
                            const y = e.clientY + 15;
                            descTooltipElement.style.left = `${x}px`;
                            descTooltipElement.style.top = `${y}px`;
                            descTooltipElement.style.transform = 'translate(0, 0)';
                            
                            const rect = descTooltipElement.getBoundingClientRect();
                            if (rect.right > window.innerWidth) {
                                descTooltipElement.style.left = `${e.clientX - rect.width - 15}px`;
                            }
                            if (rect.bottom > window.innerHeight) {
                                descTooltipElement.style.top = `${e.clientY - rect.height - 15}px`;
                            }
                            
                            descTooltipElement.classList.add('visible');
                        }
                    }, 700);
                }
            });

            document.body.addEventListener('mouseout', e => {
                const descElem = e.target.closest('.bookmark-description');
                if (descElem) {
                    clearTimeout(descTooltipTimeout);
                    descTooltipElement.classList.remove('visible');
                }
            });

            setInterval(() => { if (hasUnsavedChanges && window.bookmarkManager) { window.bookmarkManager.saveToLocalStorage(); } }, 30000);
        });
    </script>
</body>
</html>